<channelGroup version="3.9.1">
  <id>b98ed95f-84af-4413-90b3-2d637b62322a</id>
  <name>Synlab Colombia  Phase 2</name>
  <revision>12</revision>
  <lastModified>
    <time>1700840141576</time>
    <timezone>America/Bogota</timezone>
  </lastModified>
  <description></description>
  <channels>
    <channel version="3.9.1">
      <id>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>3- Save Order Information</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>Auto-generate (Before processing)</responseVariable>
            <respondAfterProcessing>false</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>var order_id = msg[&apos;ORC&apos;][0][&apos;ORC.4&apos;][&apos;ORC.4.1&apos;].toString();
var order_list =&apos;&apos;;
for each (seg in msg..OBR) {
	 order_list += seg[&apos;OBR.4&apos;][&apos;OBR.4.1&apos;].toString() +&apos;, &apos;;
}
order_list = order_list.substring(0, order_list.length -2);

channelMap.put(&apos;order_id&apos;,order_id)
channelMap.put(&apos;order_list&apos;,order_list)

var dbConn;
var result;
var result2;
var paramList = new java.util.ArrayList();
paramList.add(order_id);
paramList.add(order_list);

var paramList2 = new java.util.ArrayList();
paramList2.add(order_list);
paramList2.add(order_id);


try {
	dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;, &apos;jdbc:mysql://localhost:3306/rd_staging&apos;, &apos;root&apos;, &apos;1Password&apos;);
	var expression = &quot;insert into repository.orders (order_id, order_list) values(?,?)&quot;
	var expression2 = &quot;update repository.orders set order_list = ? where order_id = ?&quot;;
	result2 = dbConn.executeUpdate(expression2, paramList2);
	channelMap.put(&apos;result2&apos;,result2)
	if (result2 == 0){
		result = dbConn.executeUpdate(expression, paramList);
	}
} finally {
	if (dbConn) {
		dbConn.close();
	}
}</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64">TVNIfF5+XCZ8Wm9yZ0RvbWVpbnx8R0xJTVN8QXRhbG1lZGlhbC1BTVNURVJEQU18MjAyMDA1MTkx
NjAwMzQrMDIwMHx8T01MXk8yMV5PTUxfTzIxfFpEMTIxMjEyOTZ8UHwyLjV8fHx8fE5MRHw4ODU5
LzEKUElEfDF8fDEyMzQ1Njc4Xl5eTkxNSU5CSVpBXk5OTkxEfHxUb3ZlbmFhciYmVG92ZW5hYXJe
S15eXl5eTHx8MTk4ODA4MzF8Rnx8fFN1aWtlcnBvb3J0IDExJlN1aWtlcnBvb3J0JjExXl5EdWNr
c3RhZF5eMTIzNFpaXk5MXkh8fDA2LTEyMzQgNTY3OF5eUEgKUFYxfDF8TwpJTjF8MXxebnVsbHww
Xl5eXkxPQ0FMfE9OVlogWm9yZ3Zlcnpla2VyYWFyfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8
fHx8fHwxMjM1MzA1OTAwCk9SQ3xOV3xaRDY4MTMxMjk2XzAxfHxaRDY4MTMxMjk2fHx8Xl5eXl5S
fHwyMDIwMDUxOTE1NTk1MiswMjAwfF4mJkhhbnNlbl5NLkEufHwwMTAyMjM5MF4mJlViYmVuc15P
LkguRS5eXl5eXl5WRUtUSVN8fHx8fDM0MDA5Mjc5XkF0YWxtZWRpYWxeTApUUTF8MXx8fHx8fHx8
UgpPQlJ8MXxaRDY4MTMxMjk2XzAxfHxLXkthbGl1bV5MfHx8fHx8fE98fHx8fDAxMDIyMzkwXiYm
VWJiZW5zXk8uSC5FLl5eXl5eXlZFS1RJUwpPQlh8MXxTVHxBSV5PcG1lcmtpbmdlbiAvIGtsaW5p
c2NoZSBnZWdldmVuc15MfHxEaWFiZWV0fHx8fHx8RgpPUkN8Tld8WkQ2ODEzMTI5Nl8wMnx8WkQ2
ODEzMTI5Nnx8fF5eXl5eUnx8MjAyMDA1MTkxNTU5NTIrMDIwMHxeJiZIYW5zZW5eTS5BLnx8MDEw
MjIzOTBeJiZVYmJlbnNeTy5ILkUuXl5eXl5eVkVLVElTfHx8fHwzNDAwOTI3OV5BdGFsbWVkaWFs
XkwKVFExfDJ8fHx8fHx8fFIKT0JSfDJ8WkQ2ODEzMTI5Nl8wMnx8S1JFXktyZWF0aW5pbmUgKCtD
S0QtRVBJKV5MfHx8fHx8fE98fHx8fDAxMDIyMzkwXiYmVWJiZW5zXk8uSC5FLl5eXl5eXlZFS1RJ
UwpPUkN8Tld8WkQ2ODEzMTI5Nl8wM3x8WkQ2ODEzMTI5Nnx8fF5eXl5eUnx8MjAyMDA1MTkxNTU5
NTIrMDIwMHxeJiZIYW5zZW5eTS5BLnx8MDEwMjIzOTBeJiZVYmJlbnNeTy5ILkUuXl5eXl5eVkVL
VElTfHx8fHwzNDAwOTI3OV5BdGFsbWVkaWFsXkwKVFExfDN8fHx8fHx8fFIKT0JSfDN8WkQ2ODEz
MTI5Nl8wM3x8TERMXkxETCBDaG9sZXN0ZXJvbF5MfHx8fHx8fE98fHx8fDAxMDIyMzkwXiYmVWJi
ZW5zXk8uSC5FLl5eXl5eXlZFS1RJUwpPUkN8Tld8WkQ2ODEzMTI5Nl8wNHx8WkQ2ODEzMTI5Nnx8
fF5eXl5eUnx8MjAyMDA1MTkxNTU5NTIrMDIwMHxeJiZIYW5zZW5eTS5BLnx8MDEwMjIzOTBeJiZV
YmJlbnNeTy5ILkUuXl5eXl5eVkVLVElTfHx8fHwzNDAwOTI3OV5BdGFsbWVkaWFsXkwKVFExfDR8
fHx8fHx8fFIKT0JSfDR8WkQ2ODEzMTI5Nl8wNHx8R0xVTlVeR2x1Y29zZSBudWNodGVyXkx8fHx8
fHx8T3x8fHx8MDEwMjIzOTBeJiZVYmJlbnNeTy5ILkUuXl5eXl5eVkVLVElTCk9SQ3xOV3xaRDY4
MTMxMjk2XzA1fHxaRDY4MTMxMjk2fHx8Xl5eXl5SfHwyMDIwMDUxOTE1NTk1MiswMjAwfF4mJkhh
bnNlbl5NLkEufHwwMTAyMjM5MF4mJlViYmVuc15PLkguRS5eXl5eXl5WRUtUSVN8fHx8fDM0MDA5
Mjc5XkF0YWxtZWRpYWxeTApUUTF8NXx8fHx8fHx8UgpPQlJ8NXxaRDY4MTMxMjk2XzA1fHxNQUxC
UF5NaWNyb2FsYnVtaW5lIC8ga3JlYXRpbmluZSByYXRpb15MfHx8fHx8fE98fHx8fDAxMDIyMzkw
XiYmVWJiZW5zXk8uSC5FLl5eXl5eXlZFS1RJUwpPUkN8Tld8WkQ2ODEzMTI5Nl8wNnx8WkQ2ODEz
MTI5Nnx8fF5eXl5eUnx8MjAyMDA1MTkxNTU5NTIrMDIwMHxeJiZIYW5zZW5eTS5BLnx8MDEwMjIz
OTBeJiZVYmJlbnNeTy5ILkUuXl5eXl5eVkVLVElTfHx8fHwzNDAwOTI3OV5BdGFsbWVkaWFsXkwK
VFExfDZ8fHx8fHx8fFIKT0JSfDZ8WkQ2ODEzMTI5Nl8wNnx8SEJBMUNwXkhiQTFjXkx8fHx8fHx8
T3x8fHx8MDEwMjIzOTBeJiZVYmJlbnNeTy5ILkUuXl5eXl5eVkVLVElTCk9SQ3xOV3xaRDY4MTMx
Mjk2XzA3fHxaRDY4MTMxMjk2fHx8Xl5eXl5SfHwyMDIwMDUxOTE1NTk1MiswMjAwfF4mJkhhbnNl
bl5NLkEufHwwMTAyMjM5MF4mJlViYmVuc15PLkguRS5eXl5eXl5WRUtUSVN8fHx8fDM0MDA5Mjc5
XkF0YWxtZWRpYWxeTApUUTF8N3x8fHx8fHx8UgpPQlJ8N3xaRDY4MTMxMjk2XzA3fHxIRExeSERM
IGNob2xlc3Rlcm9sXkx8fHx8fHx8T3x8fHx8MDEwMjIzOTBeJiZVYmJlbnNeTy5ILkUuXl5eXl5e
VkVLVElTCk9SQ3xOV3xaRDY4MTMxMjk2XzA4fHxaRDY4MTMxMjk2fHx8Xl5eXl5SfHwyMDIwMDUx
OTE1NTk1MiswMjAwfF4mJkhhbnNlbl5NLkEufHwwMTAyMjM5MF4mJlViYmVuc15PLkguRS5eXl5e
Xl5WRUtUSVN8fHx8fDM0MDA5Mjc5XkF0YWxtZWRpYWxeTApUUTF8OHx8fHx8fHx8UgpPQlJ8OHxa
RDY4MTMxMjk2XzA4fHxOQV5OYXRyaXVtXkx8fHx8fHx8T3x8fHx8MDEwMjIzOTBeJiZVYmJlbnNe
Ty5ILkUuXl5eXl5eVkVLVElT</inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>HL7V2</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>none</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>ORDERID</name>
            <type>STRING</type>
            <mappingName>order_id</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>false</enabled>
          <lastModified>
            <time>1603650287907</time>
            <timezone>Europe/Berlin</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>15</pruneMetaDataDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>f4c513ef-f1ab-470a-bff5-d505363dd0cb</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>6- get Validated Responses</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.js.JavaScriptReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <pollConnectorProperties version="3.9.1">
            <pollingType>INTERVAL</pollingType>
            <pollOnStart>true</pollOnStart>
            <pollingFrequency>300000</pollingFrequency>
            <pollingHour>0</pollingHour>
            <pollingMinute>0</pollingMinute>
            <cronJobs/>
            <pollConnectorPropertiesAdvanced>
              <weekly>true</weekly>
              <inactiveDays>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
              </inactiveDays>
              <dayOfMonth>1</dayOfMonth>
              <allDay>true</allDay>
              <startingHour>8</startingHour>
              <startingMinute>0</startingMinute>
              <endingHour>17</endingHour>
              <endingMinute>0</endingMinute>
            </pollConnectorPropertiesAdvanced>
          </pollConnectorProperties>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <script>return 1;</script>
        </properties>
        <transformer version="3.9.1">
          <elements/>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <inboundDataType>RAW</inboundDataType>
          <outboundDataType>RAW</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptrule.JavaScriptRule version="3.9.1">
              <name>Filter during HouseKeeping</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>var dateInt = parseInt(DateUtil.getCurrentDate(&apos;HHmm&apos;),10);

if (dateInt &lt;= 205 &amp;&amp; dateInt &gt;= 200){
  return 0;
}
else{
  return 1;
}</script>
            </com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
          </elements>
        </filter>
        <transportName>JavaScript Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <host>http://localhost:9023/rdr/interpreter/approved?kbcode=ATAL</host>
            <useProxyServer>false</useProxyServer>
            <proxyAddress></proxyAddress>
            <proxyPort></proxyPort>
            <method>get</method>
            <headers class="linked-hash-map"/>
            <parameters class="linked-hash-map"/>
            <useHeadersVariable>false</useHeadersVariable>
            <useParametersVariable>false</useParametersVariable>
            <responseXmlBody>false</responseXmlBody>
            <responseParseMultipart>true</responseParseMultipart>
            <responseIncludeMetadata>false</responseIncludeMetadata>
            <responseBinaryMimeTypes>application/.*(?&lt;!json|xml)$|image/.*|video/.*|audio/.*</responseBinaryMimeTypes>
            <responseBinaryMimeTypesRegex>true</responseBinaryMimeTypesRegex>
            <multipart>false</multipart>
            <useAuthentication>false</useAuthentication>
            <authenticationType>Basic</authenticationType>
            <usePreemptiveAuthentication>false</usePreemptiveAuthentication>
            <username></username>
            <password></password>
            <content></content>
            <contentType>text/plain</contentType>
            <dataTypeBinary>false</dataTypeBinary>
            <charset>UTF-8</charset>
            <socketTimeout>30000</socketTimeout>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>RAW</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>var responseError = response.getError();


if(responseError == null || responseError == &apos;&apos;){
	if(msg != null &amp;&amp; msg != &quot;&quot;){
		var input = JSON.parse(response.getMessage());
		if(input.length &gt; 0){
			for (var i = 0; i &lt; input.length; i++) {	
				router.routeMessage(&apos;7- Transfrom Validated Response&apos;, JSON.stringify(input[i]));
				router.routeMessage(&apos;5- Save Response Messages&apos;, JSON.stringify(input[i]));
			}
		}
	}	
}</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>HTTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>false</enabled>
          <lastModified>
            <time>1605544783084</time>
            <timezone>Europe/Berlin</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>15</pruneMetaDataDays>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>03226d36-9fd4-49ce-a918-28b4fb9517b3</id>
      <nextMetaDataId>8</nextMetaDataId>
      <name>7- Transfrom Validated Response</name>
      <description></description>
      <revision>8</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
              <name>Old</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>channelMap.put(&apos;CDS1&apos;,sourceMap.get(&apos;CDS1 Request&apos;));
channelMap.put(&apos;HL7Head&apos;,msg[&apos;senderReference&apos;]);
channelMap.put(&apos;approved&apos;,msg[&apos;approved&apos;]);
channelMap.put(&apos;report&apos;, msg[&apos;report&apos;]);
channelMap.put(&apos;caseId&apos;,msg[&apos;caseId&apos;]);
channelMap.put(&apos;kbCode&apos;,msg[&apos;kbCode&apos;]);
channelMap.put(&apos;actions&apos;,JSON.stringify(msg[&apos;actions&apos;]));
channelMap.put(&apos;reviewer&apos;,msg[&apos;reviewer&apos;]);

//check if we have comments of CDS ot actions
var aux_flag = 0;
 if(msg[&apos;report&apos;] != &apos;&apos;  &amp;&amp; msg[&apos;approved&apos;] == true){
   if (msg[&apos;report&apos;].indexOf(&apos;##EXTERN_F#&apos;) &gt;=0){ 	
     aux_flag= 1;
   }else{
   	if (msg[&apos;report&apos;].indexOf(&apos;##EXTERN_P#&apos;) &gt;=0){ 	
       aux_flag= 1;
     }else{
     	if (msg[&apos;report&apos;].indexOf(&apos;##INTERN#&apos;) &gt;=0){ 	
     		aux_flag= 1;
  		 }
     }
   }
 }
  if(msg[&apos;actions&apos;] != &apos;&apos; &amp;&amp; msg[&apos;approved&apos;] == true){
  	aux_flag= 1;
  }

 channelMap.put(&apos;aux_flag&apos;,aux_flag);

var aux_actions = msg[&apos;actions&apos;];
  for (w in aux_actions){
  	if (aux_actions[w].externalName == &apos;EMAIL&apos;){
  		var array_email = new Array();
     	array_email=aux_actions[w].value.split(&apos;|&apos;);
  		var actionObj = {};
 	   	
 	   	actionObj.email = array_email[0];
 	   	actionObj.subject = array_email[1];
 	   	actionObj.body = array_email[2];
  		
  		var rsp = router.routeMessage(&apos;SendEmails&apos;, JSON.stringify(actionObj));
  	}
  	
  }

/*

tmp=new XML(msg[&apos;senderReference&apos;]);

tmp[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;] = tmp[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;].toString();
tmp[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.1&apos;] = &quot;batchCDS&quot;;
tmp[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;] = &quot;Abbott&quot;;
tmp[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;] = &quot;AlinIQ CDS&quot;;
tmp[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;] =  DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.1&apos;] = &quot;OML&quot;
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.2&apos;] = &quot;O21&quot;
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.3&apos;] = &quot;OML_O21&quot;
tmp[&apos;MSH&apos;][&apos;MSH.10&apos;][&apos;MSH.10.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
tmp[&apos;MSH&apos;][&apos;MSH.17&apos;][&apos;MSH.17.1&apos;] = &apos;NLD&apos;;
tmp[&apos;MSH&apos;][&apos;MSH.18&apos;][&apos;MSH.18.1&apos;] =&apos;8859/1&apos;;
tmp[&apos;ORC&apos;][0] [&apos;ORC.2&apos;] = &apos;&apos;;
delete tmp[&apos;SPM&apos;];

var countOBR = 1;
var countOBX = 1;
var countNTE = 1;
var countTQ1 = 1;
var countORC = 1;
if(msg[&apos;report&apos;] != null &amp;&amp; msg[&apos;report&apos;] != &quot;&quot;){
  //FILTER COMMENTS
   array_sections = new Array();
   array_sections = msg[&apos;report&apos;].split(&apos;\n\n&apos;);
   var arrayLength = array_sections.length;
   for (var i = 0; i &lt; arrayLength; i++) {
   	ArrayComments = new Array();
     ArrayComments = array_sections[i].split(&apos;\n&apos;);
     var arrayLengthComments = ArrayComments.length;
     for (var j = 0; j &lt; arrayLengthComments; j++) {
     	var linecomment = 0;
     	if (j==0){
     		channelMap.put(&apos;jseccion&apos;+i+j,ArrayComments[j])

     		if (ArrayComments[j] == &apos;Anemie_commentaar&apos;){
     			var OBXType = &apos;CDS_Anemie&apos;;
     		     var OBXName =&apos;CDS Anemie comment&apos;;
     		}else{
     		  if (ArrayComments[j]== &apos;Nierschade_commentaar&apos;){
     		    	var OBXType = &apos;CDS_Nierschade&apos;;
     		     var OBXName =&apos;CDS Nierschade comment&apos;;	
     		  }else{
     		  	var OBXType = &apos;CDS_Comment&apos;;
     		     var OBXName =&apos;CDS Comment&apos;;
     		  }
     		}
     		
     		//Type of comment/Type of OBX
     		//switch(ArrayComments[j]){
     		//	case &apos;Anemie_commentaar&apos;:  
     		//	  channelMap.put(&apos;entro&apos;+i+j,ArrayComments[j])
     		//	  var OBXType = &apos;CDS_Anemie&apos;;
     		//	  var OBXName =&apos;CDS Anemie comment&apos;;
     		//	break;
     		//	case &apos;Nierschade_commentaar&apos;:
     		//	  var OBXType = &apos;CDS_Nierschade&apos;;
     		//	  var OBXName =&apos;CDS Nierschade comment&apos;;
     		//	break;
			//	default:
			//	  var OBXType = &apos;CDS_Comment&apos;;
     		//	  var OBXName =&apos;CDS Comment&apos;;
     				
     		//}
     		
     	}else{
     	  if(ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;) &gt;=0){
     	  	//EXTERNAL comment validated
     	  	if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt; 0){
     	  	  var cv_comments = ArrayComments[j].replace(&quot;##EXTERN_F#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;),ArrayComments[j].indexOf(&apos;##INTERN#&apos;)-1);	
     	  	}else{
     	  		if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) == 0){
     	  		  var cv_comments = ArrayComments[j].replace(&quot;##EXTERN_F#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;));	
     	  		
     	  		}else{
     	  		   var cv_comments = ArrayComments[j].replace(&quot;##EXTERN_F#&quot;,&apos;&apos;)
     	  		}
     	  		
     	  	  
     	  	}
     	  	
     	  	createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	  	     createSegment(&apos;OBR&apos;, tmp, countOBR);
	  	     createSegment(&apos;OBX&apos;, tmp, countOBR);
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	  	     tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = OBXType;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = OBXName;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.6&apos;][&apos;OBR.6.1&apos;] = $(&apos;CDSRequest&apos;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = &quot;&quot;;
	          //tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = &apos;F&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBR;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] = OBXType;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] = OBXName;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] = cv_comments;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] = &apos;F&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = &quot;&quot;
	          //tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = msg[&apos;reviewer&apos;]
	          if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt;= 0){
	          	linecomment = 1;
	            createSegment(&apos;NTE&apos;, tmp, countOBR);
	         	  tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.1&apos;][&apos;NTE.1.1&apos;] = countOBR;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.2&apos;][&apos;NTE.2.1&apos;] = &apos;L&apos;;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.3&apos;][&apos;NTE.3.1&apos;] = ArrayComments[j].substr(ArrayComments[j].indexOf(&apos;##INTERN#&apos;),ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;)).replace(&quot;##INTERN#&quot;,&apos;&apos;);
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.1&apos;] = &apos;XI&apos;;
	            countNTE ++;
	          }
	          countOBR ++;
	          countTQ1 ++;	
	          countOBX ++;	
     	  }
     	  if(ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;) &gt;=0){
     	  	//EXTERNAL comment NOT validated
     	  	if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt; 0){
     	  	  var tv_comments = ArrayComments[j].replace(&quot;##EXTERN_P#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;),ArrayComments[j].indexOf(&apos;##INTERN#&apos;)-1);
     	  	}else{
     	  		if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) == 0){
     	  		  var tv_comments = ArrayComments[j].replace(&quot;##EXTERN_P#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;));	
     	  		
     	  		}else{
     	  		   var tv_comments = ArrayComments[j].replace(&quot;##EXTERN_P#&quot;,&apos;&apos;)
     	  		}
     	  		
     	  	  
     	  	}
     	  	
     	  	createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	  	     createSegment(&apos;OBR&apos;, tmp, countOBR);
	  	     createSegment(&apos;OBX&apos;, tmp, countOBR);
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	  	     tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = OBXType;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = OBXName;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.6&apos;][&apos;OBR.6.1&apos;] = $(&apos;CDSRequest&apos;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = &quot;&quot;;
	          //tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = &apos;P&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBR;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] = OBXType;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] = OBXName;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] = tv_comments;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] = &apos;P&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = &quot;&quot;
	          //tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = msg[&apos;reviewer&apos;]
	          if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt;= 0){
	          	linecomment = 1;
	            createSegment(&apos;NTE&apos;, tmp, countOBR);
	         	  tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.1&apos;][&apos;NTE.1.1&apos;] = countOBR;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.2&apos;][&apos;NTE.2.1&apos;] = &apos;L&apos;;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.3&apos;][&apos;NTE.3.1&apos;] = ArrayComments[j].substr(ArrayComments[j].indexOf(&apos;##INTERN#&apos;),ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;)).replace(&quot;##INTERN#&quot;,&apos;&apos;)
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.1&apos;] = &apos;XI&apos;;
	            countNTE ++;
	          }
	          countOBR ++;
	          countTQ1 ++;	
	          countOBX ++;	
     	  }
     	  if(ArrayComments[j].substr(0,5)==&apos;##INT&apos; &amp;&amp; linecomment == 0){
     	  	//INTERNAL comment
     	  	var internal_comments =ArrayComments[j].replace(&quot;##INTERN#&quot;,&apos;&apos;);
			if (ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;) &gt; 0){
     	  	  var internal_comments = ArrayComments[j].replace(&quot;##INTERN#&quot;,&apos;&apos;).substr(0,ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;)-11);
     	  	}
     	  	if (ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;) &gt; 0){
     	  	  var internal_comments = ArrayComments[j].replace(&quot;##INTERN#&quot;,&apos;&apos;).substr(0,ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;)-11);
     	  	}
     	  	
     	  	createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	  	     createSegment(&apos;OBR&apos;, tmp, countOBR);
	  	     createSegment(&apos;OBX&apos;, tmp, countOBR);
	  	     createSegment(&apos;NTE&apos;, tmp, countOBR);
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	  	     tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = OBXType;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = OBXName;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.6&apos;][&apos;OBR.6.1&apos;] = $(&apos;CDSRequest&apos;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = &quot;&quot;;
	          //tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = &apos;F&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBR;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] = OBXType;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] = OBXName;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] = &apos;&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] = &apos;L&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = &quot;&quot;
	          //tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = msg[&apos;reviewer&apos;];
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.1&apos;][&apos;NTE.1.1&apos;] = countOBR;
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.2&apos;][&apos;NTE.2.1&apos;] = &apos;L&apos;;
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.3&apos;][&apos;NTE.3.1&apos;] =internal_comments;
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.1&apos;] = &apos;XI&apos;;
	          //tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.2&apos;] = &apos;CDS Internal comments&apos;;
	          //tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.3&apos;] = &apos;AlinIQ CDS&apos;;
	          countOBR ++;
	          countTQ1 ++;	
	          countNTE ++;	
	          countOBX ++;	
     	  }
     	  
     	}
     
       }
     }
   
     
}
if( JSON.stringify(msg[&apos;actions&apos;])!= null &amp;&amp; JSON.stringify(msg[&apos;actions&apos;]) != &quot;&quot;){
 
  var aux_actions = JSON.parse(JSON.stringify(msg[&apos;actions&apos;]));
  for (w in aux_actions){
  	if (aux_actions[w].externalName == &apos;ADDTEST&apos; ||  aux_actions[w].externalName == &apos;Add&apos; ||  aux_actions[w].externalName == &apos;ADD&apos;){
  	 ArrayActions = new Array();
      ArrayActions = aux_actions[w].value.split(&apos;,&apos;);
      for (var x = 0; x &lt; ArrayActions.length; x++) {	
	  	 if (x &gt; 0){createSegment(&apos;ORC&apos;, tmp, countORC)};
	  	 createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	      createSegment(&apos;OBR&apos;, tmp, countOBR);
	      tmp[&apos;ORC&apos;][countORC-1] = tmp[&apos;ORC&apos;][0];
	      tmp[&apos;ORC&apos;][countORC-1] [&apos;ORC.2&apos;] = &apos;&apos;;
	      tmp[&apos;ORC&apos;][countORC-1][&apos;ORC.5&apos;][&apos;ORC.5.1&apos;] = &apos;IP&apos;;
	       //tmp[&apos;ORC&apos;][countTQ1-1][&apos;ORC.9&apos;][&apos;ORC.9.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = ArrayActions[x].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = ArrayActions[x].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &apos;L&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = &apos;&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.11&apos;][&apos;OBR.11.1&apos;] = &apos;O&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.16&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.12&apos;];
	      
	      countOBR ++;
	      countTQ1 ++;
	      countORC	++;
	   }  
  	}
  	if (aux_actions[w].externalName == &apos;RESULT&apos;){
  	 ArrayActions = new Array();
      ArrayActions = aux_actions[w].value.split(&apos;,&apos;);
      
	  	if (x &gt; 0){createSegment(&apos;ORC&apos;, tmp, countORC)};
	  	 createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	      createSegment(&apos;OBR&apos;, tmp, countOBR);
	      createSegment(&apos;OBX&apos;, tmp, countOBR);
	      tmp[&apos;ORC&apos;][countORC-1] = tmp[&apos;ORC&apos;][0];
	      tmp[&apos;ORC&apos;][countORC-1] [&apos;ORC.2&apos;] = &apos;&apos;;
	      tmp[&apos;ORC&apos;][countORC-1][&apos;ORC.5&apos;][&apos;ORC.5.1&apos;] = &apos;IP&apos;;
	       //tmp[&apos;ORC&apos;][countTQ1-1][&apos;ORC.9&apos;][&apos;ORC.9.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = ArrayActions[0].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = ArrayActions[0].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &apos;L&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = &apos;&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.11&apos;][&apos;OBR.11.1&apos;] = &apos;O&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.16&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.12&apos;];
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = ArrayActions[2].trim();
	      //tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = ArrayActions[2].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBX;
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] =  ArrayActions[0].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] =  ArrayActions[0].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] =  ArrayActions[1].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] =  ArrayActions[2].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = &quot;&quot;;
	      //tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	      
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = msg[&apos;reviewer&apos;];
	      countOBR ++;
	      countTQ1 ++;
	      countORC	++;
	      countOBX ++;	
	     
  	}


  }
 
}
//map time CDSSentGlimns 
channelMap.put(&apos;CDS5 Sent Glimns&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));
if (sourceMap.get(&apos;CDS1 Request&apos;) != null &amp;&amp; sourceMap.get(&apos;CDS1 Request&apos;) !=&apos;&apos; ) {
    var date = DateUtil.getDate(&quot;yyyyMMddHHmmssSSS&quot;, sourceMap.get(&apos;CDS1 Request&apos;));
    var date2 = new Date();
    channelMap.put(&apos;ProcessTime&apos;,date2.getTime()-date.getTime())
}
*/</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64">ewogICJjYXNlSWQiIDogIjI0MTk2MzA2XzQ0MzI0MTU4NiIsCiAgImtiQ29kZSIgOiAiVEVTVDEi
LAogICJzaXRlIiA6ICIiLAogICJzZW5kZXJSZWZlcmVuY2UiIDogIntcImNhc2VJZFwiOlwiMjQx
OTYzMDZfNDQzMjQxNTg2XCIsXCJ1dWlkQ0RTXCI6XCJmOTk4OWViYS1lMDVmLTQxMGItOTM4ZS0w
Y2M3NmY3NjVjYjdcIixcInNpdGVcIjpcIjkwMDA5ODQ3NlwiLFwiUElEXCI6XCJDQ1wiLFwiUElE
MlwiOlwiMjQxOTYzMDZcIixcIlBJRDNcIjpcIjQ0MzI0MTU4NlwiLFwiZXBpc29kZURhdGVcIjpc
IjIwMjMwODI3MjMxNzQwXCIsXCJTYW1wbGVJRFwiOlwiXCIsXCJGZWNoYVJlZ2lzdHJvT3JkZW5c
IjpcIjIwMjMwODI3MjMxNzQwXCIsXCJNZWRpY29QZXRpY2lvbmFyaW9JRFwiOlwiNTAwMFwiLFwi
U2VkZVN5bmxhYlByZXNlbnRhY2lvblwiOlwiNDQzXCIsXCJDb2RpZ29QbGFuQ2xpZW50ZVwiOlwi
MTQwNjJcIixcIk5JVFwiOlwiOTAwMDk4NDc2XCIsXCJSYXpvblNvY2lhbFwiOlwiRlVOREFDSU9O
IEhPU1BJVEFMIElORkFOVElMIFVOSVZFUlNJVEFSSU8gREUgU0FOIEpPU0VcIixcIkVkYWRQYWNp
ZW50ZVwiOjg1LFwiUGF0aWVudFNleFwiOlwiRlwifSIsCiAgInJlcG9ydCIgOiAiIiwKICAiYWN0
aW9ucyIgOiBbCiAgICB7CiAgICAgICJleHRlcm5hbE5hbWUiIDogIkVNQUlMIiwKICAgICAgInZh
bHVlIiA6ICJnbGVubi50b21hc3NpQGFiYm90dC5jb218Q2FzbyBkZSBSdWxlIEluOiAyNDE5NjMw
Nl80NDMyNDE1ODZ8UGFjaWVudGUgZGUgVXJnZW5jaWEgcGFyYSBSdWxlIEluIHNlZ3VuIHByb3Rv
Y29sbyIKICAgIH0sCiAgICB7CiAgICAgICJleHRlcm5hbE5hbWUiIDogIkVNQUlMIiwKICAgICAg
InZhbHVlIiA6ICJzZWJhc3RpYW4udGVub3Jpb0BzeW5sYWIuY298Q2FzbyBkZSBSdWxlIEluOiAy
NDE5NjMwNl80NDMyNDE1ODZ8UGFjaWVudGUgZGUgVXJnZW5jaWEgcGFyYSBSdWxlIEluIHNlZ3Vu
IHByb3RvY29sbyIKICAgIH0KICBdLAogICJhcHByb3ZlZCIgOiB0cnVlLAogICJyZXZpZXdlciIg
OiAiQVVUTyIsCiAgImNvbW1lbnRJZHMiIDogWwogICAgMTA1NDQsCiAgICAxMDU1NgogIF0KfQ==
</inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>2</metaDataId>
          <name>Generate Response to Glims</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>617e62e8-b63c-467d-adea-6de94dbb5481</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>if ($(&apos;CDS1&apos;) != null &amp;&amp;$(&apos;CDS1&apos;) !=&apos;&apos; ) {
    var date = DateUtil.getDate(&quot;yyyyMMddHHmmssSSS&quot;, $(&apos;CDS1&apos;));
    var date2 = new Date();
    channelMap.put(&apos;ProcessTimeAck&apos;,date2.getTime()-date.getTime())
}</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">TVNIfF5+XCZ8R2xpbXN8YmF0Y2hDRFN8QWJib3R0fEFsaW5JUSBDRFN8MjAyMDEwMDUyMTI0NTV8
fEFDS3wyMDIwMTAwNTIxMjQ1NXxQfDIuNXwyMDIwMTAwNTIxMjQ1NQ1NU0F8QUF8MjAyMDEwMDUy
MTI0NTV8</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;aux_flag&apos;)&quot; equals 1</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;aux_flag&apos;)</field>
                <condition>EQUALS</condition>
                <values>
                  <string>1</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.1">
          <metaDataId>6</metaDataId>
          <name>Save into Folder</name>
          <properties class="com.mirth.connect.connectors.file.FileDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <scheme>FILE</scheme>
            <host>d:/Production</host>
            <outputPattern>${caseId}_${date.get(&apos;yyyyMdHms&apos;)}_${approved}.hl7</outputPattern>
            <anonymous>true</anonymous>
            <username>anonymous</username>
            <password>anonymous</password>
            <timeout>10000</timeout>
            <keepConnectionOpen>true</keepConnectionOpen>
            <maxIdleTime>0</maxIdleTime>
            <secure>true</secure>
            <passive>true</passive>
            <validateConnection>true</validateConnection>
            <outputAppend>false</outputAppend>
            <errorOnExists>false</errorOnExists>
            <temporary>false</temporary>
            <binary>false</binary>
            <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
            <template>${message.encodedData}</template>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;report&apos;)&quot; does not equal &quot;&quot;</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;report&apos;)</field>
                <condition>NOT_EQUAL</condition>
                <values>
                  <string>&quot;&quot;</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;actions&apos;)&quot; is not blank</name>
                <sequenceNumber>1</sequenceNumber>
                <enabled>true</enabled>
                <operator>AND</operator>
                <field>$(&apos;actions&apos;)</field>
                <condition>NOT_EQUAL</condition>
                <values/>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>File Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>false</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.1">
          <metaDataId>7</metaDataId>
          <name>Destination 2</name>
          <properties class="com.mirth.connect.connectors.tcp.TcpDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <transmissionModeProperties class="com.mirth.connect.plugins.mllpmode.MLLPModeProperties">
              <pluginPointName>MLLP</pluginPointName>
              <startOfMessageBytes>0B</startOfMessageBytes>
              <endOfMessageBytes>1C0D</endOfMessageBytes>
              <useMLLPv2>false</useMLLPv2>
              <ackBytes>06</ackBytes>
              <nackBytes>15</nackBytes>
              <maxRetries>2</maxRetries>
            </transmissionModeProperties>
            <serverMode>false</serverMode>
            <remoteAddress>10.25.68.16</remoteAddress>
            <remotePort>12999</remotePort>
            <overrideLocalBinding>false</overrideLocalBinding>
            <localAddress>0.0.0.0</localAddress>
            <localPort>0</localPort>
            <sendTimeout>5000</sendTimeout>
            <bufferSize>65536</bufferSize>
            <maxConnections></maxConnections>
            <keepConnectionOpen>false</keepConnectionOpen>
            <checkRemoteHost>false</checkRemoteHost>
            <responseTimeout>5000</responseTimeout>
            <ignoreResponse>false</ignoreResponse>
            <queueOnResponseTimeout>false</queueOnResponseTimeout>
            <dataTypeBinary>false</dataTypeBinary>
            <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
            <template>${message.encodedData}</template>
          </properties>
          <transformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>tmp=new XML($(&apos;HL7Head&apos;));

tmp[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;] = tmp[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;].toString();
tmp[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.1&apos;] = &quot;batchCDS&quot;;
tmp[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;] = &quot;Abbott&quot;;
tmp[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;] = &quot;AlinIQ CDS&quot;;
tmp[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;] =  DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.1&apos;] = &quot;OML&quot;
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.2&apos;] = &quot;O21&quot;
tmp[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.3&apos;] = &quot;OML_O21&quot;
tmp[&apos;MSH&apos;][&apos;MSH.10&apos;][&apos;MSH.10.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
tmp[&apos;MSH&apos;][&apos;MSH.17&apos;][&apos;MSH.17.1&apos;] = &apos;NLD&apos;;
tmp[&apos;MSH&apos;][&apos;MSH.18&apos;][&apos;MSH.18.1&apos;] =&apos;8859/1&apos;;
delete tmp[&apos;SPM&apos;];

var countOBR = 1;
var countOBX = 1;
var countNTE = 1;
var countTQ1 = 1;
var countORC = 1;
if($(&apos;report&apos;) != null &amp;&amp; $(&apos;report&apos;) != &quot;&quot;){
  //FILTER COMMENTS
   array_sections = new Array();
   array_sections = $(&apos;report&apos;).split(&apos;\n\n&apos;);
   var arrayLength = array_sections.length;
   for (var i = 0; i &lt; arrayLength; i++) {
   	ArrayComments = new Array();
     ArrayComments = array_sections[i].split(&apos;\n&apos;);
     var arrayLengthComments = ArrayComments.length;
     for (var j = 0; j &lt; arrayLengthComments; j++) {
     	var linecomment = 0;
     	if (j==0){
     		channelMap.put(&apos;jseccion&apos;+i+j,ArrayComments[j])

     		if (ArrayComments[j] == &apos;Anemie_commentaar&apos;){
     			var OBXType = &apos;CDS_Anemie&apos;;
     		     var OBXName =&apos;CDS Anemie comment&apos;;
     		}else{
     		  if (ArrayComments[j]== &apos;Nierschade_commentaar&apos;){
     		    	var OBXType = &apos;CDS_Nierschade&apos;;
     		     var OBXName =&apos;CDS Nierschade comment&apos;;	
     		  }else{
     		  	var OBXType = &apos;CDS_Comment&apos;;
     		     var OBXName =&apos;CDS Comment&apos;;
     		  }
     		}
     		
     		//Type of comment/Type of OBX
     		//switch(ArrayComments[j]){
     		//	case &apos;Anemie_commentaar&apos;:  
     		//	  channelMap.put(&apos;entro&apos;+i+j,ArrayComments[j])
     		//	  var OBXType = &apos;CDS_Anemie&apos;;
     		//	  var OBXName =&apos;CDS Anemie comment&apos;;
     		//	break;
     		//	case &apos;Nierschade_commentaar&apos;:
     		//	  var OBXType = &apos;CDS_Nierschade&apos;;
     		//	  var OBXName =&apos;CDS Nierschade comment&apos;;
     		//	break;
			//	default:
			//	  var OBXType = &apos;CDS_Comment&apos;;
     		//	  var OBXName =&apos;CDS Comment&apos;;
     				
     		//}
     		
     	}else{
     	  if(ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;) &gt;=0){
     	  	//EXTERNAL comment validated
     	  	if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt; 0){
     	  	  var cv_comments = ArrayComments[j].replace(&quot;##EXTERN_F#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;),ArrayComments[j].indexOf(&apos;##INTERN#&apos;)-1);	
     	  	}else{
     	  		if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) == 0){
     	  		  var cv_comments = ArrayComments[j].replace(&quot;##EXTERN_F#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;));	
     	  		
     	  		}else{
     	  		   var cv_comments = ArrayComments[j].replace(&quot;##EXTERN_F#&quot;,&apos;&apos;)
     	  		}
     	  		
     	  	  
     	  	}
     	  	
     	  	createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	  	     createSegment(&apos;OBR&apos;, tmp, countOBR);
	  	     createSegment(&apos;OBX&apos;, tmp, countOBR);
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	  	     tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = OBXType;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = OBXName;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.6&apos;][&apos;OBR.6.1&apos;] = $(&apos;CDSRequest&apos;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = &apos;F&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBR;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] = OBXType;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] = OBXName;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] = cv_comments;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] = &apos;F&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = $(&apos;reviewer&apos;);
	          if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt;= 0){
	          	linecomment = 1;
	            createSegment(&apos;NTE&apos;, tmp, countOBR);
	         	  tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.1&apos;][&apos;NTE.1.1&apos;] = countOBR;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.2&apos;][&apos;NTE.2.1&apos;] = &apos;L&apos;;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.3&apos;][&apos;NTE.3.1&apos;] = ArrayComments[j].substr(ArrayComments[j].indexOf(&apos;##INTERN#&apos;),ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;)).replace(&quot;##INTERN#&quot;,&apos;&apos;);
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.1&apos;] = &apos;XI&apos;;
	            countNTE ++;
	          }
	          countOBR ++;
	          countTQ1 ++;	
	          countOBX ++;	
     	  }
     	  if(ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;) &gt;=0){
     	  	//EXTERNAL comment NOT validated
     	  	if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt; 0){
     	  	  var tv_comments = ArrayComments[j].replace(&quot;##EXTERN_P#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;),ArrayComments[j].indexOf(&apos;##INTERN#&apos;)-1);
     	  	}else{
     	  		if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) == 0){
     	  		  var tv_comments = ArrayComments[j].replace(&quot;##EXTERN_P#&quot;,&apos;&apos;).substr(ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;));	
     	  		
     	  		}else{
     	  		   var tv_comments = ArrayComments[j].replace(&quot;##EXTERN_P#&quot;,&apos;&apos;)
     	  		}
     	  		
     	  	  
     	  	}
     	  	
     	  	createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	  	     createSegment(&apos;OBR&apos;, tmp, countOBR);
	  	     createSegment(&apos;OBX&apos;, tmp, countOBR);
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	  	     tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = OBXType;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = OBXName;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.6&apos;][&apos;OBR.6.1&apos;] = $(&apos;CDSRequest&apos;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = &apos;P&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBR;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] = OBXType;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] = OBXName;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] = tv_comments;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] = &apos;P&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = $(&apos;reviewer&apos;);
	          if (ArrayComments[j].indexOf(&apos;##INTERN#&apos;) &gt;= 0){
	          	linecomment = 1;
	            createSegment(&apos;NTE&apos;, tmp, countOBR);
	         	  tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.1&apos;][&apos;NTE.1.1&apos;] = countOBR;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.2&apos;][&apos;NTE.2.1&apos;] = &apos;L&apos;;
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.3&apos;][&apos;NTE.3.1&apos;] = ArrayComments[j].substr(ArrayComments[j].indexOf(&apos;##INTERN#&apos;),ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;)).replace(&quot;##INTERN#&quot;,&apos;&apos;)
	            tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.1&apos;] = &apos;XI&apos;;
	            countNTE ++;
	          }
	          countOBR ++;
	          countTQ1 ++;	
	          countOBX ++;	
     	  }
     	  if(ArrayComments[j].substr(0,5)==&apos;##INT&apos; &amp;&amp; linecomment == 0){
     	  	//INTERNAL comment
     	  	var internal_comments =ArrayComments[j].replace(&quot;##INTERN#&quot;,&apos;&apos;);
			if (ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;) &gt; 0){
     	  	  var internal_comments = ArrayComments[j].replace(&quot;##INTERN#&quot;,&apos;&apos;).substr(0,ArrayComments[j].indexOf(&apos;##EXTERN_P#&apos;)-11);
     	  	}
     	  	if (ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;) &gt; 0){
     	  	  var internal_comments = ArrayComments[j].replace(&quot;##INTERN#&quot;,&apos;&apos;).substr(0,ArrayComments[j].indexOf(&apos;##EXTERN_F#&apos;)-11);
     	  	}
     	  	
     	  	createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	  	     createSegment(&apos;OBR&apos;, tmp, countOBR);
	  	     createSegment(&apos;OBX&apos;, tmp, countOBR);
	  	     createSegment(&apos;NTE&apos;, tmp, countOBR);
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	  	     tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	  	     tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = OBXType;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = OBXName;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.6&apos;][&apos;OBR.6.1&apos;] = $(&apos;CDSRequest&apos;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = &apos;F&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBR;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] = OBXType;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] = OBXName;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] = &apos;&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] = &apos;L&apos;;
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	          tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = $(&apos;reviewer&apos;);
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.1&apos;][&apos;NTE.1.1&apos;] = countOBR;
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.2&apos;][&apos;NTE.2.1&apos;] = &apos;L&apos;;
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.3&apos;][&apos;NTE.3.1&apos;] =internal_comments;
	          tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.1&apos;] = &apos;XI&apos;;
	          //tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.2&apos;] = &apos;CDS Internal comments&apos;;
	          //tmp[&apos;NTE&apos;][countNTE-1][&apos;NTE.4&apos;][&apos;NTE.4.3&apos;] = &apos;AlinIQ CDS&apos;;
	          countOBR ++;
	          countTQ1 ++;	
	          countNTE ++;	
	          countOBX ++;	
     	  }
     	  
     	}
     
       }
     }
   
     
}
if( $(&apos;actions&apos;)!= null &amp;&amp; $(&apos;actions&apos;) != &quot;&quot;){
 
  var aux_actions = JSON.parse($(&apos;actions&apos;));
  for (w in aux_actions){
  	if (aux_actions[w].externalName == &apos;ADDTEST&apos; ||  aux_actions[w].externalName == &apos;Add&apos;){
  	 ArrayActions = new Array();
      ArrayActions = aux_actions[w].value.split(&apos;,&apos;);
      for (var x = 0; x &lt; ArrayActions.length; x++) {	
	  	 if (x &gt; 0){createSegment(&apos;ORC&apos;, tmp, countORC)};
	  	 createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	      createSegment(&apos;OBR&apos;, tmp, countOBR);
	      tmp[&apos;ORC&apos;][countORC-1] = tmp[&apos;ORC&apos;][0];
	      tmp[&apos;ORC&apos;][countORC-1] [&apos;ORC.2&apos;] = &apos;&apos;;
	      tmp[&apos;ORC&apos;][countORC-1][&apos;ORC.5&apos;][&apos;ORC.5.1&apos;] = &apos;IP&apos;;
	       //tmp[&apos;ORC&apos;][countTQ1-1][&apos;ORC.9&apos;][&apos;ORC.9.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = ArrayActions[x].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = ArrayActions[x].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &apos;L&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.11&apos;][&apos;OBR.11.1&apos;] = &apos;O&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.16&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.12&apos;];
	      
	      countOBR ++;
	      countTQ1 ++;
	      countORC	++;
	   }  
  	}
  	if (aux_actions[w].externalName == &apos;RESULT&apos;){
  	 ArrayActions = new Array();
      ArrayActions = aux_actions[w].value.split(&apos;,&apos;);
      
	  	if (x &gt; 0){createSegment(&apos;ORC&apos;, tmp, countORC)};
	  	 createSegment(&apos;TQ1&apos;, tmp, countTQ1);
	      createSegment(&apos;OBR&apos;, tmp, countOBR);
	      createSegment(&apos;OBX&apos;, tmp, countOBR);
	      tmp[&apos;ORC&apos;][countORC-1] = tmp[&apos;ORC&apos;][0];
	      tmp[&apos;ORC&apos;][countORC-1] [&apos;ORC.2&apos;] = &apos;&apos;;
	      tmp[&apos;ORC&apos;][countORC-1][&apos;ORC.5&apos;][&apos;ORC.5.1&apos;] = &apos;IP&apos;;
	       //tmp[&apos;ORC&apos;][countTQ1-1][&apos;ORC.9&apos;][&apos;ORC.9.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countTQ1;
	      tmp[&apos;TQ1&apos;][countTQ1-1][&apos;TQ1.9&apos;][&apos;TQ1.9.1&apos;] = &apos;R&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;] = countOBR;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.3&apos;][&apos;OBR.3.2&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.2&apos;].toString();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = ArrayActions[0].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = ArrayActions[0].trim();
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.4&apos;][&apos;OBR.4.3&apos;] = &apos;L&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.11&apos;][&apos;OBR.11.1&apos;] = &apos;O&apos;;
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.16&apos;] = tmp[&apos;ORC&apos;][0][&apos;ORC.12&apos;];
	      tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = ArrayActions[2].trim();
	      //tmp[&apos;OBR&apos;][countOBR-1][&apos;OBR.25&apos;][&apos;OBR.25.1&apos;] = ArrayActions[2].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.1&apos;][&apos;OBX.1.1&apos;] = countOBX;
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.2&apos;][&apos;OBX.2.1&apos;] = &apos;ST&apos;;
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.1&apos;] =  ArrayActions[0].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.2&apos;] =  ArrayActions[0].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.3&apos;][&apos;OBX.3.3&apos;] = &quot;AlinIQ CDS&quot;;
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.5&apos;][&apos;OBX.5.1&apos;] =  ArrayActions[1].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.11&apos;][&apos;OBX.11.1&apos;] =  ArrayActions[2].trim();
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.14&apos;][&apos;OBX.14.1&apos;] = DateUtil.getCurrentDate(&quot;yyyyMMddHHmmss&quot;);
	      
	      tmp[&apos;OBX&apos;][countOBX-1][&apos;OBX.16&apos;][&apos;OBX.16.1&apos;] = $(&apos;reviewer&apos;);
	      countOBR ++;
	      countTQ1 ++;
	      countORC	++;
	      countOBX ++;	
	     
  	}


  }
 
}
//map time CDSSentGlimns 
channelMap.put(&apos;CDS5 Sent Glimns&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));
if ($(&apos;CDS1&apos;) != null &amp;&amp;$(&apos;CDS1&apos;) !=&apos;&apos; ) {
    var date = DateUtil.getDate(&quot;yyyyMMddHHmmssSSS&quot;, $(&apos;CDS1&apos;));
    var date2 = new Date();
    channelMap.put(&apos;ProcessTime&apos;,date2.getTime()-date.getTime())
}</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64">TVNIfF5+XCZ8Wm9yZ0RvbWVpbnx8R0xJTVN8QXRhbG1lZGlhbC1BTVNURUxWRUVOfDIwMjAwNDMw
MTMzMTAxKzAyMDB8fE9NTF5PMjFeT01MX08yMXxaRDY3NTU3ODIwfFB8Mi41fHx8fHxOTER8ODg1
OS8xClBJRHwxfHwxMjM0NTY3ODleXl5OTE1JTkJJWkFeTk5OTER8fER1Y2sgLSBHZWx1ayYmR2Vs
dWsmJkR1Y2teQV5eXl5eTHx8MTk0NDEwMjV8Rnx8fFdvcnRlbHN0cmFhdCBXLiA4NiZXb3J0ZWxz
dHJhYXQgVy4mODZeXkR1Y2tzdGFkXl41NTc3WFleTkxeSApQVjF8MXxPCklOMXwxfF5udWxsfDBe
Xl5eTE9DQUx8Wm9yZyBlbiBaZWtlcmhlaWQgWm9yZ3Zlcnpla2VyaW5nZW4qfHx8fHx8fHx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHwxMjM0ODg5MjAyCk9SQ3xOV3xaRDY3NTU3ODIwXzAxfHxaRDY3
NTU3ODIwfHx8Xl5eXl5SfHwyMDIwMDQzMDEzMjgxNCswMjAwfF4mJlBldGVyc2VuXlYufHwwMTEw
MjIzNF4mJk1hbmRqZXMgLSB2YW4gVWl0ZXJ0Xk1KR15eXl5eXlZFS1RJU3x8fHx8MzQwMDkyNzle
QXRhbG1lZGlhbCwgUmVnaW8gQW1zdGVsbGFuZF5MClRRMXwxfHx8fHx8fHxSCk9CUnwxfFpENjc1
NTc4MjBfMDF8fEZUNF5WcmlqIFQ0Xkx8fHx8fHx8T3x8fHx8MDExMDIyMzReJiZNYW5kamVzIC0g
dmFuIFVpdGVydF5NSkdeXl5eXl5WRUtUSVM=</outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>if ($(&apos;CDS1&apos;) != null &amp;&amp;$(&apos;CDS1&apos;) !=&apos;&apos; ) {
    var date = DateUtil.getDate(&quot;yyyyMMddHHmmssSSS&quot;, $(&apos;CDS1&apos;));
    var date2 = new Date();
    channelMap.put(&apos;ProcessTimeAck&apos;,date2.getTime()-date.getTime())
}</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">TVNIfF5+XCZ8R2xpbXN8YmF0Y2hDRFN8QWJib3R0fEFsaW5JUSBDRFN8MjAyMDEwMDUyMTI0NTV8
fEFDS3wyMDIwMTAwNTIxMjQ1NXxQfDIuNXwyMDIwMTAwNTIxMjQ1NQ1NU0F8QUF8MjAyMDEwMDUy
MTI0NTV8</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;aux_flag&apos;)&quot; equals 1</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;aux_flag&apos;)</field>
                <condition>EQUALS</condition>
                <values>
                  <string>1</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>TCP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>false</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>PROCESSTIME</name>
            <type>STRING</type>
            <mappingName>ProcessTime</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>CASEID</name>
            <type>STRING</type>
            <mappingName>caseId</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>PROCESSTIMEACK</name>
            <type>STRING</type>
            <mappingName>ProcessTimeAck</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1700601346541</time>
            <timezone>America/Bogota</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>15</pruneMetaDataDays>
            <pruneContentDays>15</pruneContentDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>5- Save Response Messages</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.mapper.MapperStep version="3.9.1">
              <name>CaseId</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <variable>CaseId</variable>
              <mapping>msg[&apos;caseId&apos;]</mapping>
              <defaultValue></defaultValue>
              <replacements/>
              <scope>CHANNEL</scope>
            </com.mirth.connect.plugins.mapper.MapperStep>
          </elements>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.file.FileDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <scheme>FILE</scheme>
            <host>D:/AlinIQ_CDS8/projects/backup/mirth/response/${date.get(&apos;yyyy&apos;)}/${date.get(&apos;M&apos;)}/${date.get(&apos;yyyyMdd&apos;)}</host>
            <outputPattern>${CaseId}_${date.get(&apos;Hmss&apos;)}.json</outputPattern>
            <anonymous>true</anonymous>
            <username>anonymous</username>
            <password>anonymous</password>
            <timeout>10000</timeout>
            <keepConnectionOpen>true</keepConnectionOpen>
            <maxIdleTime>0</maxIdleTime>
            <secure>true</secure>
            <passive>true</passive>
            <validateConnection>true</validateConnection>
            <outputAppend>false</outputAppend>
            <errorOnExists>false</errorOnExists>
            <temporary>false</temporary>
            <binary>false</binary>
            <charsetEncoding>UTF-8</charsetEncoding>
            <template>${message.rawData}</template>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>File Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>false</enabled>
          <lastModified>
            <time>1606343509940</time>
            <timezone>Europe/Berlin</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>2</pruneMetaDataDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>8bf57726-afe4-4bf2-ab11-a811a2a90173</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>4- Update Repository</name>
      <description>Channel to update the historical data into the CDS repository with the new results recieved.&#xd;
Steps:&#xd;
  1.- The channel read a json file with the list of the episodes of the patient, including the new lab data.&#xd;
  2.- Save into the database (MySQL: jdbc:mysql://localhost:3306/repository; root/1Password) table: &quot;historical&quot;</description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>//Load to historical  19610621CAOA03_3055531.json
var dbConn;
var result;
var result2;
var paramList = new java.util.ArrayList();

//var aux_originalFilename = sourceMap.get(&apos;originalFilename&apos;).replace(&quot;.json&quot;,&quot;&quot;);
//var array_originalFilename = new Array();
//array_originalFilename = aux_originalFilename.split(&quot;_&quot;)
paramList.add(sourceMap.get(&apos;PID&apos;));
paramList.add(sourceMap.get(&apos;PID2&apos;));

//paramList.add(JSON.stringify(connectorMessage.getRawData()));
paramList.add(connectorMessage.getRawData());

var paramList2 = new java.util.ArrayList();
//paramList2.add(JSON.stringify(connectorMessage.getRawData()));
paramList2.add(connectorMessage.getRawData());
paramList2.add(sourceMap.get(&apos;PID&apos;));



try {
	dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;, &apos;jdbc:mysql://localhost:3306/rd_staging&apos;, &apos;root&apos;, &apos;1Password&apos;);
	var expression = &quot;insert into repository.historic1 (PatientID,PatientID2, episodes) values(?,?,?)&quot;
	var expression2 = &quot;update repository.historic1 set episodes = ? where PatientID = ?&quot;;
	//result2 = dbConn.executeUpdate(&quot;delete from repository.historic where patientid =&apos;&quot;+msg[&apos;PID&apos;][&apos;PID.3&apos;][0][&apos;PID.3.1&apos;].toString()+&quot;&apos; &quot;);
	result2 = dbConn.executeUpdate(expression2, paramList2);
	channelMap.put(&apos;result2&apos;,result2)
	if (result2 == 0){
		result = dbConn.executeUpdate(expression, paramList);
	}
} finally {
	if (dbConn) {
		dbConn.close();
	}
}</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>RAW</inboundDataType>
          <outboundDataType>RAW</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>none</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>RAW</inboundDataType>
            <outboundDataType>RAW</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>RAW</inboundDataType>
            <outboundDataType>RAW</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.raw.RawDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.raw.RawBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>RAW</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns/>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>false</enabled>
          <lastModified>
            <time>1603862071218</time>
            <timezone>Europe/Berlin</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>2</pruneMetaDataDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>8744071f-c37e-4836-91e5-09c33fc3fc6c</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>2- Save Incoming Messages</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.mapper.MapperStep version="3.9.1">
              <name>PatientId</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <variable>PatientId</variable>
              <mapping>msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;].toString()</mapping>
              <defaultValue></defaultValue>
              <replacements/>
              <scope>CHANNEL</scope>
            </com.mirth.connect.plugins.mapper.MapperStep>
            <com.mirth.connect.plugins.mapper.MapperStep version="3.9.1">
              <name>OrderId</name>
              <sequenceNumber>1</sequenceNumber>
              <enabled>true</enabled>
              <variable>OrderId</variable>
              <mapping>msg[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString()</mapping>
              <defaultValue></defaultValue>
              <replacements/>
              <scope>CHANNEL</scope>
            </com.mirth.connect.plugins.mapper.MapperStep>
          </elements>
          <inboundTemplate encoding="base64">TVNIfF5+XCZ8R0xJTVN8Y3liZXJsYWI5U1p8MTk1ODA0MDFMQUJUMDl8Y3liZXJsYWI5U1p8MjAy
MDA2MDgxNDA2MTZ8fE9VTF5SMjJ8MDE2NTIxNjM0NTc1fFB8Mi41fHx8TkV8QUx8fDEyNTIKUElE
fDF8fDAxMTA3Nzc0MzBeXl5TWl9JfjAwMDAwMTExMTExMTFeXl5BS19JfjAxMzQ1Njc4Xl5eVERf
SX4xNjYyNzQ4Xl5eQ0FTU0NPTlRST0x+NTgwNDAxTEFCMDFeXl5NZWRpYWxfT3Jnfjk4NzY1Xl5e
UkRfSX45OTk5OTk5OTk5Xl5eQUtfSX45OTk5OTk5OTk5OTleXl5BS19JfHxMQUJPUk9SQVRPUklV
TV5URVNUXlQgTSBCIEJ8fDE5NTgwNDAxfEZ8UGFydG5lcl5eXl5eXkF8fEhBTkRFTFNUUkFBVF40
NF5IZWVtc3RlZGVeXjIxMDJDV15OTHx8MDYxMjM0NTY3OF5eUEh8fHx8fHx8fHx8fE58fHx8fHxO
ClBEMXx8fHwwMTAyNzY4NF5IaW5zYmVyZ2VuIHZhbl5ELl5eXl5eXkdMSU1TCk5URXwxfEx8SGVt
b2ZpbGllfjIwMTcwODE2fn4xMDI4fE9BCk5URXwyfEx8RGFyYS9DRDM4fjIwMTcwNDExfn4xMTU1
fE9BCk5URXwzfEx8QXJjaGl0ZWN0aS1tYWNyb1Ryb3BvbmluZUl+MjAxNjAyMjR+fjE1Njd8T0EK
TlRFfDR8THxBcmNoaXRlY3RpZlQ0QU1DfjIwMTUwOTI0fn4xNzIwfE9BCk5URXw1fEx8Rmx1ZGFy
YWJpbmUtYmVzdHJhYWxkfjIwMTUwODIxfn4xNzU0fE9BCk5URXw2fEx8cmVsZXZhbnRlX2FudGlz
dG9mfjIwMTQwOTAxfn4yMTA4fE9BCk5URXw3fEx8TU5HfjIwMTUwNDEyfn4xODg1fE9BClNQTXwx
fF4yMDA2MDgwNzA4MTYmR0xJTVN8fEVELUNEXkVELUNEXkdMSU1TfHx8fHx8fHwuMDFebWwmbWwm
R0xJTVN8fHx8fDIwMjAwNjA4MTIzMDAwfDIwMjAwNjA4MTIzMDMyfHxZCk9SQ3xTQ3x8SF8yMDA2
MDgxNTQxXkdMSU1TfHxDTXx8Xl5eMjAyMDA2MDgxMjMwMDBeXlJ8fDIwMjAwNjA4MTQwNjE2fHx8
MjMwMF5MQUJPUkFUT1JJVU1eVGVzdF5eXl5eXlNaX0l8TWVkaWFsX09yZ15eXl5eXl5eXl5HTElN
U3x8fHxTWkhPXlNwYWFybmVnYXN0aHVpcyBsb2NhdGllIEhvb2ZkZG9ycF5HTElNU3x8MTAwMDAw
MTE3OV5Qcm9uay1BZG1pcmFhbF5DSl5eXl5Eci5eXlNaX0kK</inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>HL7V2</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.file.FileDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <scheme>FILE</scheme>
            <host>D:/AlinIQ_CDS8/projects/backup/mirth/incoming/${date.get(&apos;yyyy&apos;)}/${date.get(&apos;M&apos;)}/${date.get(&apos;yyyyMdd&apos;)}</host>
            <outputPattern>${PatientId}_${OrderId}_${date.get(&apos;HHmmss&apos;)}.hl7</outputPattern>
            <anonymous>true</anonymous>
            <username>anonymous</username>
            <password>anonymous</password>
            <timeout>10000</timeout>
            <keepConnectionOpen>true</keepConnectionOpen>
            <maxIdleTime>0</maxIdleTime>
            <secure>true</secure>
            <passive>true</passive>
            <validateConnection>true</validateConnection>
            <outputAppend>false</outputAppend>
            <errorOnExists>false</errorOnExists>
            <temporary>false</temporary>
            <binary>false</binary>
            <charsetEncoding>UTF-8</charsetEncoding>
            <template>${message.rawData}</template>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>File Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>RAW</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>false</enabled>
          <lastModified>
            <time>1604406313128</time>
            <timezone>Europe/Berlin</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>2</pruneMetaDataDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</id>
      <nextMetaDataId>7</nextMetaDataId>
      <name>1c - Send to CDS</name>
      <description></description>
      <revision>8</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>d1</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>10</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>/*
var patientid =  msg[&apos;senderReference&apos;].toString().substring(msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;MSH.5.1&gt;&quot;)+9,msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;/MSH.5.1&gt;&quot;))
var datatime = msg[&apos;senderReference&apos;].toString().substring(msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;MSH.7.1&gt;&quot;)+9,msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;/MSH.7.1&gt;&quot;))

channelMap.put(&apos;CASEID&apos;,msg[&apos;caseId&apos;].toString());
channelMap.put(&apos;ORDERID&apos;,msg[&apos;episodes&apos;][0][&apos;episodeId&apos;].toString());
channelMap.put(&apos;PATIENTID&apos;,patientid);
channelMap.put(&apos;DATATIME&apos;,datatime);


var insert = &quot;INSERT INTO statistics.incomming (CASEID,PATIENTID,ORDERID,DATATIME) &quot;;
insert += &quot;VALUES(&apos;&quot;+msg[&apos;caseId&apos;].toString()+&quot;&apos;,&apos;&quot;+patientid+&quot;&apos;,&apos;&quot;+msg[&apos;episodes&apos;][0][&apos;episodeId&apos;].toString()+&quot;&apos;,STR_TO_DATE(&apos;&quot;+datatime+&quot;&apos;,&apos;%Y%m%d%H%i%s&apos;))&quot;;
channelMap.put(&apos;insert&apos;,insert);

dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;, &apos;jdbc:mysql://localhost:3306/rd_staging&apos;, &apos;root&apos;, &apos;1Password&apos;);
result2 = dbConn.executeUpdate(insert);
*/</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64"></inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Send Case to CDS</name>
          <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>false</reattachAttachments>
            </destinationConnectorProperties>
            <host>http://localhost:9023/rdr/interpreter/query?kbcode=TEST1</host>
            <useProxyServer>false</useProxyServer>
            <proxyAddress></proxyAddress>
            <proxyPort></proxyPort>
            <method>post</method>
            <headers class="linked-hash-map"/>
            <parameters class="linked-hash-map"/>
            <useHeadersVariable>false</useHeadersVariable>
            <headersVariable></headersVariable>
            <useParametersVariable>false</useParametersVariable>
            <parametersVariable></parametersVariable>
            <responseXmlBody>false</responseXmlBody>
            <responseParseMultipart>true</responseParseMultipart>
            <responseIncludeMetadata>false</responseIncludeMetadata>
            <responseBinaryMimeTypes>application/.*(?&lt;!json|xml)$|image/.*|video/.*|audio/.*</responseBinaryMimeTypes>
            <responseBinaryMimeTypesRegex>true</responseBinaryMimeTypesRegex>
            <multipart>false</multipart>
            <useAuthentication>false</useAuthentication>
            <authenticationType>Basic</authenticationType>
            <usePreemptiveAuthentication>false</usePreemptiveAuthentication>
            <username></username>
            <password></password>
            <content>${message.encodedData}</content>
            <contentType>application/json</contentType>
            <dataTypeBinary>false</dataTypeBinary>
            <charset>UTF-8</charset>
            <socketTimeout>30000</socketTimeout>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64">ew0KICAiY2FzZUlkIiA6ICIiLA0KICAic2l0ZSIgOiAiY2h1Y2siLA0KICAic2VuZGVyUmVmZXJl
bmNlIiA6ICI8SEw3TWVzc2FnZT48TVNIPjxNU0guMT58PC9NU0guMT48TVNILjI+Xn5cXCZhbXA7
PC9NU0guMj48TVNILjM+PE1TSC4zLjE+R2xpbXM8L01TSC4zLjE+PC9NU0guMz48TVNILjQ+PE1T
SC40LjE+Y3liZXJsYWI5U1o8L01TSC40LjE+PC9NU0guND48TVNILjU+PE1TSC41LjE+MTk5OTAy
MDFMRUVTMjE8L01TSC41LjE+PC9NU0guNT48TVNILjY+PE1TSC42LjE+Y3liZXJsYWI5U1o8L01T
SC42LjE+PC9NU0guNj48TVNILjc+PE1TSC43LjE+MjAyMDA1MjAwOTEzMzE8L01TSC43LjE+PC9N
U0guNz48TVNILjgvPjxNU0guOT48TVNILjkuMT5PVUw8L01TSC45LjE+PE1TSC45LjI+UjIyPC9N
U0guOS4yPjwvTVNILjk+PE1TSC4xMD48TVNILjEwLjE+MDcwMDIxMzA4Mjc5PC9NU0guMTAuMT48
L01TSC4xMD48TVNILjExPjxNU0guMTEuMT5QPC9NU0guMTEuMT48L01TSC4xMT48TVNILjEyPjxN
U0guMTIuMT4yLjU8L01TSC4xMi4xPjwvTVNILjEyPjxNU0guMTMvPjxNU0guMTQvPjxNU0guMTU+
PE1TSC4xNS4xPk5FPC9NU0guMTUuMT48L01TSC4xNT48TVNILjE2PjxNU0guMTYuMT5BTDwvTVNI
LjE2LjE+PC9NU0guMTY+PE1TSC4xNy8+PE1TSC4xOD48TVNILjE4LjE+MTI1MjwvTVNILjE4LjE+
PC9NU0guMTg+PC9NU0g+PFBJRD48UElELjE+PFBJRC4xLjE+MTwvUElELjEuMT48L1BJRC4xPjxQ
SUQuMi8+PFBJRC4zPjxQSUQuMy4xPjEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5HTElNUzwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMTIzNDU2
NzwvUElELjMuMT48UElELjMuMi8+PFBJRC4zLjMvPjxQSUQuMy40PktHX0k8L1BJRC4zLjQ+PC9Q
SUQuMz48UElELjM+PFBJRC4zLjE+MDEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5LR19JPC9QSUQuMy40PjwvUElELjM+PFBJRC4zPjxQSUQuMy4xPjAxMjM0NTY3
ODk8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5TWl9JPC9QSUQuMy40Pjwv
UElELjM+PFBJRC4zPjxQSUQuMy4xPjA5ODc2NTQzPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMu
My8+PFBJRC4zLjQ+VERfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMDAwMDAw
MDA8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5OTE1JTkJJWkE8L1BJRC4z
LjQ+PC9QSUQuMz48UElELjM+PFBJRC4zLjE+MDAwMDAwMDAwPC9QSUQuMy4xPjxQSUQuMy4yLz48
UElELjMuMy8+PFBJRC4zLjQ+TUxfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT44
NzY1NDMyPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMuMy8+PFBJRC4zLjQ+Q0FTU0NPTlRST0w8
L1BJRC4zLjQ+PC9QSUQuMz48UElELjQvPjxQSUQuNT48UElELjUuMT5MZWVzbmFhbSB2YW48L1BJ
RC41LjE+PFBJRC41LjI+UElFVEpFPC9QSUQuNS4yPjxQSUQuNS4zPlMuIE4uPC9QSUQuNS4zPjwv
UElELjU+PFBJRC42Lz48UElELjc+PFBJRC43LjE+MTk5OTAyMDE8L1BJRC43LjE+PC9QSUQuNz48
UElELjg+PFBJRC44LjE+RjwvUElELjguMT48L1BJRC44PjxQSUQuOS8+PFBJRC4xMC8+PFBJRC4x
MT48UElELjExLjE+U3Vpa2Vyc3RyYWF0PC9QSUQuMTEuMT48UElELjExLjI+MTE8L1BJRC4xMS4y
PjxQSUQuMTEuMz5EdWNrc3RhZDwvUElELjExLjM+PFBJRC4xMS40Lz48UElELjExLjU+MTEyMkFC
PC9QSUQuMTEuNT48UElELjExLjY+Tkw8L1BJRC4xMS42PjwvUElELjExPjxQSUQuMTIvPjxQSUQu
MTM+PFBJRC4xMy4xPjAyNTU1OTk5OTk8L1BJRC4xMy4xPjxQSUQuMTMuMi8+PFBJRC4xMy4zPlBI
PC9QSUQuMTMuMz48L1BJRC4xMz48UElELjE0Lz48UElELjE1Lz48UElELjE2Lz48UElELjE3Lz48
UElELjE4Lz48UElELjE5Lz48UElELjIwLz48UElELjIxLz48UElELjIyLz48UElELjIzLz48UElE
LjI0PjxQSUQuMjQuMT5OPC9QSUQuMjQuMT48L1BJRC4yND48UElELjI1Lz48UElELjI2Lz48UElE
LjI3Lz48UElELjI4Lz48UElELjI5Lz48UElELjMwPjxQSUQuMzAuMT5OPC9QSUQuMzAuMT48L1BJ
RC4zMD48L1BJRD48UEQxPjxQRDEuMS8+PFBEMS4yLz48UEQxLjMvPjxQRDEuND48UEQxLjQuMT4w
MTAyMzg2ODwvUEQxLjQuMT48UEQxLjQuMj5BYmJla2VyazwvUEQxLjQuMj48UEQxLjQuMz5FLk0u
PC9QRDEuNC4zPjxQRDEuNC40Lz48UEQxLjQuNS8+PFBEMS40LjYvPjxQRDEuNC43Lz48UEQxLjQu
OC8+PFBEMS40Ljk+R0xJTVM8L1BEMS40Ljk+PC9QRDEuND48L1BEMT48UFYxPjxQVjEuMT48UFYx
LjEuMT4xPC9QVjEuMS4xPjwvUFYxLjE+PFBWMS4yPjxQVjEuMi4xPkk8L1BWMS4yLjE+PC9QVjEu
Mj48UFYxLjM+PFBWMS4zLjE+SEFaSUNVPC9QVjEuMy4xPjxQVjEuMy4yPjUyMTcxNzwvUFYxLjMu
Mj48UFYxLjMuMy8+PFBWMS4zLjQvPjxQVjEuMy41Lz48UFYxLjMuNi8+PFBWMS4zLjcvPjxQVjEu
My44Lz48UFYxLjMuOS8+PFBWMS4zLjEwLz48UFYxLjMuMTE+R0xJTVM8L1BWMS4zLjExPjwvUFYx
LjM+PFBWMS40Lz48UFYxLjUvPjxQVjEuNi8+PFBWMS43Lz48UFYxLjgvPjxQVjEuOS8+PFBWMS4x
MC8+PFBWMS4xMS8+PFBWMS4xMi8+PFBWMS4xMy8+PFBWMS4xNC8+PFBWMS4xNS8+PFBWMS4xNi8+
PFBWMS4xNy8+PFBWMS4xOC8+PFBWMS4xOT48UFYxLjE5LjE+NTYyMzIwNjM8L1BWMS4xOS4xPjwv
UFYxLjE5PjxQVjEuMjAvPjxQVjEuMjEvPjxQVjEuMjIvPjxQVjEuMjMvPjxQVjEuMjQvPjxQVjEu
MjUvPjxQVjEuMjYvPjxQVjEuMjcvPjxQVjEuMjgvPjxQVjEuMjkvPjxQVjEuMzAvPjxQVjEuMzEv
PjxQVjEuMzIvPjxQVjEuMzMvPjxQVjEuMzQvPjxQVjEuMzUvPjxQVjEuMzYvPjxQVjEuMzcvPjxQ
VjEuMzgvPjxQVjEuMzkvPjxQVjEuNDAvPjxQVjEuNDEvPjxQVjEuNDIvPjxQVjEuNDMvPjxQVjEu
NDQ+PFBWMS40NC4xPjIwMjAwMzIxMTgxMzA1PC9QVjEuNDQuMT48L1BWMS40ND48UFYxLjQ1PjxQ
VjEuNDUuMT4yMDIwMDQwODEwMTUwMDwvUFYxLjQ1LjE+PC9QVjEuNDU+PC9QVjE+PFBWMT48UFYx
LjE+PFBWMS4xLjE+MTwvUFYxLjEuMT48L1BWMS4xPjxQVjEuMj48UFYxLjIuMT5JPC9QVjEuMi4x
PjwvUFYxLjI+PFBWMS4zPjxQVjEuMy4xPkhBWklDVTwvUFYxLjMuMT48UFYxLjMuMj41MjE3MTc8
L1BWMS4zLjI+PFBWMS4zLjMvPjxQVjEuMy40Lz48UFYxLjMuNS8+PFBWMS4zLjYvPjxQVjEuMy43
Lz48UFYxLjMuOC8+PFBWMS4zLjkvPjxQVjEuMy4xMC8+PFBWMS4zLjExPkdMSU1TPC9QVjEuMy4x
MT48L1BWMS4zPjxQVjEuNC8+PFBWMS41Lz48UFYxLjYvPjxQVjEuNy8+PFBWMS44Lz48UFYxLjkv
PjxQVjEuMTAvPjxQVjEuMTEvPjxQVjEuMTIvPjxQVjEuMTMvPjxQVjEuMTQvPjxQVjEuMTUvPjxQ
VjEuMTYvPjxQVjEuMTcvPjxQVjEuMTgvPjxQVjEuMTk+PFBWMS4xOS4xPjU2MjMyMDYzPC9QVjEu
MTkuMT48L1BWMS4xOT48UFYxLjIwLz48UFYxLjIxLz48UFYxLjIyLz48UFYxLjIzLz48UFYxLjI0
Lz48UFYxLjI1Lz48UFYxLjI2Lz48UFYxLjI3Lz48UFYxLjI4Lz48UFYxLjI5Lz48UFYxLjMwLz48
UFYxLjMxLz48UFYxLjMyLz48UFYxLjMzLz48UFYxLjM0Lz48UFYxLjM1Lz48UFYxLjM2Lz48UFYx
LjM3Lz48UFYxLjM4Lz48UFYxLjM5Lz48UFYxLjQwLz48UFYxLjQxLz48UFYxLjQyLz48UFYxLjQz
Lz48UFYxLjQ0PjxQVjEuNDQuMT4yMDIwMDMyMTE4MTMwNTwvUFYxLjQ0LjE+PC9QVjEuNDQ+PFBW
MS40NT48UFYxLjQ1LjE+MjAyMDA0MDgxMDE1MDA8L1BWMS40NS4xPjwvUFYxLjQ1PjwvUFYxPjxT
UE0+PFNQTS4xPjxTUE0uMS4xPjE8L1NQTS4xLjE+PC9TUE0uMT48U1BNLjI+PFNQTS4yLjEvPjxT
UE0uMi4yPjxTUE0uMi4yLjE+MjAwMzI0MDQwNjAyPC9TUE0uMi4yLjE+PFNQTS4yLjIuMj5HTElN
UzwvU1BNLjIuMi4yPjwvU1BNLjIuMj48L1NQTS4yPjxTUE0uMy8+PFNQTS40PjxTUE0uNC4xPlZC
Q0FQPC9TUE0uNC4xPjxTUE0uNC4yPlZvbGJsb2VkIENhcGlsbGFpcjwvU1BNLjQuMj48U1BNLjQu
Mz5HTElNUzwvU1BNLjQuMz48L1NQTS40PjxTUE0uNS8+PFNQTS42Lz48U1BNLjcvPjxTUE0uOC8+
PFNQTS45Lz48U1BNLjEwLz48U1BNLjExLz48U1BNLjEyPjxTUE0uMTIuMT4wPC9TUE0uMTIuMT48
U1BNLjEyLjI+PFNQTS4xMi4yLjE+bWw8L1NQTS4xMi4yLjE+PFNQTS4xMi4yLjI+bWw8L1NQTS4x
Mi4yLjI+PFNQTS4xMi4yLjM+R0xJTVM8L1NQTS4xMi4yLjM+PC9TUE0uMTIuMj48L1NQTS4xMj48
U1BNLjEzLz48U1BNLjE0Lz48U1BNLjE1Lz48U1BNLjE2Lz48U1BNLjE3PjxTUE0uMTcuMT4yMDIw
MDMyNDEzNTMyNzwvU1BNLjE3LjE+PC9TUE0uMTc+PFNQTS4xOD48U1BNLjE4LjE+MjAyMDAzMjQx
MzUzMjc8L1NQTS4xOC4xPjwvU1BNLjE4PjxTUE0uMTkvPjxTUE0uMjA+PFNQTS4yMC4xPlk8L1NQ
TS4yMC4xPjwvU1BNLjIwPjwvU1BNPjxPUkM+PE9SQy4xPjxPUkMuMS4xPlNDPC9PUkMuMS4xPjwv
T1JDLjE+PE9SQy4yLz48T1JDLjM+PE9SQy4zLjE+RV8yMDAzMjQwMzI4PC9PUkMuMy4xPjxPUkMu
My4yPkdMSU1TPC9PUkMuMy4yPjwvT1JDLjM+PE9SQy40Lz48T1JDLjU+PE9SQy41LjE+Q008L09S
Qy41LjE+PC9PUkMuNT48T1JDLjYvPjxPUkMuNz48T1JDLjcuMS8+PE9SQy43LjIvPjxPUkMuNy4z
Lz48T1JDLjcuND4yMDIwMDMyNDEzNTMyNzwvT1JDLjcuND48T1JDLjcuNS8+PE9SQy43LjY+Ujwv
T1JDLjcuNj48L09SQy43PjxPUkMuOC8+PE9SQy45PjxPUkMuOS4xPjIwMjAwNTIwMDkxMzMxPC9P
UkMuOS4xPjwvT1JDLjk+PE9SQy4xMC8+PE9SQy4xMS8+PE9SQy4xMj48T1JDLjEyLjE+MTAwMDAw
MDc2MDwvT1JDLjEyLjE+PE9SQy4xMi4yPkJFTk5FUjwvT1JDLjEyLjI+PE9SQy4xMi4zPlBNLmlu
dGVuc2l2aXN0PC9PUkMuMTIuMz48T1JDLjEyLjQvPjxPUkMuMTIuNS8+PE9SQy4xMi42Lz48T1JD
LjEyLjcvPjxPUkMuMTIuOC8+PE9SQy4xMi45PlNaX0k8L09SQy4xMi45PjwvT1JDLjEyPjxPUkMu
MTM+PE9SQy4xMy4xPkhBWklDVTwvT1JDLjEzLjE+PE9SQy4xMy4yLz48T1JDLjEzLjMvPjxPUkMu
MTMuNC8+PE9SQy4xMy41Lz48T1JDLjEzLjYvPjxPUkMuMTMuNy8+PE9SQy4xMy44Lz48T1JDLjEz
LjkvPjxPUkMuMTMuMTAvPjxPUkMuMTMuMTE+R0xJTVM8L09SQy4xMy4xMT48L09SQy4xMz48T1JD
LjE0Lz48T1JDLjE1Lz48T1JDLjE2Lz48T1JDLjE3PjxPUkMuMTcuMT5LR0VHPC9PUkMuMTcuMT48
T1JDLjE3LjI+RGVjZW50cmFhbCBTcGFhcm5lZ2FzdGh1aXMgbG9jYXRpZSBIYWFybGVtIHp1aWQ8
L09SQy4xNy4yPjxPUkMuMTcuMz5HTElNUzwvT1JDLjE3LjM+PC9PUkMuMTc+PE9SQy4xOC8+PE9S
Qy4xOT48T1JDLjE5LjE+MTAwMDAwMTE3OTwvT1JDLjE5LjE+PE9SQy4xOS4yPlByb25rLUFkbWly
YWFsPC9PUkMuMTkuMj48T1JDLjE5LjM+Q0o8L09SQy4xOS4zPjxPUkMuMTkuNC8+PE9SQy4xOS41
Lz48T1JDLjE5LjYvPjxPUkMuMTkuNz5Eci48L09SQy4xOS43PjxPUkMuMTkuOC8+PE9SQy4xOS45
PlNaX0k8L09SQy4xOS45PjwvT1JDLjE5PjwvT1JDPjwvSEw3TWVzc2FnZT4iLA0KICAiYXBwcm92
ZWQiIDogdHJ1ZQ0KfQ==</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>HTTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>false</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>CASEID</name>
            <type>STRING</type>
            <mappingName>Case</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1699380752480</time>
            <timezone>America/Bogota</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>7</pruneMetaDataDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>be8c75bc-37f7-48dc-a26e-b9e50c6f285a</id>
            <name>PKS CDS</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075443</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>false</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>6df4f01c-e2ee-400b-8f23-547df6db1358</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>e587470e-5f72-4c81-842e-3e1339eb1201</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>00680d42-b755-42ec-9957-08ae467c47c9</string>
              <string>838cdb58-cd3d-4797-8dd6-b4121788e3d2</string>
              <string>7d58b0b3-0cef-4430-b961-132df6a81f2d</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>986eb897-48ee-4c13-a49e-5fe992750df4</string>
              <string>05c4aca3-6525-46ce-bbe6-f24587a6b797</string>
              <string>4ad0d0dd-e291-4499-a9d5-dbff3da6a6eb</string>
              <string>6b208dbe-9531-4997-80d8-7925e426efc3</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>1f49c0be-e926-4cf0-be12-2ff8d87a5881</id>
                <name>ConnectMySQL</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480511</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function ConnectMySQL() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/aipdata&apos;,&apos;root&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;
}

function ConnectMySQLSAS() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3306/cds&apos;,&apos;root&apos;,&apos;password&apos;);

return dbConn;	
}

function ConnectMySQLHaematology() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/haematology&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);

return dbConn;	

}

function ConnectMySQLMI3() {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;,&apos;jdbc:mysql://localhost:3369/mi3&apos;,&apos;mirth&apos;,&apos;DeliveryTe@m&apos;);
return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>ecf96a6d-b5d6-4c13-b16a-c31a253cb9bb</id>
                <name>Get_CDS_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480823</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_CDS_Connection() {
var dbConn = $gc(&apos;dbConn&apos;);

if (!dbConn || dbConn.getConnection().isClosed()) {
var dbConn = DatabaseConnectionFactory.createDatabaseConnection($(&apos;CDS_Driver_Name&apos;), $(&apos;CDS_DB_URL&apos;), $(&apos;CDS_DB_UserName&apos;), $(&apos;CDS_DB_Password&apos;));
$gc(&apos;dbConn&apos;, dbConn);
}

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>8e116c30-555e-4d03-97c8-0dd649526eda</id>
                <name>Get_Latest_Episode_For_EpisodeID</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481261</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
				function get_latest_episode_for_episodeID(episodeIDList) {
				  var dbConn = Get_CDS_Connection();
				  var sql = &quot;SELECT * FROM cds_data WHERE EpisodeID = ? ORDER BY EpisodeDateTime DESC LIMIT 1&quot;;
				  var latestEpisode = &quot;&quot;;
				  	try {
				  		var latestEpisode = dbConn.executeCachedQuery(sql, episodeIDList);
				  	} catch (exception) {
				  		logger.error(&quot;Error when inserting data: &quot; + exception);
				  	} finally {
				  		dbConn.close();
				  	}
				  return latestEpisode;
				}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5c27c0de-56d5-4eb9-bc17-a5ad0805f34a</id>
                <name>Insert_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075490</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>// Insert CDS data into rd_staging.cds_data from flat file source

function Insert_CDS_Data(PatientID,PatientFamilyName,PatientGivenName,PatientTitle,PatientDOB,PatientSex,PatientStreetAddress,PatientCity,PatientPostalCode,PatientState,PatientCountry,PatientStatus,PatientPregnancyFlag,PatientFastingFlag,EpisodeID,EpisodeOrderedTests, EpisodeDateTime,EpisodeClinicalNotes,AccountType,AccountClass,BillTo,BillingAddress,PatientPublicHealthIdentifier,EpisodePublicScheduleCode,PatientPrivateHealthFundName,PatientPrivateHealthFundID,ReqPhysicianID,ReqPhysicianName,ReqPhysicianSpeciality,ReqPhysicianDeliveryAddress,SugeryName,SurgeryCode,SurgeryAddress,SurgeryPostalCode,CopyPhysicianIDList,CopyPhysicianNameList,PanelIndicator,PanelID,PanelName,SampleID,SampleFluidType,SampleOriginLocation,SampleOriginSubLocation,SampleCollectionDateTime,SampleCollectionMethod,TestSiteSampleReceivedDateTime,TestLISCode,TestLISName,TestValue,TestNormalRange,TestUnits,TestPriority,TestDepartment,TestInstrument,TestRequestSite,TestSite,TestType,AbnormalFlag,TestOrderedDateTime,TestAnalyzerCompletionDateTime,TestResultFirstReviewedDateTime,TestResultReleasedDateTime)
{

	try {
		var dbConn = Get_CDS_Connection();

		var _returnValue = 1;
		var _sqlQuery = &quot;CALL rd_staging.rdInsCDSData (&apos;&quot; + PatientID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFamilyName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientGivenName + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientTitle + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientDOB + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientSex + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStreetAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCity + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPostalCode + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientState + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientCountry + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientStatus + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPregnancyFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientFastingFlag + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeID + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + EpisodeOrderedTests + &quot;&apos;&quot;
									+ &quot;, &quot; + buildStringIfNotNull(EpisodeDateTime) +&quot;, \
									&apos;&quot; + EpisodeClinicalNotes + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountType + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + AccountClass + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillTo + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + BillingAddress + &quot;&apos;&quot;+&quot;, \
									&apos;&quot; + PatientPublicHealthIdentifier + &quot;&apos;, \
									&apos;&quot; + EpisodePublicScheduleCode + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundName + &quot;&apos;, \
									&apos;&quot; + PatientPrivateHealthFundID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianID + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianName + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianSpeciality + &quot;&apos;, \
									&apos;&quot; + ReqPhysicianDeliveryAddress + &quot;&apos;, \
									&apos;&quot; + SugeryName + &quot;&apos;, \
									&apos;&quot; + SurgeryCode + &quot;&apos;, \
									&apos;&quot; + SurgeryAddress + &quot;&apos;, \
									&apos;&quot; + SurgeryPostalCode + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianIDList + &quot;&apos;, \
									&apos;&quot; + CopyPhysicianNameList + &quot;&apos;, \
									&apos;&quot; + PanelIndicator + &quot;&apos;, \
									&apos;&quot; + PanelID + &quot;&apos;, \
									&apos;&quot; + PanelName + &quot;&apos;, \
									&apos;&quot; + SampleID + &quot;&apos;, \
									&apos;&quot; + SampleFluidType + &quot;&apos;, \
									&apos;&quot; + SampleOriginLocation + &quot;&apos;, \
									&apos;&quot; + SampleOriginSubLocation + &quot;&apos;, \
									&apos;&quot; + SampleCollectionDateTime + &quot;&apos;, \
									&apos;&quot; + SampleCollectionMethod + &quot;&apos;, \
									&apos;&quot; + TestSiteSampleReceivedDateTime + &quot;&apos;, \
									&apos;&quot; + TestLISCode + &quot;&apos;, \
									&apos;&quot; + TestLISName + &quot;&apos;, \
									&apos;&quot; + TestValue + &quot;&apos;, \
									&apos;&quot; + TestNormalRange + &quot;&apos;, \
									&apos;&quot; + TestUnits + &quot;&apos;, \
									&apos;&quot; + TestPriority + &quot;&apos;, \
									&apos;&quot; + TestDepartment + &quot;&apos;, \
									&apos;&quot; + TestInstrument + &quot;&apos;, \
									&apos;&quot; + TestRequestSite + &quot;&apos;, \
									&apos;&quot; + TestSite + &quot;&apos;, \
									&apos;&quot; + TestType + &quot;&apos;, \
									&apos;&quot; + AbnormalFlag + &quot;&apos;, \
									&apos;&quot; + TestOrderedDateTime + &quot;&apos;, \
									&apos;&quot; + TestAnalyzerCompletionDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultFirstReviewedDateTime + &quot;&apos;, \
									&apos;&quot; + TestResultReleasedDateTime + &quot;&apos;)&quot;;

		var _sqlResult = dbConn.executeCachedQuery(_sqlQuery);

		if(_sqlResult.next()) {
			_returnValue = _sqlResult.getInt(1);
			_returnValue = parseInt(_returnValue, 10);
		}
		return _returnValue;
	}
	catch(ex) {
		logger.error(&quot;PKS - Insert_CDS_Data - Exception: &quot;+ ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>c86e8913-8152-422e-aa5e-f63f7c25d279</id>
                <name>Insert_RippleDown_Response</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481788</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function insert_rippleDown_response(patientID, patientFamilyName, patientGivenName, episodeId, episodeDateTime, testLISCode, testLISName, testValue, processed_YN) {
				      var params = new java.util.ArrayList();
			    	  params.add(patientID);
			    	  params.add(patientFamilyName);
			    	  params.add(patientGivenName);
			    	  params.add(episodeDateTime);
			    	  params.add(episodeId);
			    	  params.add(testLISCode);
			    	  params.add(testLISName);
			    	  params.add(testValue);
			    	  params.add(processed_YN);

				      var dbConn = Get_CDS_Connection();
				      var sql = &quot;INSERT INTO cds_data(PatientID, PatientFamilyName, PatientGivenName, EpisodeDateTime, EpisodeID, testLISCode, TestLISName, TestValue, Processed_YN) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;
				      try {
				        var result = dbConn.executeUpdate(sql, params);
				      } catch (exception) {
				        logger.error(&quot;Error when inserting data: &quot; + exception);
				      } finally {
				        dbConn.close();
				      }
				  }</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>519f869e-22ee-4082-8871-acd8b67e9240</id>
                <name>Peek_CDS_Data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481616</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Check_Unprocessed_Data() {
	var dbConn = Get_CDS_Connection();
	var rowCount = 0;

	var sqlResult = null;
	try {
		var returnValue = 1;

		var sqlQuery = &quot;call rd_staging.rdSelCDSCount()&quot;;

		logger.trace(&quot;SQL &quot; + sqlQuery);

		sqlResult = dbConn.executeCachedQuery(sqlQuery);
		if (sqlResult.next()) {
			rowCount = sqlResult.getInt(&apos;StatusCode&apos;);
		}
	} finally {
		// Do nothing right now...
		if  (sqlResult != null) {
			//sqlResult.close();
		}
	}
	return rowCount;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>526bcc34-e16b-48cb-98b6-ca763bad259c</id>
                <name>Records_To_Process</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075722</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function recordsToProcess() {	
	if (Check_Unprocessed_Data() &gt; 0) {
		return true;
	} else {
		return false;
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0f0fea61-ff2b-470f-9452-4d395117df82</id>
                <name>Select_CDS_Data</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075813</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>63d95f2f-ff22-411b-b710-6656d0bbfcff</id>
                <name>Select_CDS_Data2</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482055</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data2() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 2&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>9fc30f67-4ba0-449d-a9b9-0fadd1c03d6f</id>
                <name>Select_CDS_Data3</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480274</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data3() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 3&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6cb0a53a-f748-41ee-8353-7a05b929daac</id>
                <name>Select_CDS_Data4</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481087</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data4() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 4&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>cedb4f76-e38e-4082-98e2-2a6e35af2a44</id>
                <name>Select_CDS_Data5</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597482147</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Select_CDS_Data5() {
	var currEpisodeID = &quot;&quot;;
	var currEpisode;
	var currPatientID = &quot;&quot;;
	var currStatus = &quot;&quot;;
	var episodes = [];
	var episodeSize = 0;
	var resp;

	var dbConn = Get_CDS_Connection();
	try {
		var sqlQuery = &quot;call rd_staging.rdSelCDSData()&quot;;

		var sqlResult = dbConn.executeCachedQuery(sqlQuery);
		// We can assume there will always be at least one row, even if there are no records to process
		// Let&apos;s check the result set
		var colCount = sqlResult.getMetaData().getColumnCount();
		// We&apos;re checking for the column count, if it is 2 then it&apos;s just a return code and message

		if (colCount == 2) {
			sqlResult.next();
			logger.trace(&quot;PKS - Select_CDS_Data - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			return false;
		} else {
			while (sqlResult.next()) {
				tmpEpisodeID		               = sqlResult.getString(&quot;EpisodeID&quot;);
				tmpEpisodeOrderedTests             = sqlResult.getString(&quot;EpisodeOrderedTests&quot;);
				tmpPatientID		               = sqlResult.getString(&quot;PatientID&quot;);
				tmpPatientSurname	               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpEpisodeDateTime   	          = sqlResult.getString(&quot;EpisodeDateTime&quot;);
				tmpPatientDOB		               = sqlResult.getString(&quot;PatientDOB&quot;);
				tmpTestSite		               = sqlResult.getString(&quot;TestSite&quot;);
				tmpPatientFamilyName               = sqlResult.getString(&quot;PatientFamilyName&quot;);
				tmpPatientGivenName                = sqlResult.getString(&quot;PatientGivenName&quot;);
				tmpPatientTitle                    = sqlResult.getString(&quot;PatientTitle&quot;);
				tmpPatientSex                      = sqlResult.getString(&quot;PatientSex&quot;);
				tmpPatientStreetAddress            = sqlResult.getString(&quot;PatientStreetAddress&quot;);
				tmpPatientCity                     = sqlResult.getString(&quot;PatientCity&quot;);
				tmpPatientPostalCode               = sqlResult.getString(&quot;PatientPostalCode&quot;);
				tmpPatientState                    = sqlResult.getString(&quot;PatientState&quot;);
				tmpPatientCountry                  = sqlResult.getString(&quot;PatientCountry&quot;);
				tmpPatientStatus                   = sqlResult.getString(&quot;PatientStatus&quot;);
				tmpPatientPregnancyFlag            = sqlResult.getString(&quot;PatientPregnancyFlag&quot;);
				tmpPatientFastingFlag              = sqlResult.getString(&quot;PatientFastingFlag&quot;);
				tmpEpisodeClinicalNotes            = sqlResult.getString(&quot;EpisodeClinicalNotes&quot;);
				tmpAccountType                     = sqlResult.getString(&quot;AccountType&quot;);
				tmpAccountClass                    = sqlResult.getString(&quot;AccountClass&quot;);
				tmpBillTo                          = sqlResult.getString(&quot;BillTo&quot;);
				tmpBillingAddress                  = sqlResult.getString(&quot;BillingAddress&quot;);
				tmpPatientPublicHealthIdentifier   = sqlResult.getString(&quot;PatientPublicHealthIdentifier&quot;);
				tmpEpisodePublicScheduleCode       = sqlResult.getString(&quot;EpisodePublicScheduleCode&quot;);
				tmpPatientPrivateHealthFundName    = sqlResult.getString(&quot;PatientPrivateHealthFundName&quot;);
				tmpPatientPrivateHealthFundID      = sqlResult.getString(&quot;PatientPrivateHealthFundID&quot;);
				tmpReqPhysicianID                  = sqlResult.getString(&quot;ReqPhysicianID&quot;);
				tmpReqPhysicianName                = sqlResult.getString(&quot;ReqPhysicianName&quot;);
				tmpReqPhysicianSpeciality          = sqlResult.getString(&quot;ReqPhysicianSpeciality&quot;);
				tmpReqPhysicianDeliveryAddress     = sqlResult.getString(&quot;ReqPhysicianDeliveryAddress&quot;);
				tmpSugeryName                      = sqlResult.getString(&quot;SugeryName&quot;);
				tmpSurgeryCode                     = sqlResult.getString(&quot;SurgeryCode&quot;);
				tmpSurgeryAddress                  = sqlResult.getString(&quot;SurgeryAddress&quot;);
				tmpSurgeryPostalCode               = sqlResult.getString(&quot;SurgeryPostalCode&quot;);
				tmpCopyPhysicianIDList             = sqlResult.getString(&quot;CopyPhysicianIDList&quot;);
				tmpCopyPhysicianNameList           = sqlResult.getString(&quot;CopyPhysicianNameList&quot;);
				tmpPanelIndicator                  = sqlResult.getString(&quot;PanelIndicator&quot;);
				tmpPanelID                         = sqlResult.getString(&quot;PanelID&quot;);
				tmpPanelName                       = sqlResult.getString(&quot;PanelName&quot;);
				tmpSampleID                        = sqlResult.getString(&quot;SampleID&quot;);
				tmpSampleFluidType                 = sqlResult.getString(&quot;SampleFluidType&quot;);
				tmpSampleOriginLocation            = sqlResult.getString(&quot;SampleOriginLocation&quot;);
				tmpSampleOriginSubLocation         = sqlResult.getString(&quot;SampleOriginSubLocation&quot;);
				tmpSampleCollectionDateTime        = sqlResult.getString(&quot;SampleCollectionDateTime&quot;);
				tmpSampleCollectionMethod          = sqlResult.getString(&quot;SampleCollectionMethod&quot;);
				tmpTestSiteSampleReceivedDateTime  = sqlResult.getString(&quot;TestSiteSampleReceivedDateTime&quot;);
				tmpTestPriority                    = sqlResult.getString(&quot;TestPriority&quot;);
				tmpTestDepartment                  = sqlResult.getString(&quot;TestDepartment&quot;);
				tmpTestInstrument                  = sqlResult.getString(&quot;TestInstrument&quot;);
				tmpTestRequestSite                 = sqlResult.getString(&quot;TestRequestSite&quot;);
				tmpTestSite                        = sqlResult.getString(&quot;TestSite&quot;);
				tmpTestType                        = sqlResult.getString(&quot;TestType&quot;);
				tmpAbnormalFlag                    = sqlResult.getString(&quot;AbnormalFlag&quot;);
				tmpTestOrderedDateTime             = sqlResult.getString(&quot;TestOrderedDateTime&quot;);
				tmpTestAnalyzerCompletionDateTime  = sqlResult.getString(&quot;TestAnalyzerCompletionDateTime&quot;);
				tmpTestResultFirstReviewedDateTime = sqlResult.getString(&quot;TestResultFirstReviewedDateTime&quot;);
				tmpTestResultReleasedDateTime      = sqlResult.getString(&quot;TestResultReleasedDateTime&quot;);
				tmpEpisodeDate		= DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, tmpEpisodeDateTime).getTime();

				// Check whether we moved onto a different episode, if we did and it hadn&apos;t already been processed then send a new
				// case...
				if ((tmpEpisodeID != currEpisodeID)) {
					if ($(&apos;cases_from_most_recent_episode_only&apos;) != &apos;true&apos;) {
						if (currEpisodeID != &quot;&quot;) {
							if (currStatus == &quot;N&quot;) {
								var currPatient = {&quot;caseId&quot;: currEpisodeID , site: &quot;&quot;, episodes: []};
								currPatient.episodes = episodes;
								// We&apos;re putting the batchSeq into the JSON message, the destination channel can split this out for use later
								// This is used for updating the records once the records are successfully sent to the web service
								var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

								var json = JSON.stringify(currPatient);
								logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
								// Send the JSON Object to the Web Service channel
								resp = router.routeMessage(&quot;Rest Client&quot;, JSON.stringify(currMessage));
								if (resp) {
									logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
								}
							}
						}
					}

					episodeSize = episodes.push({episodeDate: tmpEpisodeDate,
											episodeId: tmpEpisodeID,
											attributeWithValues: [{externalName: &quot;PID&quot;, name: &quot;PID&quot;, value: tmpPatientID},
															{externalName: &quot;BIRTHDATE&quot;, name: &quot;BIRTHDATE&quot;, value: tmpPatientDOB},
															{externalName: &quot;LASTNAME&quot;, name: &quot;LASTNAME&quot;, value: tmpPatientSurname},
															{externalName: &quot;EpisodeOrderedTests&quot;, name: &quot;EpisodeOrderedTests&quot;, value: tmpEpisodeOrderedTests},
															{externalName: &quot;Site&quot;, name: &quot;Site&quot;, value: tmpTestSite},
															{externalName: &quot;PatientFamilyName&quot;, name : &quot;PatientFamilyName&quot;, value: tmpPatientFamilyName},
															{externalName: &quot;PatientGivenName&quot;, name : &quot;PatientGivenName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;PatientTitle&quot;, name : &quot;PatientTitle&quot;, value: tmpPatientTitle},
															{externalName: &quot;PatientSex&quot;, name : &quot;PatientSex&quot;, value: tmpPatientSex},
															{externalName: &quot;PatientStreetAddress&quot;, name : &quot;PatientStreetAddress&quot;, value: tmpPatientStreetAddress},
															{externalName: &quot;PatientCity&quot;, name : &quot;PatientCity&quot;, value: tmpPatientCity},
															{externalName: &quot;PatientPostalCode&quot;, name : &quot;PatientPostalCode&quot;, value: tmpPatientPostalCode},
															{externalName: &quot;PatientState&quot;, name : &quot;PatientState&quot;, value: tmpPatientState},
															{externalName: &quot;PatientCountry&quot;, name : &quot;PatientCountry&quot;, value: tmpPatientCountry},
															{externalName: &quot;PatientStatus&quot;, name : &quot;PatientStatus&quot;, value: tmpPatientStatus},
															{externalName: &quot;PatientPregnancyFlag&quot;, name : &quot;PatientPregnancyFlag&quot;, value: tmpPatientPregnancyFlag},
															{externalName: &quot;PatientFastingFlag&quot;, name : &quot;PatientFastingFlag&quot;, value: tmpPatientFastingFlag}	,
															{externalName: &quot;PatientGivenName&quot;, name : &quot;externalName&quot;, value: tmpPatientGivenName},
															{externalName: &quot;EpisodeClinicalNotes&quot;, name: &quot;EpisodeClinicalNotes&quot;, value: tmpEpisodeClinicalNotes},
															{externalName: &quot;AccountType&quot;, name: &quot;AccountType&quot;, value: tmpAccountType},
															{externalName: &quot;AccountClass&quot;, name: &quot;AccountClass&quot;, value: tmpAccountClass},
															{externalName: &quot;BillTo&quot;, name: &quot;BillTo&quot;, value: tmpBillTo},
															{externalName: &quot;PatientPublicHealthIdentifier&quot;, name: &quot;PatientPublicHealthIdentifier&quot;, value: tmpPatientPublicHealthIdentifier},
															{externalName: &quot;EpisodePublicScheduleCode&quot;, name: &quot;EpisodePublicScheduleCode&quot;, value: tmpEpisodePublicScheduleCode},
															{externalName: &quot;PatientPrivateHealthFundName&quot;, name: &quot;PatientPrivateHealthFundName&quot;, value: tmpPatientPrivateHealthFundName},
															{externalName: &quot;PatientPrivateHealthFundID&quot;, name: &quot;PatientPrivateHealthFundID&quot;, value: tmpPatientPrivateHealthFundID},
															{externalName: &quot;ReqPhysicianID&quot;, name: &quot;ReqPhysicianID&quot;, value: tmpReqPhysicianID},
															{externalName: &quot;ReqPhysicianName&quot;, name: &quot;ReqPhysicianName&quot;, value: tmpReqPhysicianName},
															{externalName: &quot;ReqPhysicianSpeciality&quot;, name: &quot;ReqPhysicianSpeciality&quot;, value: tmpReqPhysicianSpeciality},
															{externalName: &quot;SugeryName&quot;, name: &quot;SugeryName&quot;, value: tmpSugeryName},
															{externalName: &quot;SurgeryCode&quot;, name: &quot;SurgeryCode&quot;, value: tmpSurgeryCode},
															{externalName: &quot;CopyPhysicianIDList&quot;, name: &quot;CopyPhysicianIDList&quot;, value: tmpCopyPhysicianIDList},
															{externalName: &quot;CopyPhysicianNameList&quot;, name: &quot;CopyPhysicianNameList&quot;, value: tmpCopyPhysicianNameList},
															{externalName: &quot;PanelIndicator&quot;, name: &quot;PanelIndicator&quot;, value: tmpPanelIndicator},
															{externalName: &quot;PanelID&quot;, name: &quot;PanelID&quot;, value: tmpPanelID},
															{externalName: &quot;PanelName&quot;, name: &quot;PanelName&quot;, value: tmpPanelName},
															{externalName: &quot;SampleID&quot;, name: &quot;SampleID&quot;, value: tmpSampleID},
															{externalName: &quot;SampleFluidType&quot;, name: &quot;SampleFluidType&quot;, value: tmpSampleFluidType},
															{externalName: &quot;SampleOriginLocation&quot;, name: &quot;SampleOriginLocation&quot;, value: tmpSampleOriginLocation},
															{externalName: &quot;SampleOriginSubLocation&quot;, name: &quot;SampleOriginSubLocation&quot;, value: tmpSampleOriginSubLocation},
															{externalName: &quot;SampleCollectionDateTime&quot;, name: &quot;SampleCollectionDateTime&quot;, value: tmpSampleCollectionDateTime},
															{externalName: &quot;SampleCollectionMethod&quot;, name: &quot;SampleCollectionMethod&quot;, value: tmpSampleCollectionMethod},
															{externalName: &quot;TestSiteSampleReceivedDateTime&quot;, name: &quot;TestSiteSampleReceivedDateTime&quot;, value: tmpTestSiteSampleReceivedDateTime},
															{externalName: &quot;TestPriority&quot;, name: &quot;TestPriority&quot;, value: tmpTestPriority},
															{externalName: &quot;TestRequestSite&quot;, name: &quot;TestRequestSite&quot;, value: tmpTestRequestSite},
															{externalName: &quot;TestSite&quot;, name: &quot;TestSite&quot;, value: tmpTestSite},
															{externalName: &quot;TestType&quot;, name: &quot;TestType&quot;, value: tmpTestType},
															{externalName: &quot;TestOrderedDateTime&quot;, name: &quot;TestOrderedDateTime&quot;, value: tmpTestOrderedDateTime}]});
				}

				currEpisodeID		= tmpEpisodeID;
				currStatus		= sqlResult.getString(&quot;Processed_YN&quot;);

				tmpTestLISCode		= sqlResult.getString(&quot;TestLISCode&quot;);
				tmpTestLISName		= sqlResult.getString(&quot;TestLISName&quot;);
				tmpTestValue		= sqlResult.getString(&quot;TestValue&quot;);
				tmpTestNormalRange	= sqlResult.getString(&quot;TestNormalRange&quot;);
				tmpTestUnits		= sqlResult.getString(&quot;TestUnits&quot;);
				// batchSeq is only used when processing the records with a status of &quot;N&quot;
				// well actually the records will have a status of &quot;P&quot; for processing
				// but they haven&apos;t already beenprocessed
				batchSeq					= sqlResult.getInt(&quot;BatchSeq&quot;);

				episodes[episodeSize - 1].attributeWithValues.push({externalName: tmpTestLISCode, name: tmpTestLISName, value: tmpTestValue,
														units: tmpTestUnits, range: tmpTestNormalRange});

				/* For testing only. The API fails when sending the acxtual tests from the incoming messages*/
				//episodes[episodeSize - 1].attributeWithValues.push({externalName: &quot;GTT 120m&quot;, name: &quot;GTTP 120min&quot;, value: &quot;6.7&quot;});

				if (tmpPatientID != currPatientID){
					currPatientID = tmpPatientID;
				}
			} //end while
			if (currStatus == &quot;N&quot;) {
				var currPatient = {&quot;caseId&quot;: currPatientID , site: &quot;&quot;, episodes: []};
				currPatient.episodes = episodes;
				var currMessage = {&quot;batchSeq&quot;: batchSeq, &quot;episodeID&quot;: currEpisodeID, Patient: currPatient};

				var json = JSON.stringify(currPatient);
				// Send the JSON Object to the Web Service
				logger.trace(&quot;JSON Routing to REST CLIENT: &quot; + json);
				resp = router.routeMessage(&quot;Rest Client 5&quot;, JSON.stringify(currMessage));
				if (resp) {
					logger.trace(&quot;Response from REST Channel: &quot; + resp.getMessage());
				}
			}
			return true;
		}
	}
	catch(ex) {
		logger.error(&quot;PKS - Select_CDS_Data - Exception: &quot; + ex);
		throw ex;
	}
	finally {
	//	dbConn.close();
	}

}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6f972e07-5a81-4de6-928c-f0135dd43747</id>
                <name>Stop_File_Reader</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481176</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Change_State(Channel, State) {
	const threadSleepTime = 10000; // ten seconds
	const millisecondsPerMinute = 60000;
	const maxAttempts = ($(&apos;CDS_Max_Wait_Minutes&apos;) * millisecondsPerMinute) / threadSleepTime;

	var attempts = 0;
	var channelState;

	channelState = ChannelUtil.getChannelState(Channel);
	if (channelState == State) {
		logger.debug(&apos;Channel already &apos; + State + &apos; no need to change state.&apos;);
		return true;
	} else {
		// Channel is running, need to check whether there are records to process...
		if (State == &quot;Started&quot;){
			logger.info(&apos;Starting Channel: &apos; + Channel);
			ChannelUtil.startChannel(Channel);
		} else {
			logger.info(&apos;Stopping Channel: &apos; + Channel);
			ChannelUtil.stopChannel(Channel);
		}
		channelState = ChannelUtil.getChannelState(Channel);
		while ((channelState != State) &amp;&amp; (attempts &lt; maxAttempts)) {
			logger.debug(&quot;Waiting for channel &quot; + Channel);
			channelState = ChannelUtil.getChannelState(Channel);
			if (channelState != State) {
				java.lang.Thread.sleep(threadSleepTime);
			}

			attempts ++;
		}
		logger.debug(&apos;Channel &apos; + Channel + &apos; is &apos; + channelState);
		if (channelState == State) {
			logger.debug(&apos;Successfully changed state of &apos; + Channel);
			return true;
		} else {
			return false;
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>4c706164-e5b5-4de5-ab21-b0c64c8be231</id>
                <name>Update_CDS_Status</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481701</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Update_CDS_Status(ResponseStatus, currBatchSeq, currEpisodeID) {
	logger.trace(&quot;Resp Status: &quot; + ResponseStatus);

	var cdsStatus;

    if (ResponseStatus != &quot;SENT&quot;) {
		cdsStatus = &quot;E&quot;;
		logger.trace(&quot;Response code from web service call was not SENT, response:&quot; + ResponseStatus);
		// Call the stored proc setting the status to &quot;E&quot; for the error cases
		var dbConn = Get_CDS_Connection();
		try {
			var returnValue = 1;
			var sqlQuery = &quot;call rd_staging.rdUpdCDSStatus(&quot; + currBatchSeq + &quot;,&apos;&quot; + currEpisodeID + &quot;&apos;,&apos;&quot; + cdsStatus + &quot;&apos;)&quot;;

			logger.trace(&quot;SQL &quot; + sqlQuery);

			var sqlResult = dbConn.executeCachedQuery(sqlQuery);
			if (sqlResult.next()) {
				logger.debug(&quot;PKS - Update_CDS_Status - Info: &quot; + sqlResult.getString(&quot;Message&quot;));
			}
		}
		finally {
		//	dbConn.close();
		}
	}
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>7deb66ed-ae5a-4ab6-830a-5fd343bd25ff</id>
                <name>Utilities</name>
                <revision>2</revision>
                <lastModified>
                  <time>1702919075615</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function Escape_String(str) {
		// Replace the following...
		// &apos; - Single quote
		// &quot; - Double quote
		// % - Percent
		// _ - Underscore
		// ; - Semi colon
		// No need to replace carriage returns, linefeeds and tabs as the incoming file is tab separated and row terminators
		// are carriage returns and linefeeds
		return str ? String(str).replace(/(&apos;|&quot;|\%|\_|\;)/g, &apos;\\$1&apos;) : str;
		}

function transformTestValue(result) {
	if (result != null &amp;&amp; result != &apos;&apos;) {
		if (result.indexOf(&quot;,&quot;) &gt;= 0) {
			result = result.replace(/,/g, &quot;.&quot;);
		}
	}
	return result;
}

function transformRange(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		if (!isValidRange(range)) {
			logger.error(&quot;Invalid range dropped:  &quot; + range + &quot;.  Data was stored without the range.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	var regex = /([\s|-]{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1}-\s{0,1}\d{1,4}(\.\d{1,8}){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,4}(\.\d{1,8}){0,1})/;
	return regex.test(range);
}

function encryptString(originalValue) {
	encryptedValue = originalValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;0&apos;);
	encryptedValue = encryptedValue.replace(/0/g, &apos;q&apos;);
	encryptedValue = encryptedValue.replace(/1/g, &apos;w&apos;);
	encryptedValue = encryptedValue.replace(/2/g, &apos;e&apos;);
	encryptedValue = encryptedValue.replace(/3/g, &apos;r&apos;);
	encryptedValue = encryptedValue.replace(/4/g, &apos;t&apos;);
	encryptedValue = encryptedValue.replace(/5/g, &apos;y&apos;);
	encryptedValue = encryptedValue.replace(/6/g, &apos;u&apos;);
	encryptedValue = encryptedValue.replace(/7/g, &apos;i&apos;);
	encryptedValue = encryptedValue.replace(/8/g, &apos;o&apos;);
	encryptedValue = encryptedValue.replace(/9/g, &apos;p&apos;);
	encryptedValue = encryptedValue.replace(/m/g, &apos;a&apos;);
	encryptedValue = encryptedValue.replace(/n/g, &apos;s&apos;);
	encryptedValue = encryptedValue.replace(/b/g, &apos;d&apos;);
	encryptedValue = encryptedValue.replace(/v/g, &apos;f&apos;);
	encryptedValue = encryptedValue.replace(/c/g, &apos;g&apos;);
	encryptedValue = encryptedValue.replace(/x/g, &apos;h&apos;);
	encryptedValue = encryptedValue.replace(/z/g, &apos;j&apos;);
	encryptedValue = encryptedValue.replace(/l/g, &apos;k&apos;);
	encryptedValue = encryptedValue.replace(/k/g, &apos;l&apos;);
	encryptedValue = encryptedValue.replace(/j/g, &apos;z&apos;);
	encryptedValue = encryptedValue.replace(/h/g, &apos;x&apos;);
	encryptedValue = encryptedValue.replace(/g/g, &apos;c&apos;);
	encryptedValue = encryptedValue.replace(/f/g, &apos;v&apos;);
	encryptedValue = encryptedValue.replace(/d/g, &apos;b&apos;);
	encryptedValue = encryptedValue.replace(/s/g, &apos;n&apos;);
	encryptedValue = encryptedValue.replace(/a/g, &apos;m&apos;);
	encryptedValue = encryptedValue.replace(/p/g, &apos;9&apos;);
	encryptedValue = encryptedValue.replace(/o/g, &apos;8&apos;);
	encryptedValue = encryptedValue.replace(/i/g, &apos;7&apos;);
	encryptedValue = encryptedValue.replace(/u/g, &apos;6&apos;);
	encryptedValue = encryptedValue.replace(/y/g, &apos;5&apos;);
	encryptedValue = encryptedValue.replace(/t/g, &apos;4&apos;);
	encryptedValue = encryptedValue.replace(/r/g, &apos;3&apos;);
	encryptedValue = encryptedValue.replace(/e/g, &apos;2&apos;);
	encryptedValue = encryptedValue.replace(/w/g, &apos;1&apos;);
	encryptedValue = encryptedValue.replace(/q/g, &apos;0&apos;);
	return encryptedValue;
}

function calculate_age_in_years(dateOfBirth) {
	var today = new Date();
	var birthDate = new Date(dateOfBirth);
	var age = today.getFullYear() - birthDate.getFullYear();
	var m = today.getMonth() - birthDate.getMonth();
	if (m &lt; 0 || (m === 0 &amp;&amp; today.getDate() &lt; birthDate.getDate())) {
		age--;
	}
	return age;
}

function buildStringIfNotNull(value) {
	if (value == null || value == &apos;&apos;) {
		return null;
	}
	return &quot;&apos;&quot; + value + &quot;&apos;&quot;;
}

</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>6e86188e-4667-4403-a558-cdff9971eec6</id>
      <nextMetaDataId>17</nextMetaDataId>
      <name>1- Incomming LIS HL7</name>
      <description>Al canal se le han aadido funciones adicionales:&#xd;
	1-. Una funcion que verifica que el campo de range de prueba contenga algun caracter de alfanumerico y omite la transmision si esto es verdadero.&#xd;
	2-. Se aade una funcion que consulta la respuesta obtenida de CDS (almacenada en una tabla response) en envios anteriores utilizando el caseId y la inserta en el JSON.</description>
      <revision>69</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.tcp.TcpReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <listenerConnectorProperties version="3.9.1">
            <host>0.0.0.0</host>
            <port>6661</port>
          </listenerConnectorProperties>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>Auto-generate (Before processing)</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>true</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <transmissionModeProperties class="com.mirth.connect.plugins.mllpmode.MLLPModeProperties">
            <pluginPointName>MLLP</pluginPointName>
            <startOfMessageBytes>0B</startOfMessageBytes>
            <endOfMessageBytes>1C0D</endOfMessageBytes>
            <useMLLPv2>false</useMLLPv2>
            <ackBytes>06</ackBytes>
            <nackBytes>15</nackBytes>
            <maxRetries>2</maxRetries>
          </transmissionModeProperties>
          <serverMode>true</serverMode>
          <remoteAddress></remoteAddress>
          <remotePort></remotePort>
          <overrideLocalBinding>false</overrideLocalBinding>
          <reconnectInterval>5000</reconnectInterval>
          <receiveTimeout>0</receiveTimeout>
          <bufferSize>65536</bufferSize>
          <maxConnections>10</maxConnections>
          <keepConnectionOpen>true</keepConnectionOpen>
          <dataTypeBinary>false</dataTypeBinary>
          <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
          <respondOnNewConnection>0</respondOnNewConnection>
          <responseAddress></responseAddress>
          <responsePort></responsePort>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>//Save Incomming message
//var rsp = router.routeMessage(&apos;2- Save Incoming Messages&apos;, connectorMessage.getRawData());


var msg_type = msg[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.1&apos;].toString();
channelMap.put(&apos;msg_type&apos;,msg_type);
channelMap.put(&apos;Case&apos;, msg[&apos;PID&apos;][&apos;PID.3&apos;][0][&apos;PID.3.1&apos;].toString()+&quot;_&quot;+msg[&apos;ORC&apos;][0][&apos;ORC.2&apos;][&apos;ORC.2.1&apos;].toString());
channelMap.put(&apos;PID&apos;, msg[&apos;PID&apos;][&apos;PID.2&apos;][&apos;PID.2.1&apos;].toString());
channelMap.put(&apos;PID2&apos;, msg[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.1&apos;].toString());
channelMap.put(&apos;PID3&apos;, msg[&apos;PID&apos;][&apos;PID.4&apos;][&apos;PID.4.1&apos;].toString());
// Se aade mapeo de codigo de plan para utilizarlo como filtro
channelMap.put(&apos;CodigoPlan&apos;, msg[&apos;PV1&apos;][&apos;PV1.7&apos;][&apos;PV1.7.1&apos;].toString());
channelMap.put(&apos;Empresa&apos;,msg[&apos;PV1&apos;][&apos;PV1.7&apos;][&apos;PV1.7.2&apos;].toString());
//var CodigoPlan = msg[&apos;PV1&apos;][&apos;PV1.7&apos;][&apos;PV1.7.1&apos;].toString();

if (msg_type ==&apos;ORU&apos;){
	//map time CDS request 
	channelMap.put(&apos;CDS1 Request&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));
	//create Json Object
	var jsonObjFromHL7 = {};
	jsonObjFromHL7.caseId = msg[&apos;PID&apos;][&apos;PID.3&apos;][0][&apos;PID.3.1&apos;].toString()+&quot;_&quot;+msg[&apos;ORC&apos;][0][&apos;ORC.2&apos;][&apos;ORC.2.1&apos;].toString();

	jsonObjFromHL7.site = msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;].toString();
	  var aux_message = {};
	  aux_message.caseId = jsonObjFromHL7.caseId;
	  aux_message.uuidCDS = UUIDGenerator.getUUID();
	  aux_message.site = msg[&apos;PV1&apos;][&apos;PV1.8&apos;][&apos;PV1.8.1&apos;].toString();
	  aux_message.PID = msg[&apos;PID&apos;][&apos;PID.2&apos;][&apos;PID.2.1&apos;].toString();
	  aux_message.PID2 = msg[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.1&apos;].toString();
	  aux_message.PID3 = msg[&apos;PID&apos;][&apos;PID.4&apos;][&apos;PID.4.1&apos;].toString();
	  aux_message.episodeDate = msg[&apos;ORC&apos;][&apos;ORC.7&apos;][&apos;ORC.7.1&apos;].toString();
	  aux_message.SampleID = msg[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	  aux_message.FechaRegistroOrden =  msg[&apos;ORC&apos;][0][&apos;ORC.7&apos;][&apos;ORC.7.1&apos;].toString();
	  aux_message.MedicoPeticionarioID = msg[&apos;PV1&apos;][&apos;PV1.9&apos;][&apos;PV1.9.1&apos;].toString();
	  aux_message.SedeSynlabPresentacion = msg[&apos;PV1&apos;][&apos;PV1.10&apos;][&apos;PV1.10.1&apos;].toString();
	  aux_message.CodigoPlanCliente = msg[&apos;PV1&apos;][&apos;PV1.7&apos;][&apos;PV1.7.1&apos;].toString();

	
	
	var episodeArray = new Array();
	//create episode
	var episodeObject = {};
	   //episodeDate
	   episodeObject.episodeDate = DateUtil.getDate(&quot;yyyyMMddHHmmss&quot;, msg[&apos;ORC&apos;][&apos;ORC.7&apos;][&apos;ORC.7.1&apos;].toString() ).getTime();
	   //episodeID
	   episodeObject.episodeId = msg[&apos;ORC&apos;][&apos;ORC.2&apos;][&apos;ORC.2.1&apos;].toString();
	   //Primary Attributes Array
	   var attributeArr =  new Array();
	   //Primary Attributes - Visit Id
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;SampleID&quot; 
	   attributeObjectgeneral.value = msg[&apos;ORC&apos;][0][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);
	    //Primary Attributes - Previous Interp
	    var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;PreviousInterp&quot; 
	   var select = &quot;select report, actions, caseid from response where caseid = &apos;&quot;+jsonObjFromHL7.caseId+&quot;&apos; order by id desc &quot;
	   channelMap.put(&apos;select&apos;,select)
		var dbConn;
		var result;
		channelMap.put(&apos;1&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;))	
					
		try {
		  dbConn = DatabaseConnectionFactory.createDatabaseConnection(&quot;com.mysql.jdbc.Driver&quot;, &apos;jdbc:mysql://localhost:3306/statistics&apos;, &apos;root&apos;, &apos;P@ssw0rdSynlab&apos;);
		  channelMap.put(&apos;2&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;))	
		  result = dbConn.executeCachedQuery(select);
		  channelMap.put(&apos;3&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;))	
		  if (result.next()){
		  	attributeObjectgeneral.value = result.getString(1)+&quot; &quot;+result.getString(2)
		  }else{
		  	attributeObjectgeneral.value = &quot;&quot;
		  }
		} finally {
		  if (dbConn) {
			dbConn.close();
		  }
		}
	   	channelMap.put(&apos;4&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;))	
	   
	   attributeArr.push(attributeObjectgeneral); 
	    
	    //Primary Attributes - Sample Collection Datetime 
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;FechaMensajeHL7&quot; 
	   attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, msg[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;].toString()+&quot;00&quot;);
	   attributeArr.push(attributeObjectgeneral); 
	   
	   //Primary Attributes - OrderDateTime 
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;FechaRegistroOrden&quot; 
	   if (msg[&apos;ORC&apos;][0][&apos;ORC.7&apos;][&apos;ORC.7.1&apos;].toString()!=&quot;&quot;){
	     attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, msg[&apos;ORC&apos;][0][&apos;ORC.7&apos;][&apos;ORC.7.1&apos;].toString());
	   }else{
	   	
	   }
	   attributeArr.push(attributeObjectgeneral);  
	   //Primary Attributes - PID
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;PID&quot; 
	   attributeObjectgeneral.value = msg[&apos;PID&apos;][&apos;PID.2&apos;][&apos;PID.2.2&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);
	    //Primary Attributes - PID2
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;PID2&quot; 
	   attributeObjectgeneral.value =  msg[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);
	   //Primary Attributes - PID3
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;PID3&quot; 
	   attributeObjectgeneral.value = msg[&apos;PID&apos;][&apos;PID.4&apos;][&apos;PID.4.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);
	    //Primary Attributes - Patient Name
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Nombre Paciente&quot; 
	   attributeObjectgeneral.value = msg[&apos;PID&apos;][&apos;PID.6&apos;][&apos;PID.6.1&apos;].toString().replace(&quot;\&quot;&quot;,&quot;&apos;&quot;)+&apos;, &apos;+msg[&apos;PID&apos;][&apos;PID.6&apos;][&apos;PID.6.2&apos;].toString().replace(&quot;\&quot;&quot;,&quot;&apos;&quot;);
	   attributeArr.push(attributeObjectgeneral);
	   //Primary Attributes - Patient CDS Name
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Nombre Paciente CDS&quot; 
	   attributeObjectgeneral.value = msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;].toString().replace(&quot;\&quot;&quot;,&quot;&apos;&quot;);
	   attributeArr.push(attributeObjectgeneral);
	  /* //Primary Attributes - Patient Location
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Localizacin Paciente&quot; 
	   if (msg[&apos;PV1&apos;][&apos;PV1.3&apos;][&apos;PV1.3.1&apos;].toString()!= null &amp;&amp; msg[&apos;PV1&apos;][&apos;PV1.3&apos;][&apos;PV1.3.1&apos;].toString()!= &quot;&quot;){
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.3&apos;][&apos;PV1.3.1&apos;].toString();
	   }else{
	   	
	   }
	   attributeArr.push(attributeObjectgeneral);  
	   */ 
	   //Primary Attributes - Patient Name
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Tipo Episodio&quot; 
	   attributeObjectgeneral.value = msg[&apos;PID&apos;][&apos;PID.1&apos;][&apos;PID.2.1&apos;].toString().replace(&quot;\&quot;&quot;,&quot;&apos;&quot;);
	   attributeArr.push(attributeObjectgeneral);
	   //Primary Attributes - Visit Admit Datetime
	/*   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Visit Admit Datetime&quot; 
	   if (msg[&apos;PV1&apos;][&apos;PV1.44&apos;][&apos;PV1.44.1&apos;].toString() != null &amp;&amp; msg[&apos;PV1&apos;][&apos;PV1.44&apos;][&apos;PV1.44.1&apos;].toString()!= &quot;&quot;){
	     attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, msg[&apos;PV1&apos;][&apos;PV1.44&apos;][&apos;PV1.44.1&apos;].toString());
	   }else{
	   	
	   }
	   attributeArr.push(attributeObjectgeneral);  
	  */ 
	   //Primary Attributes - ReqPhysicianID
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;MedicoPeticionarioID&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.9&apos;][&apos;PV1.9.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  

	   //Primary Attributes - ReqPhysicianName
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;MedicoPeticionarioNombre&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.9&apos;][&apos;PV1.9.2&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  

	   //Primary Attributes - Sede Synlab Presentacin
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;SedeSynlabPresentacion&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.10&apos;][&apos;PV1.10.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  

	   //Primary Attributes - Cdigo Plan Cliente
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;CodigoPlanCliente&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.7&apos;][&apos;PV1.7.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  

	   //Primary Attributes - Descripcin Plan Cliente
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;DescripcionPlanCliente&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.7&apos;][&apos;PV1.7.2&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  

	   //Primary Attributes - Empresa Convenio - Nit
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;NIT&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.8&apos;][&apos;PV1.8.1&apos;].toString();
	   aux_message.NIT = msg[&apos;PV1&apos;][&apos;PV1.8&apos;][&apos;PV1.8.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  

	   //Primary Attributes - Empresa Convenio - Razn Social
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;RazonSocial&quot; 
	   attributeObjectgeneral.value = msg[&apos;PV1&apos;][&apos;PV1.8&apos;][&apos;PV1.8.2&apos;].toString();
	   aux_message.RazonSocial = msg[&apos;PV1&apos;][&apos;PV1.8&apos;][&apos;PV1.8.2&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  
	   /*
	   //Primary Attributes - Discharge Admit Datetime
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Discharge Admit Datetime&quot; 
	   if (msg[&apos;PV1&apos;][&apos;PV1.45&apos;][&apos;PV1.45.1&apos;].toString() != null &amp;&amp; msg[&apos;PV1&apos;][&apos;PV1.45&apos;][&apos;PV1.45.1&apos;].toString() != &quot;&quot;){
	     attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, msg[&apos;PV1&apos;][&apos;PV1.45&apos;][&apos;PV1.45.1&apos;].toString());
	   }else{
	   	attributeObjectgeneral.value = &quot;&quot;;
	   }
	   attributeArr.push(attributeObjectgeneral);  
*/
	   
	   if ( msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString() != null &amp;&amp;  msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString() != &quot;&quot;){
	     //Primary Attributes - Patient DoB
	     var attributeObjectgeneral = {};
	     attributeObjectgeneral.externalName=&quot;BIRTHDATE&quot; 
	     attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMdd&quot;, &quot;yyyy-MM-dd&quot;, msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString());
	     attributeArr.push(attributeObjectgeneral);  
	     //Primary Attributes - Age
	     var attributeObjectgeneral = {};
	     attributeObjectgeneral.externalName=&quot;EdadPaciente&quot; 
	     if(msg[&apos;OBR&apos;][0][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;].toString() != null &amp;&amp;  msg[&apos;OBR&apos;][0][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;].toString() !=&quot;&quot;){
	       attributeObjectgeneral.value =Math.round((DateUtil.getDate(&quot;yyyyMMddHHmmss&quot;, msg[&apos;OBR&apos;][0][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;].toString()).getTime()-DateUtil.getDate(&quot;yyyyMMdd&quot;, msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString()).getTime())/1000/60/60/24/365);
	     	aux_message.EdadPaciente =attributeObjectgeneral.value;
	     }else{
	       attributeObjectgeneral.value =Math.round((DateUtil.getDate(&quot;yyyyMMddHHmmss&quot;, msg[&apos;ORC&apos;][0][&apos;ORC.7&apos;][&apos;ORC.7.4&apos;].toString()).getTime()-DateUtil.getDate(&quot;yyyyMMdd&quot;, msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString()).getTime())/1000/60/60/24/365);
	       aux_message.EdadPaciente =attributeObjectgeneral.value;
	     }
	     attributeArr.push(attributeObjectgeneral);
	     //Primary Attributes - Age days
	     var  attributeObjectgeneral = {};
	     attributeObjectgeneral.externalName=&quot;Edad en Das&quot; 
	     if(msg[&apos;OBR&apos;][&apos;OBR.7&apos;][0][&apos;OBR.7.1&apos;].toString() != null &amp;&amp;  msg[&apos;OBR&apos;][0][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;].toString() !=&quot;&quot;){
	       attributeObjectgeneral.value =Math.round((DateUtil.getDate(&quot;yyyyMMddHHmmss&quot;, msg[&apos;OBR&apos;][0][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;].toString()).getTime()-DateUtil.getDate(&quot;yyyyMMdd&quot;, msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString()).getTime())/1000/60/60/24);
	     }else{
	       attributeObjectgeneral.value =Math.round((DateUtil.getDate(&quot;yyyyMMddHHmmss&quot;,  msg[&apos;ORC&apos;][0][&apos;ORC.7&apos;][&apos;ORC.7.4&apos;].toString()).getTime()-DateUtil.getDate(&quot;yyyyMMdd&quot;, msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString()).getTime())/1000/60/60/24);
	     }
	     attributeArr.push(attributeObjectgeneral);
	   }
	   //Primary Attributes - Patient Gender
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;PatientSex&quot; 
	   attributeObjectgeneral.value = msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString();
	   aux_message.PatientSex = msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);  
	   //Primary Attributes - Episode Ordered Tests
/*	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;EpisodeOrderedTests&quot; 
	   attributeObjectgeneral.value = &apos;&apos;;
	   var select = &quot;SELECT order_list from repository.orders where order_id =&apos;&quot;+msg[&apos;ORC&apos;][&apos;ORC.3&apos;][&apos;ORC.3.1&apos;].toString()+&quot;&apos; &quot;;
	   var dbConn;
	   var result;
	   try {
		dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;, &apos;jdbc:mysql://localhost:3306/rd_staging&apos;, &apos;root&apos;, &apos;1Password&apos;);
		result = dbConn.executeCachedQuery(select);
	     if (result.next()){
	        attributeObjectgeneral.value = result.getString(&apos;order_list&apos;);
	     }
	    } finally {
		if (dbConn) {
			dbConn.close();
		}
	   }
	   attributeArr.push(attributeObjectgeneral);  
	*/           
	   //Primary Attributes - SAMPLE
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Sample&quot;
	   aux_sample=&quot;&quot;;
	   for each (seg in msg..SPM) {
		 aux_sample += seg[&apos;SPM.4&apos;][&apos;SPM.4.1&apos;].toString()+&quot;,&quot;;
	   }
	   attributeObjectgeneral.value = aux_sample.substring(0, aux_sample.length - 1 );
	   attributeArr.push(attributeObjectgeneral);
	   //Primary Attributes - Sample Collection Datetime 
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;FechaDeToma&quot; 
	   attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, msg[&apos;OBR&apos;][0][&apos;OBR.7&apos;][&apos;OBR.7.1&apos;].toString());
	   attributeArr.push(attributeObjectgeneral); 
	   //Primary Attributes - Sample Received Datetime
	   
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;FechaRecepcionMuestra&quot;
	   if (msg[&apos;SPM&apos;].toString().length &gt; 0 &amp;&amp; msg[&apos;SPM&apos;][0][&apos;SPM.18&apos;][&apos;SPM.18.1&apos;].toString() !=&quot;&quot; &amp;&amp;  msg[&apos;SPM&apos;][0][&apos;SPM.18&apos;][&apos;SPM.18.1&apos;].toString() !=null){ 
	     attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, msg[&apos;SPM&apos;][0][&apos;SPM.18&apos;][&apos;SPM.18.1&apos;].toString());
	   }else{
	   	attributeObjectgeneral.value = &quot;&quot;;
	   }
	   attributeArr.push(attributeObjectgeneral);    
	   //Primary Attributes - Test Ordered
	   
	   var aux_TestOrdered=&quot;&quot;;
	   var aux_TestOrderedName=&quot;&quot;;
	   var z = 0;
	   for each (seg in msg..OBR) {
	   	  
		 if (aux_TestOrdered.indexOf(seg[&apos;OBR.4&apos;][&apos;OBR.4.1&apos;].toString()) &gt;= 0){
		 	
		 }else{
		   aux_TestOrdered += seg[&apos;OBR.4&apos;][&apos;OBR.4.1&apos;].toString()+&quot;,&quot;;	
		   aux_TestOrderedName += seg[&apos;OBR.4&apos;][&apos;OBR.4.2&apos;].toString()+&quot;,&quot;;	
		   
		 }
		 z++;
	   }
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;CodigoExamen&quot;
	   attributeObjectgeneral.value = aux_TestOrdered.substring(0, aux_TestOrdered.length - 1 );
	   attributeArr.push(attributeObjectgeneral);
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;NombreExamen&quot;
	   attributeObjectgeneral.value = aux_TestOrderedName.substring(0, aux_TestOrderedName.length - 1 );
	   attributeArr.push(attributeObjectgeneral);
	   
	/*   //Primary Attributes - Ordering Provider 
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Ordering Provider&quot; 
	   attributeObjectgeneral.value = msg[&apos;ORC&apos;][0][&apos;ORC.12&apos;][&apos;ORC.12.1&apos;].toString()+&quot; - &quot;+msg[&apos;ORC&apos;][0][&apos;ORC.12&apos;][&apos;ORC.12.3&apos;].toString()+&quot; &quot;+msg[&apos;ORC&apos;][0][&apos;ORC.12&apos;][&apos;ORC.12.2&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);      
	   //Primary Attributes - Ordering Organization 
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;Ordering Organization&quot; 
	   attributeObjectgeneral.value = msg[&apos;ORC&apos;][0][&apos;ORC.17&apos;][&apos;ORC.17.2&apos;].toString();
	   attributeArr.push(attributeObjectgeneral);
	   */
	   //Primary Attributes - Results
	     var aux_DateResults = &quot;&quot;; 
	     var auxSeg = &quot;&quot;; 
	     var auxComment =&quot;&quot;;
	     var auxObx =&quot;&quot;;
	   for each (seg in msg.children()) {
	   	
	   	if (seg.name().toString() == &quot;OBR&quot;) {
	   		if ( aux_DateResults &lt; seg[&apos;OBR.14&apos;][&apos;OBR.14.1&apos;].toString()){
		 	aux_DateResults = seg[&apos;OBR.14&apos;][&apos;OBR.14.1&apos;].toString();
		 }
		 if (auxSeg == &apos;NTE&apos;){
		   if (auxComment !=&quot;&quot;){
			  var attributeObjectgeneral = {};
		       attributeObjectgeneral.externalName=&quot;Comentario de &quot;+auxObx;
		       attributeObjectgeneral.value = auxComment;
		       attributeArr.push(attributeObjectgeneral);
			}	
		 }
		 auxComment =&quot;&quot;;
	   	}
	   	if (seg.name().toString() == &quot;OBX&quot;) {
		 
		 if (auxSeg == &apos;NTE&apos;){
		   if (auxComment !=&quot;&quot;){
			  var attributeObjectgeneral = {};
		       attributeObjectgeneral.externalName=&quot;Comentario de &quot;+auxObx;
		       attributeObjectgeneral.value = auxComment;
		       attributeArr.push(attributeObjectgeneral);
			}	
		 }
		 auxComment =&quot;&quot;;
           var attributeObject = {};
		 //attributeObject.externalName = seg[&apos;OBX.3&apos;][&apos;OBX.3.2&apos;].toString();
		 attributeObject.externalName = seg[&apos;OBX.3&apos;][&apos;OBX.3.2&apos;].toString();
		 if ( attributeObject.externalName.indexOf(&quot;%&quot;)==0){attributeObject.externalName=attributeObject.externalName.replace(&apos;%&apos;,&apos;\\%&apos;)}
		 auxObx = seg[&apos;OBX.3&apos;][&apos;OBX.3.2&apos;].toString();
		 attributeObject.value = seg[&apos;OBX.5&apos;][&apos;OBX.5.1&apos;].toString();
		 attributeObject.units = seg[&apos;OBX.6&apos;][&apos;OBX.6.1&apos;].toString();
		 attributeObject.range = transformRange2(seg[&apos;OBX.7&apos;][&apos;OBX.7.1&apos;].toString());
		 attributeArr.push(attributeObject);
		 
	     }
	     if (seg.name().toString() == &quot;NTE&quot;) {
	   		auxComment +=seg[&apos;NTE.3&apos;][&apos;NTE.3.1&apos;].toString()+&quot; &quot;;
	   	}
	     auxSeg = seg.name().toString();
	   }
	
	    if (aux_DateResults != &quot;&quot;){
	   	 //Primary Attributes - Sample Collection Datetime 
		   var attributeObjectgeneral = {};
		   attributeObjectgeneral.externalName=&quot;FechaDeValidacion&quot; 
		   attributeObjectgeneral.value = DateUtil.convertDate(&quot;yyyyMMddHHmmss&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, aux_DateResults);
		   attributeArr.push(attributeObjectgeneral); 
	   }

	   if (auxComment !=&quot;&quot;){
	     var attributeObjectgeneral = {};
		attributeObjectgeneral.externalName=&quot;Comentario de &quot;+auxObx;
		attributeObjectgeneral.value = auxComment;
		attributeArr.push(attributeObjectgeneral);
	  }
	   
	  //Load attributes to episode
	  episodeObject.attributeWithValues = attributeArr;
	  episodeArray.push(episodeObject);
	  
	  //Load Historical data
	  
	
	  var jsonPatient = {}
	  /*
	  jsonPatient.patientId=&quot;1247467&quot;;
	  jsonPatient.startDate = &quot;2023-01-01&quot;
	  jsonPatient.application = &quot;CDS&quot;
	  */
	  jsonPatient.patientId=msg[&apos;PID&apos;][&apos;PID.2&apos;][&apos;PID.2.2&apos;].toString();
	  jsonPatient.startDate = &quot;2023-01-01&quot;
	  jsonPatient.application = &quot;CDS&quot;
	  var resp = router.routeMessage(&apos;requestHistorical&apos;, JSON.stringify(jsonPatient));
	
	 try {
	  var historic = JSON.parse(resp.getMessage());

	  var episodeHArray = new Array();
	  episodeHArray = historic.OrderHistory;
	  connectorMap.put(&apos;episodeHArray&apos;,JSON.stringify(episodeHArray));
	  for (t in episodeHArray){
	   var episodeObject = {};
	   //episodeDate
	   episodeObject.episodeDate = DateUtil.getDate(&quot;yyyy-MM-dd HH:mm:ss&quot;, episodeHArray[t].OrderEventDateTime  ).getTime();
	   //episodeID
	   episodeObject.episodeId = episodeHArray[t].OrderID;
	   //Primary Attributes Array
	   var attributeArr =  new Array();
	   //Primary Attributes - Visit Id
	   var attributeObjectgeneral = {};
	   attributeObjectgeneral.externalName=&quot;SampleID&quot; 
	   attributeObjectgeneral.value = episodeHArray[t].OrderID;
	   attributeArr.push(attributeObjectgeneral);

	   episodeObject.attributeWithValues = attributeArr;
	   episodeArray.push(episodeObject);
	    var testHArray = new Array();
	    testHArray =  episodeHArray[t].Tests;
	    for (f in testHArray){
	    	 var attributeObject = {};
		 //attributeObject.externalName = seg[&apos;OBX.3&apos;][&apos;OBX.3.2&apos;].toString();
		 attributeObject.externalName = testHArray[f].TestLisName;
		 if ( attributeObject.externalName.indexOf(&quot;%&quot;)==0){attributeObject.externalName=attributeObject.externalName.replace(&apos;%&apos;,&apos;\\%&apos;)}
		 attributeObject.value = testHArray[f].TestValue;
		 attributeObject.units = testHArray[f].TestUnits;
		 attributeObject.range = testHArray[f].TestNormalRange;
		 attributeObject.range = transformRange2(attributeObject.range);
		 attributeArr.push(attributeObject);
	    }
	  }
	}catch(err){
		
	}
	  
	  jsonObjFromHL7.episodes = episodeArray;
	  jsonObjFromHL7.senderReference = JSON.stringify(aux_message);
	  msg = jsonObjFromHL7;
	  var rsp = router.routeMessage(&apos;Incoming&apos;, jsonObjFromHL7.senderReference);
	  
}else{
	msg = connectorMessage.getRawData()
}

/*function transformRange2(range) {
	if (range != null){
		range = range.replace(&apos;Personas no diabticas:&apos;,&apos;&apos;).replace(&apos;pgv&apos;,&apos;&apos;).replace(&apos;%&apos;,&apos;&apos;).replace(&quot;&lt;0.5 - 1.0&quot;,&apos;&apos;).replace(&quot;null&quot;,&apos;&apos;);
		range = range.replace(&quot;Hasta&quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Valores de Referencia en Nios&quot;,&apos;&apos;);
		range = range.replace(&quot;Evale el Riesgo Cardiovascular&quot;,&apos;&apos;);
		range = range.replace(&quot;    &quot;,&apos;&apos;);
		range = range.replace(&quot;No Reactivo: Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;No Reactivo Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Normal: Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;No reactivo &lt;&quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;No reactivo: Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Femenino:&quot;,&apos;&apos;); 
		range = range.replace(&quot;Ambos Sexos&quot;,&apos;&apos;); 
		range = range.replace(&quot;Mujeres:&quot;,&apos;&apos;);
		range = range.replace(&quot;-3 a +3&quot;,&apos;&apos;); 
		range = range.replace(&quot;1 a &lt; 10 ao: 130 - 300&quot;,&apos;&apos;); 
		if (range == &quot;  -  &quot;){ range=&quot;&quot;};
		if (range == &quot; - &quot;){ range=&quot;&quot;};
		if (range == &quot;-&quot;){ range=&quot;&quot;};
		range = range.replace(&quot;Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Mayor de &quot;,&apos;&gt;&apos;);
		range = range.replace(&quot;Vlr. Referencia para grupos Especiales: , Prematuros:&quot;,&apos;&apos;); 
		//range = range.replace(&quot;&quot;,&apos;&apos;);
	}
	return range;
}*/

function transformRange2(range) {
	if (range != null &amp;&amp; range != &apos;&apos;) {
		if (range.indexOf(&quot;,&quot;) &gt;= 0) {
			range = range.replace(/,/g, &quot;.&quot;);
		}
		range = range.replace(&apos;Personas no diabticas:&apos;,&apos;&apos;).replace(&apos;pgv&apos;,&apos;&apos;).replace(&apos;%&apos;,&apos;&apos;).replace(&quot;&lt;0.5 - 1.0&quot;,&apos;&apos;).replace(&quot;null&quot;,&apos;&apos;);
		range = range.replace(&quot;Hasta&quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Valores de Referencia en Nios&quot;,&apos;&apos;);
		range = range.replace(&quot;Evale el Riesgo Cardiovascular&quot;,&apos;&apos;);
		range = range.replace(&quot;    &quot;,&apos;&apos;);
		range = range.replace(&quot;No Reactivo: Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;No Reactivo Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Normal: Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;No reactivo &lt;&quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;No reactivo: Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Femenino:&quot;,&apos;&apos;); 
		range = range.replace(&quot;Hombres:&quot;,&apos;&apos;); 
		range = range.replace(&quot;No Reactiva&quot;,&apos;&apos;); 
		range = range.replace(&quot;NO REACTIVO&quot;,&apos;&apos;); 
		range = range.replace(&quot;Exudados&quot;,&apos;&apos;); 
		range = range.replace(&quot;NEGATIVO&quot;,&apos;&apos;); 
		range = range.replace(&quot;Claro&quot;,&apos;&apos;);
		range = range.replace(&quot;No Detectado&quot;,&apos;&apos;);
		range = range.replace(&quot;Negativo&quot;,&apos;&apos;);
		range = range.replace(&quot;Ambos Sexos&quot;,&apos;&apos;); 
		range = range.replace(&quot;Mujeres:&quot;,&apos;&apos;);
		range = range.replace(&quot;-3 a +3&quot;,&apos;&apos;); 
		range = range.replace(&quot;1 a &lt; 10 ao: 130 - 300&quot;,&apos;&apos;); 
		if (range == &quot;  -  &quot;){ range=&quot;&quot;};
		if (range == &quot; - &quot;){ range=&quot;&quot;};
		if (range == &quot;-&quot;){ range=&quot;&quot;};
		range = range.replace(&quot;Menor de &quot;,&apos;&lt;&apos;);
		range = range.replace(&quot;Mayor de &quot;,&apos;&gt;&apos;);
		range = range.replace(&quot;Vlr. Referencia para grupos Especiales: , Prematuros:&quot;,&apos;&apos;); 
		if (isValidRange(range)) {
			logger.warn(&quot;Rango invalido descartado:  &quot; + range + &quot;.&quot;);
			range = &quot;&quot;;
		}
	}
	return range;
}

function isValidRange(range) {
	//var regex = /([\s|-]{0,1}\d{1,2}(\.\d){0,1}\s{0,1}-\s{0,1}\d{1,2}(\.\d){0,1}\s{0,1})|(\s{0,1}[&lt;&gt;]={0,1}\s{0,3}-{0,1}\d{1,2}(\.\d){0,1})/;
	var regex = /[a-zA-Z]/;
	return regex.test(range);
}</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64">TVNIfF5+JnxTWU5DT3x8Q0RTfHwyMDIzMDgyMTA1MTd8fE9SVV5PMDF8MzY4MDB8UHwyLjV8fHx8
fHw4ODU5LzF8fHx8fHx8DVBJRHwxfFJDXjEyMzM4OTQxMTl8MTIzMzg5NDExOXw0NDMyMzg5OTd8
XjIwLUFWUC03ODYtMzA3fENBTlRPUiBST0pBU15KRU5OWSBMT1JFTkF8MjAxNTExMjJ8Rnx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8DVBWMXwxfE98NDQzfHx8fDExNTkwXkhPU1AgSU5G
QU5USUwgVS4gU0FOIEpPU0UgLSBTQUxVRCBUT1RBTCAoIENPTlRSSSApIC0gIFVSR3w5MDAwOTg0
NzZeRlVOREFDSU9OIEhPU1BJVEFMIElORkFOVElMIFVOSVZFUlNJVEFSSU8gREUgU0FOIEpPU0V8
NTAwMF5OTyBESVNQT05JQkxFfDQ0M3x8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8
fHx8fHx8fCANT1JDfE5XfDQ0MzIzODk5N3x8NDQzfHx8MjAyMzA4MjEwNTA5MzF8fHx8fFNZTkxB
QkNPTHx8fHx8fHx8fHx8fHx8fHx8fHx8DU9CUnwxfExCLTE4NTI1OTA1fHw5MDIyMTBeSGVtb2dy
YW1hIFRpcG8gSVZ8fHwyMDIzMDgyMTA1MDkzMnx8fHx8fHx8fHx8fHx8fHx8fEZ8fHx8fHx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8DU5URXwxfHxIRU1PR1JBTUEgQVVUT01BVElaQURPIElWIF98fA1P
Qlh8MXxOTXwwMTBeTGV1Y29jaXRvc3x8MTQuNTV8eDEwXjMgL3VMfDQuMjcgLSAxMS40MHx8fHxG
fHx8MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1PQlh8MnxOTXwwMTVeTmV1dHLDs2Zp
bG9zfHw3MC4xfCV8MjkuOCAtIDcxLjR8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8
fHx8fHwNT0JYfDN8Tk18MDIwXkxpbmZvY2l0b3N8fDIxLjB8JXwxNi43IC0gNTcuOHx8fHxGfHx8
MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1PQlh8NHxOTXwwMjJeR3JhbnVsb2NpdG9z
IElubWFkdXJvc3x8MC41fCV8MC4wICAwLjN8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8
fHx8fHx8fHwNT0JYfDV8Tk18MDMwXk1vbm9jaXRvc3x8Ni41fCV8NC4yIC0gMTEuM3x8fHxGfHx8
MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1PQlh8NnxOTXwwMzVeRW9zaW7Ds2ZpbG9z
fHwxLjR8JXwwLjAgLSA0LjB8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwN
T0JYfDd8Tk18MDQwXkJhc8OzZmlsb3N8fDAuNXwlfDAuMCAgMC42fHx8fEZ8fHwyMDIzMDgyMTA1
MDkzMXx8fHx8fHx8fHx8fHx8fHx8DU9CWHw4fE5NfDA4MV5OZXV0csOzZmlsb3N8fDEwLjIxfHgx
MF4zIC91THwxLjY0IC0gNy44N3x8fHxGfHx8MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8
fA1PQlh8OXxOTXwwODVeTGluZm9jaXRvc3x8My4wNXx4MTBeMyAvdUx8MS4xNiAtIDQuMjh8fHx8
Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwNT0JYfDEwfE5NfDA5MF5HcmFudWxv
Y2l0b3MgSW5tYWR1cm9zfHwwLjA3fHgxMF4zIC91THwwLjAwIC0gMC4wNHx8fHxGfHx8MjAyMzA4
MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1PQlh8MTF8Tk18MDk2Xk1vbm9jaXRvc3x8MC45NXx4
MTBeMyAvdUx8MC4xOSAtIDAuODF8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8
fHwNT0JYfDEyfE5NfDEwMF5Fb3NpbsOzZmlsb3N8fDAuMjB8eDEwXjMgL3VMfDAuMDMgLSAwLjQ3
fHx8fEZ8fHwyMDIzMDgyMTA1MDkzMXx8fHx8fHx8fHx8fHx8fHx8DU9CWHwxM3xOTXwxMDVeQmFz
w7NmaWxvc3x8MC4wN3x4MTBeMyAvdUx8MC4wMSAtIDAuMDV8fHx8Rnx8fDIwMjMwODIxMDUwOTMx
fHx8fHx8fHx8fHx8fHx8fHwNT0JYfDE0fE5NfDE1MF5Fcml0cm9jaXRvc3x8NS4wOHx4MTBeNiAv
dUx8NC4yMCAtIDUuMzB8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwNT0JY
fDE1fE5NfDE2MF5IZW1vZ2xvYmluYXx8MTMuOXxnL2RMfDEwLjAgLSAxNS41MHx8fHxGfHx8MjAy
MzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1PQlh8MTZ8Tk18MTY1XkhlbWF0b2NyaXRvfHw0
MS40fCV8MzQuMCAtIDQzLjB8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwN
T0JYfDE3fE5NfDE4MF5QVkMgKFByb21lZGlvIFZvbHVtZW4gQ29wdXNjdWxhcil8fDgxLjV8Zkx8
NzIuMCAtIDkyLjB8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwNT0JYfDE4
fE5NfDE4NV5QSEMgKFByb21lZGlvIEhlbW9nbG9iaW5hIENvcnB1c2N1bGFyKXx8MjcuNHxwZ3wy
My4wIC0gMzEuMHx8fHxGfHx8MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1PQlh8MTl8
Tk18MTkwXlBDSEMgKFByb21lZGlvIENvbmNlbnRyYWNpw7NuIEhlbW9nbG9iaW5hfHwzMy42fGcv
ZEx8MzIuMCAtIDM2LjB8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwNT0JY
fDIwfFRYfDE5NV5Db3JwdXNjdWxhcil8fF98Rlh8fHx8fEZ8fHwyMDIzMDgyMTA1MDkzMXx8fHx8
fHx8fHx8fHx8fHx8DU9CWHwyMXxOTXwyMDBeQW5jaG8gZGUgRGlzdHJpYnVjacOzbiBFcml0cm9p
ZGV8fDEyLjl8JXwxMi4yIC0gMTQuNHx8fHxGfHx8MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8
fHx8fA1PQlh8MjJ8Tk18Mjk2XlJlY3VlbnRvIGRlIHBsYXF1ZXRhc3x8Mjk1fHgxMF4zIC91THwx
OTkgLSAzNjd8fHx8Rnx8fDIwMjMwODIxMDUwOTMxfHx8fHx8fHx8fHx8fHx8fHwNT0JYfDIzfE5N
fDI5N15Wb2x1bWVuIFBsYXF1ZXRhcmlvIE1lZGlvfHw4LjN8Zkx8OS4zIC0gMTEuM3x8fHxGfHx8
MjAyMzA4MjEwNTA5MzF8fHx8fHx8fHx8fHx8fHx8fA1OVEV8Mnx8Q2l0b21ldHLDrWEgZGUgZmx1
am8gZSBpbXBlZGFuY2lvbWV0csOtYSBfVGVjbmljYXx8DQ==</inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
              <name>Accept message if &quot;msg[&apos;OBR&apos;].toString()&quot; exists</name>
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <field>msg[&apos;OBR&apos;].toString()</field>
              <condition>EXISTS</condition>
              <values/>
            </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
          </elements>
        </filter>
        <transportName>TCP Listener</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Send Case to CDS</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>//map time CDS Send Cese 
channelMap.put(&apos;CDS3 Sent&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">TVNIfF5+JnxTWU5DT3x8Q0RTfHwyMDIzMTExNDIxNDB8fE9SVV5PMDF8Mzc1NDgwfFB8Mi41fHx8
fHx8ODg1OS8xfHx8fHx8fApQSUR8MXxDQ145NDM2ODQ4NXw5NDM2ODQ4NXwwMTYxMjE3MjB8XjIw
LUFWUC03ODYtMzA3fE9SRE/DkUVaIEdBUkNFU15TRVJHSU8gUkFGQUVMIHwxOTczMDYxMXxNfHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHwKUFYxfDF8T3wxNnx8fHw1NTIyXlBBQ0lFTlRF
UyBDQVBJVEFET1MgIEhFTU9ESUFMSVNJUy1UVUxVQXw4MzAwMDczNTVeRlJFU0VOSVVTIE1FRElD
QUwgQ0FSRSBDT0xPTUJJQXw4MDE2MjM2NV5TQU5DSEVaIFNBTkNIRVogIEhVQkVSIEFET0xGTyB8
MTZ8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHwgCk9SQ3xOV3wwMTYx
MjE3MjB8fDE2fHx8MjAyMzExMDQxMDU1NTh8fHx8fFNZTkxBQkNPTHx8fHx8fHx8fHx8fHx8fHx8
fHx8Ck9CUnwxfHx8OTAyMjEwXkhlbW9ncmFtYSBUaXBvIElWfHx8MjAyMzExMTQxNzQ4MDZ8fHx8
fHx8fHx8fHx8fHx8fHxGfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fApOVEV8MXx8SEVNT0dS
QU1BIEFVVE9NQVRJWkFETyBJViBffHwKT0JYfDF8Tk18MDEwXkxldWNvY2l0b3N8fDExLjIxfHgx
MF4zIC91THw0LjUwIC0gMTEuMDB8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8
fHwKT0JYfDJ8Tk18MDE1Xk5ldXRyw7NmaWxvc3x8NjMuOXwlfDQwLjMgLSA3NC44fHx8fEZ8fHwy
MDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHwzfE5NfDAyMF5MaW5mb2NpdG9zfHwy
My4xfCV8MTIuMiAtIDQ3LjF8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwK
T0JYfDR8Tk18MDIyXkdyYW51bG9jaXRvcyBJbm1hZHVyb3N8fDAuNHwlfDAuMCAgMC42fHx8fEZ8
fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHw1fE5NfDAzMF5Nb25vY2l0b3N8
fDguOXwlfDQuNCAtIDEyLjN8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwK
T0JYfDZ8Tk18MDM1XkVvc2luw7NmaWxvc3x8My4zfCV8MC4wIC0gNC40fHx8fEZ8fHwyMDIzMTEw
NDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHw3fE5NfDA0MF5CYXPDs2ZpbG9zfHwwLjR8JXww
LjAgIDAuN3x8fHxGfHx8MjAyMzExMDQxMDU1NTh8fHx8fHx8fHx8fHx8fHx8fApPQlh8OHxOTXww
ODFeTmV1dHLDs2ZpbG9zfHw3LjE2fHgxMF4zIC91THwxLjgyIC0gNy40Mnx8fHxGfHx8MjAyMzEx
MDQxMDU1NTh8fHx8fHx8fHx8fHx8fHx8fApPQlh8OXxOTXwwODVeTGluZm9jaXRvc3x8Mi41OXx4
MTBeMyAvdUx8MC44NSAtIDMuMDB8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8
fHwKT0JYfDEwfE5NfDA5Nl5Nb25vY2l0b3N8fDEuMDB8eDEwXjMgL3VMfDAuMTkgLSAwLjc3fHx8
fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHwxMXxOTXwwOTBeR3JhbnVs
b2NpdG9zIElubWFkdXJvc3x8MC4wNHx4MTBeMyAvdUx8MC4wMCAtIDAuMDl8fHx8Rnx8fDIwMjMx
MTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwKT0JYfDEyfE5NfDEwMF5Fb3NpbsOzZmlsb3N8fDAu
Mzd8eDEwXjMgL3VMfDAuMDMgLSAwLjQ0fHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8
fHx8fHx8Ck9CWHwxM3xOTXwxMDVeQmFzw7NmaWxvc3x8MC4wNHx4MTBeMyAvdUx8MC4wMSAtIDAu
MDV8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwKT0JYfDE0fE5NfDE1MF5F
cml0cm9jaXRvc3x8Mi42Mnx4MTBeNiAvdUx8NC42MCAtIDYuMjB8fHx8Rnx8fDIwMjMxMTA0MTA1
NTU4fHx8fHx8fHx8fHx8fHx8fHwKT0JYfDE1fE5NfDIwMF5BbmNobyBkZSBEaXN0cmlidWNpw7Nu
IEVyaXRyb2lkZXx8MTUuN3wlfDEyLjMgLSAxNC4zfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8
fHx8fHx8fHx8fHx8Ck9CWHwxNnxOTXwxODBeUFZDIChQcm9tZWRpbyBWb2x1bWVuIENvcHVzY3Vs
YXIpfHw4Ny40fGZMfDg2LjAgLSA5Ni4wfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8
fHx8fHx8Ck9CWHwxN3xOTXwxOTBeUENIQyAoUHJvbWVkaW8gQ29uY2VudHJhY2nDs24gSGVtb2ds
b2JpbmF8fDMwLjZ8Zy9kTHwzMi4wIC0gMzguMHx8fHxGfHx8MjAyMzExMDQxMDU1NTh8fHx8fHx8
fHx8fHx8fHx8fApPQlh8MTh8Tk18MTg1XlBIQyAoUHJvbWVkaW8gSGVtb2dsb2JpbmEgQ29ycHVz
Y3VsYXIpfHwyNi43fHBnfDI1LjAgLSAzMS4wfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8
fHx8fHx8fHx8Ck9CWHwxOXxOTXwxNjBeSGVtb2dsb2JpbmF8fDcuMHxnL2RMfDEzLjUwIC0gMTgu
MHx8fHxGfHx8MjAyMzExMDQxMDU1NTh8fHx8fHx8fHx8fHx8fHx8fApPQlh8MjB8Tk18MTY1Xkhl
bWF0b2NyaXRvfHwyMi45fCV8NDAuMCAtIDU0LjB8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8
fHx8fHx8fHx8fHwKT0JYfDIxfE5NfDI5Nl5SZWN1ZW50byBkZSBwbGFxdWV0YXN8fDQ0MHx4MTBe
MyAvdUx8MTUwIC0gNDAwfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9C
WHwyMnxOTXwyOTdeVm9sdW1lbiBQbGFxdWV0YXJpbyBNZWRpb3x8OS4wfGZMfDkuNyAtIDExLjl8
fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwKTlRFfDJ8fENpdG9tZXRyw61h
IGRlIGZsdWpvIGUgaW1wZWRhbmNpb21ldHLDrWEgX1RlY25pY2F8fAo=</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>//map time CDS Response 
channelMap.put(&apos;CDS4 Response&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));
channelMap.put(&apos;HL7Head&apos;,msg[&apos;senderReference&apos;]);
channelMap.put(&apos;approved&apos;,msg[&apos;approved&apos;]);
channelMap.put(&apos;report&apos;, msg[&apos;report&apos;]);
channelMap.put(&apos;caseId&apos;,msg[&apos;caseId&apos;]);
channelMap.put(&apos;kbCode&apos;,msg[&apos;kbCode&apos;]);
channelMap.put(&apos;actions&apos;,JSON.stringify(msg[&apos;actions&apos;]));
channelMap.put(&apos;reviewer&apos;,msg[&apos;reviewer&apos;]);

//save CDS Response 
var rsp = router.routeMessage(&apos;outcoming&apos;, JSON.stringify(msg));
channelMap.put(&apos;JSONResponse&apos;, JSON.stringify(msg));
//check if we have comments of CDS ot actions
var aux_flag = 0;
 if(msg[&apos;report&apos;] != &apos;&apos;){
   if (msg[&apos;report&apos;].indexOf(&apos;&lt;EMAIL#&apos;) &gt;=0){ 	
     aux_flag= 1;
   }else{
   	if (msg[&apos;report&apos;].indexOf(&apos;##EXTERN_P#&apos;) &gt;=0){ 	
       aux_flag= 1;
     }else{
     	if (msg[&apos;report&apos;].indexOf(&apos;##INTERN#&apos;) &gt;=0){ 	
     		aux_flag= 1;
  		 }
     }
   }
 }
  if(msg[&apos;actions&apos;] != &apos;&apos;){
  	aux_flag= 1;
  }
 channelMap.put(&apos;aux_flag&apos;,aux_flag);</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">ew0KICAiY2FzZUlkIiA6ICIiLA0KICAic2l0ZSIgOiAiY2h1Y2siLA0KICAic2VuZGVyUmVmZXJl
bmNlIiA6ICI8SEw3TWVzc2FnZT48TVNIPjxNU0guMT58PC9NU0guMT48TVNILjI+Xn5cXCZhbXA7
PC9NU0guMj48TVNILjM+PE1TSC4zLjE+R2xpbXM8L01TSC4zLjE+PC9NU0guMz48TVNILjQ+PE1T
SC40LjE+Y3liZXJsYWI5U1o8L01TSC40LjE+PC9NU0guND48TVNILjU+PE1TSC41LjE+MTk5OTAy
MDFMRUVTMjE8L01TSC41LjE+PC9NU0guNT48TVNILjY+PE1TSC42LjE+Y3liZXJsYWI5U1o8L01T
SC42LjE+PC9NU0guNj48TVNILjc+PE1TSC43LjE+MjAyMDA1MjAwOTEzMzE8L01TSC43LjE+PC9N
U0guNz48TVNILjgvPjxNU0guOT48TVNILjkuMT5PVUw8L01TSC45LjE+PE1TSC45LjI+UjIyPC9N
U0guOS4yPjwvTVNILjk+PE1TSC4xMD48TVNILjEwLjE+MDcwMDIxMzA4Mjc5PC9NU0guMTAuMT48
L01TSC4xMD48TVNILjExPjxNU0guMTEuMT5QPC9NU0guMTEuMT48L01TSC4xMT48TVNILjEyPjxN
U0guMTIuMT4yLjU8L01TSC4xMi4xPjwvTVNILjEyPjxNU0guMTMvPjxNU0guMTQvPjxNU0guMTU+
PE1TSC4xNS4xPk5FPC9NU0guMTUuMT48L01TSC4xNT48TVNILjE2PjxNU0guMTYuMT5BTDwvTVNI
LjE2LjE+PC9NU0guMTY+PE1TSC4xNy8+PE1TSC4xOD48TVNILjE4LjE+MTI1MjwvTVNILjE4LjE+
PC9NU0guMTg+PC9NU0g+PFBJRD48UElELjE+PFBJRC4xLjE+MTwvUElELjEuMT48L1BJRC4xPjxQ
SUQuMi8+PFBJRC4zPjxQSUQuMy4xPjEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5HTElNUzwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMTIzNDU2
NzwvUElELjMuMT48UElELjMuMi8+PFBJRC4zLjMvPjxQSUQuMy40PktHX0k8L1BJRC4zLjQ+PC9Q
SUQuMz48UElELjM+PFBJRC4zLjE+MDEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5LR19JPC9QSUQuMy40PjwvUElELjM+PFBJRC4zPjxQSUQuMy4xPjAxMjM0NTY3
ODk8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5TWl9JPC9QSUQuMy40Pjwv
UElELjM+PFBJRC4zPjxQSUQuMy4xPjA5ODc2NTQzPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMu
My8+PFBJRC4zLjQ+VERfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMDAwMDAw
MDA8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5OTE1JTkJJWkE8L1BJRC4z
LjQ+PC9QSUQuMz48UElELjM+PFBJRC4zLjE+MDAwMDAwMDAwPC9QSUQuMy4xPjxQSUQuMy4yLz48
UElELjMuMy8+PFBJRC4zLjQ+TUxfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT44
NzY1NDMyPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMuMy8+PFBJRC4zLjQ+Q0FTU0NPTlRST0w8
L1BJRC4zLjQ+PC9QSUQuMz48UElELjQvPjxQSUQuNT48UElELjUuMT5MZWVzbmFhbSB2YW48L1BJ
RC41LjE+PFBJRC41LjI+UElFVEpFPC9QSUQuNS4yPjxQSUQuNS4zPlMuIE4uPC9QSUQuNS4zPjwv
UElELjU+PFBJRC42Lz48UElELjc+PFBJRC43LjE+MTk5OTAyMDE8L1BJRC43LjE+PC9QSUQuNz48
UElELjg+PFBJRC44LjE+RjwvUElELjguMT48L1BJRC44PjxQSUQuOS8+PFBJRC4xMC8+PFBJRC4x
MT48UElELjExLjE+U3Vpa2Vyc3RyYWF0PC9QSUQuMTEuMT48UElELjExLjI+MTE8L1BJRC4xMS4y
PjxQSUQuMTEuMz5EdWNrc3RhZDwvUElELjExLjM+PFBJRC4xMS40Lz48UElELjExLjU+MTEyMkFC
PC9QSUQuMTEuNT48UElELjExLjY+Tkw8L1BJRC4xMS42PjwvUElELjExPjxQSUQuMTIvPjxQSUQu
MTM+PFBJRC4xMy4xPjAyNTU1OTk5OTk8L1BJRC4xMy4xPjxQSUQuMTMuMi8+PFBJRC4xMy4zPlBI
PC9QSUQuMTMuMz48L1BJRC4xMz48UElELjE0Lz48UElELjE1Lz48UElELjE2Lz48UElELjE3Lz48
UElELjE4Lz48UElELjE5Lz48UElELjIwLz48UElELjIxLz48UElELjIyLz48UElELjIzLz48UElE
LjI0PjxQSUQuMjQuMT5OPC9QSUQuMjQuMT48L1BJRC4yND48UElELjI1Lz48UElELjI2Lz48UElE
LjI3Lz48UElELjI4Lz48UElELjI5Lz48UElELjMwPjxQSUQuMzAuMT5OPC9QSUQuMzAuMT48L1BJ
RC4zMD48L1BJRD48UEQxPjxQRDEuMS8+PFBEMS4yLz48UEQxLjMvPjxQRDEuND48UEQxLjQuMT4w
MTAyMzg2ODwvUEQxLjQuMT48UEQxLjQuMj5BYmJla2VyazwvUEQxLjQuMj48UEQxLjQuMz5FLk0u
PC9QRDEuNC4zPjxQRDEuNC40Lz48UEQxLjQuNS8+PFBEMS40LjYvPjxQRDEuNC43Lz48UEQxLjQu
OC8+PFBEMS40Ljk+R0xJTVM8L1BEMS40Ljk+PC9QRDEuND48L1BEMT48UFYxPjxQVjEuMT48UFYx
LjEuMT4xPC9QVjEuMS4xPjwvUFYxLjE+PFBWMS4yPjxQVjEuMi4xPkk8L1BWMS4yLjE+PC9QVjEu
Mj48UFYxLjM+PFBWMS4zLjE+SEFaSUNVPC9QVjEuMy4xPjxQVjEuMy4yPjUyMTcxNzwvUFYxLjMu
Mj48UFYxLjMuMy8+PFBWMS4zLjQvPjxQVjEuMy41Lz48UFYxLjMuNi8+PFBWMS4zLjcvPjxQVjEu
My44Lz48UFYxLjMuOS8+PFBWMS4zLjEwLz48UFYxLjMuMTE+R0xJTVM8L1BWMS4zLjExPjwvUFYx
LjM+PFBWMS40Lz48UFYxLjUvPjxQVjEuNi8+PFBWMS43Lz48UFYxLjgvPjxQVjEuOS8+PFBWMS4x
MC8+PFBWMS4xMS8+PFBWMS4xMi8+PFBWMS4xMy8+PFBWMS4xNC8+PFBWMS4xNS8+PFBWMS4xNi8+
PFBWMS4xNy8+PFBWMS4xOC8+PFBWMS4xOT48UFYxLjE5LjE+NTYyMzIwNjM8L1BWMS4xOS4xPjwv
UFYxLjE5PjxQVjEuMjAvPjxQVjEuMjEvPjxQVjEuMjIvPjxQVjEuMjMvPjxQVjEuMjQvPjxQVjEu
MjUvPjxQVjEuMjYvPjxQVjEuMjcvPjxQVjEuMjgvPjxQVjEuMjkvPjxQVjEuMzAvPjxQVjEuMzEv
PjxQVjEuMzIvPjxQVjEuMzMvPjxQVjEuMzQvPjxQVjEuMzUvPjxQVjEuMzYvPjxQVjEuMzcvPjxQ
VjEuMzgvPjxQVjEuMzkvPjxQVjEuNDAvPjxQVjEuNDEvPjxQVjEuNDIvPjxQVjEuNDMvPjxQVjEu
NDQ+PFBWMS40NC4xPjIwMjAwMzIxMTgxMzA1PC9QVjEuNDQuMT48L1BWMS40ND48UFYxLjQ1PjxQ
VjEuNDUuMT4yMDIwMDQwODEwMTUwMDwvUFYxLjQ1LjE+PC9QVjEuNDU+PC9QVjE+PFBWMT48UFYx
LjE+PFBWMS4xLjE+MTwvUFYxLjEuMT48L1BWMS4xPjxQVjEuMj48UFYxLjIuMT5JPC9QVjEuMi4x
PjwvUFYxLjI+PFBWMS4zPjxQVjEuMy4xPkhBWklDVTwvUFYxLjMuMT48UFYxLjMuMj41MjE3MTc8
L1BWMS4zLjI+PFBWMS4zLjMvPjxQVjEuMy40Lz48UFYxLjMuNS8+PFBWMS4zLjYvPjxQVjEuMy43
Lz48UFYxLjMuOC8+PFBWMS4zLjkvPjxQVjEuMy4xMC8+PFBWMS4zLjExPkdMSU1TPC9QVjEuMy4x
MT48L1BWMS4zPjxQVjEuNC8+PFBWMS41Lz48UFYxLjYvPjxQVjEuNy8+PFBWMS44Lz48UFYxLjkv
PjxQVjEuMTAvPjxQVjEuMTEvPjxQVjEuMTIvPjxQVjEuMTMvPjxQVjEuMTQvPjxQVjEuMTUvPjxQ
VjEuMTYvPjxQVjEuMTcvPjxQVjEuMTgvPjxQVjEuMTk+PFBWMS4xOS4xPjU2MjMyMDYzPC9QVjEu
MTkuMT48L1BWMS4xOT48UFYxLjIwLz48UFYxLjIxLz48UFYxLjIyLz48UFYxLjIzLz48UFYxLjI0
Lz48UFYxLjI1Lz48UFYxLjI2Lz48UFYxLjI3Lz48UFYxLjI4Lz48UFYxLjI5Lz48UFYxLjMwLz48
UFYxLjMxLz48UFYxLjMyLz48UFYxLjMzLz48UFYxLjM0Lz48UFYxLjM1Lz48UFYxLjM2Lz48UFYx
LjM3Lz48UFYxLjM4Lz48UFYxLjM5Lz48UFYxLjQwLz48UFYxLjQxLz48UFYxLjQyLz48UFYxLjQz
Lz48UFYxLjQ0PjxQVjEuNDQuMT4yMDIwMDMyMTE4MTMwNTwvUFYxLjQ0LjE+PC9QVjEuNDQ+PFBW
MS40NT48UFYxLjQ1LjE+MjAyMDA0MDgxMDE1MDA8L1BWMS40NS4xPjwvUFYxLjQ1PjwvUFYxPjxT
UE0+PFNQTS4xPjxTUE0uMS4xPjE8L1NQTS4xLjE+PC9TUE0uMT48U1BNLjI+PFNQTS4yLjEvPjxT
UE0uMi4yPjxTUE0uMi4yLjE+MjAwMzI0MDQwNjAyPC9TUE0uMi4yLjE+PFNQTS4yLjIuMj5HTElN
UzwvU1BNLjIuMi4yPjwvU1BNLjIuMj48L1NQTS4yPjxTUE0uMy8+PFNQTS40PjxTUE0uNC4xPlZC
Q0FQPC9TUE0uNC4xPjxTUE0uNC4yPlZvbGJsb2VkIENhcGlsbGFpcjwvU1BNLjQuMj48U1BNLjQu
Mz5HTElNUzwvU1BNLjQuMz48L1NQTS40PjxTUE0uNS8+PFNQTS42Lz48U1BNLjcvPjxTUE0uOC8+
PFNQTS45Lz48U1BNLjEwLz48U1BNLjExLz48U1BNLjEyPjxTUE0uMTIuMT4wPC9TUE0uMTIuMT48
U1BNLjEyLjI+PFNQTS4xMi4yLjE+bWw8L1NQTS4xMi4yLjE+PFNQTS4xMi4yLjI+bWw8L1NQTS4x
Mi4yLjI+PFNQTS4xMi4yLjM+R0xJTVM8L1NQTS4xMi4yLjM+PC9TUE0uMTIuMj48L1NQTS4xMj48
U1BNLjEzLz48U1BNLjE0Lz48U1BNLjE1Lz48U1BNLjE2Lz48U1BNLjE3PjxTUE0uMTcuMT4yMDIw
MDMyNDEzNTMyNzwvU1BNLjE3LjE+PC9TUE0uMTc+PFNQTS4xOD48U1BNLjE4LjE+MjAyMDAzMjQx
MzUzMjc8L1NQTS4xOC4xPjwvU1BNLjE4PjxTUE0uMTkvPjxTUE0uMjA+PFNQTS4yMC4xPlk8L1NQ
TS4yMC4xPjwvU1BNLjIwPjwvU1BNPjxPUkM+PE9SQy4xPjxPUkMuMS4xPlNDPC9PUkMuMS4xPjwv
T1JDLjE+PE9SQy4yLz48T1JDLjM+PE9SQy4zLjE+RV8yMDAzMjQwMzI4PC9PUkMuMy4xPjxPUkMu
My4yPkdMSU1TPC9PUkMuMy4yPjwvT1JDLjM+PE9SQy40Lz48T1JDLjU+PE9SQy41LjE+Q008L09S
Qy41LjE+PC9PUkMuNT48T1JDLjYvPjxPUkMuNz48T1JDLjcuMS8+PE9SQy43LjIvPjxPUkMuNy4z
Lz48T1JDLjcuND4yMDIwMDMyNDEzNTMyNzwvT1JDLjcuND48T1JDLjcuNS8+PE9SQy43LjY+Ujwv
T1JDLjcuNj48L09SQy43PjxPUkMuOC8+PE9SQy45PjxPUkMuOS4xPjIwMjAwNTIwMDkxMzMxPC9P
UkMuOS4xPjwvT1JDLjk+PE9SQy4xMC8+PE9SQy4xMS8+PE9SQy4xMj48T1JDLjEyLjE+MTAwMDAw
MDc2MDwvT1JDLjEyLjE+PE9SQy4xMi4yPkJFTk5FUjwvT1JDLjEyLjI+PE9SQy4xMi4zPlBNLmlu
dGVuc2l2aXN0PC9PUkMuMTIuMz48T1JDLjEyLjQvPjxPUkMuMTIuNS8+PE9SQy4xMi42Lz48T1JD
LjEyLjcvPjxPUkMuMTIuOC8+PE9SQy4xMi45PlNaX0k8L09SQy4xMi45PjwvT1JDLjEyPjxPUkMu
MTM+PE9SQy4xMy4xPkhBWklDVTwvT1JDLjEzLjE+PE9SQy4xMy4yLz48T1JDLjEzLjMvPjxPUkMu
MTMuNC8+PE9SQy4xMy41Lz48T1JDLjEzLjYvPjxPUkMuMTMuNy8+PE9SQy4xMy44Lz48T1JDLjEz
LjkvPjxPUkMuMTMuMTAvPjxPUkMuMTMuMTE+R0xJTVM8L09SQy4xMy4xMT48L09SQy4xMz48T1JD
LjE0Lz48T1JDLjE1Lz48T1JDLjE2Lz48T1JDLjE3PjxPUkMuMTcuMT5LR0VHPC9PUkMuMTcuMT48
T1JDLjE3LjI+RGVjZW50cmFhbCBTcGFhcm5lZ2FzdGh1aXMgbG9jYXRpZSBIYWFybGVtIHp1aWQ8
L09SQy4xNy4yPjxPUkMuMTcuMz5HTElNUzwvT1JDLjE3LjM+PC9PUkMuMTc+PE9SQy4xOC8+PE9S
Qy4xOT48T1JDLjE5LjE+MTAwMDAwMTE3OTwvT1JDLjE5LjE+PE9SQy4xOS4yPlByb25rLUFkbWly
YWFsPC9PUkMuMTkuMj48T1JDLjE5LjM+Q0o8L09SQy4xOS4zPjxPUkMuMTkuNC8+PE9SQy4xOS41
Lz48T1JDLjE5LjYvPjxPUkMuMTkuNz5Eci48L09SQy4xOS43PjxPUkMuMTkuOC8+PE9SQy4xOS45
PlNaX0k8L09SQy4xOS45PjwvT1JDLjE5PjwvT1JDPjwvSEw3TWVzc2FnZT4iLA0KICAiYXBwcm92
ZWQiIDogdHJ1ZQ0KfQ==</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;msg_type&apos;)&quot; equals &apos;ORU&apos;</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;msg_type&apos;)</field>
                <condition>EQUALS</condition>
                <values>
                  <string>&apos;ORU&apos;</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>false</waitForPrevious>
        </connector>
        <connector version="3.9.1">
          <metaDataId>2</metaDataId>
          <name>Generate Response</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>03226d36-9fd4-49ce-a918-28b4fb9517b3</channelId>
            <channelTemplate>${JSONResponse}</channelTemplate>
            <mapVariables>
              <string>Case</string>
              <string>PID</string>
              <string>PID2</string>
              <string>CDS1 Request</string>
              <string>CDS2 Sent</string>
              <string>CDS4 Response</string>
              <string>CDS2 Retrieve Historical Data</string>
            </mapVariables>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64">TVNIfF5+XCZ8Wm9yZ0RvbWVpbnx8R0xJTVN8QXRhbG1lZGlhbC1BTVNURUxWRUVOfDIwMjAwNDMw
MTMzMTAxKzAyMDB8fE9NTF5PMjFeT01MX08yMXxaRDY3NTU3ODIwfFB8Mi41fHx8fHxOTER8ODg1
OS8xClBJRHwxfHwxMjM0NTY3ODleXl5OTE1JTkJJWkFeTk5OTER8fER1Y2sgLSBHZWx1ayYmR2Vs
dWsmJkR1Y2teQV5eXl5eTHx8MTk0NDEwMjV8Rnx8fFdvcnRlbHN0cmFhdCBXLiA4NiZXb3J0ZWxz
dHJhYXQgVy4mODZeXkR1Y2tzdGFkXl41NTc3WFleTkxeSApQVjF8MXxPCklOMXwxfF5udWxsfDBe
Xl5eTE9DQUx8Wm9yZyBlbiBaZWtlcmhlaWQgWm9yZ3Zlcnpla2VyaW5nZW4qfHx8fHx8fHx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHwxMjM0ODg5MjAyCk9SQ3xOV3xaRDY3NTU3ODIwXzAxfHxaRDY3
NTU3ODIwfHx8Xl5eXl5SfHwyMDIwMDQzMDEzMjgxNCswMjAwfF4mJlBldGVyc2VuXlYufHwwMTEw
MjIzNF4mJk1hbmRqZXMgLSB2YW4gVWl0ZXJ0Xk1KR15eXl5eXlZFS1RJU3x8fHx8MzQwMDkyNzle
QXRhbG1lZGlhbCwgUmVnaW8gQW1zdGVsbGFuZF5MClRRMXwxfHx8fHx8fHxSCk9CUnwxfFpENjc1
NTc4MjBfMDF8fEZUNF5WcmlqIFQ0Xkx8fHx8fHx8T3x8fHx8MDExMDIyMzReJiZNYW5kamVzIC0g
dmFuIFVpdGVydF5NSkdeXl5eXl5WRUtUSVM=</inboundTemplate>
            <outboundTemplate encoding="base64">TVNIfF5+XCZ8Wm9yZ0RvbWVpbnx8R0xJTVN8QXRhbG1lZGlhbC1BTVNURUxWRUVOfDIwMjAwNDMw
MTMzMTAxKzAyMDB8fE9NTF5PMjFeT01MX08yMXxaRDY3NTU3ODIwfFB8Mi41fHx8fHxOTER8ODg1
OS8xClBJRHwxfHwxMjM0NTY3ODleXl5OTE1JTkJJWkFeTk5OTER8fER1Y2sgLSBHZWx1ayYmR2Vs
dWsmJkR1Y2teQV5eXl5eTHx8MTk0NDEwMjV8Rnx8fFdvcnRlbHN0cmFhdCBXLiA4NiZXb3J0ZWxz
dHJhYXQgVy4mODZeXkR1Y2tzdGFkXl41NTc3WFleTkxeSApQVjF8MXxPCklOMXwxfF5udWxsfDBe
Xl5eTE9DQUx8Wm9yZyBlbiBaZWtlcmhlaWQgWm9yZ3Zlcnpla2VyaW5nZW4qfHx8fHx8fHx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHwxMjM0ODg5MjAyCk9SQ3xOV3xaRDY3NTU3ODIwXzAxfHxaRDY3
NTU3ODIwfHx8Xl5eXl5SfHwyMDIwMDQzMDEzMjgxNCswMjAwfF4mJlBldGVyc2VuXlYufHwwMTEw
MjIzNF4mJk1hbmRqZXMgLSB2YW4gVWl0ZXJ0Xk1KR15eXl5eXlZFS1RJU3x8fHx8MzQwMDkyNzle
QXRhbG1lZGlhbCwgUmVnaW8gQW1zdGVsbGFuZF5MClRRMXwxfHx8fHx8fHxSCk9CUnwxfFpENjc1
NTc4MjBfMDF8fEZUNF5WcmlqIFQ0Xkx8fHx8fHx8T3x8fHx8MDExMDIyMzReJiZNYW5kamVzIC0g
dmFuIFVpdGVydF5NSkdeXl5eXl5WRUtUSVM=</outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;aux_flag&apos;)&quot; equals 1</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;aux_flag&apos;)</field>
                <condition>EQUALS</condition>
                <values>
                  <string>1</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.1">
          <metaDataId>14</metaDataId>
          <name>Send Case to Critico</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>b5993ac1-6c39-4fca-a0c2-fdd8c276e1db</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>//map time CDS Send Cese 
channelMap.put(&apos;CDS3 Sent&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">TVNIfF5+JnxTWU5DT3x8Q0RTfHwyMDIzMTExNDIxNDB8fE9SVV5PMDF8Mzc1NDgwfFB8Mi41fHx8
fHx8ODg1OS8xfHx8fHx8fApQSUR8MXxDQ145NDM2ODQ4NXw5NDM2ODQ4NXwwMTYxMjE3MjB8XjIw
LUFWUC03ODYtMzA3fE9SRE/DkUVaIEdBUkNFU15TRVJHSU8gUkFGQUVMIHwxOTczMDYxMXxNfHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHwKUFYxfDF8T3wxNnx8fHw1NTIyXlBBQ0lFTlRF
UyBDQVBJVEFET1MgIEhFTU9ESUFMSVNJUy1UVUxVQXw4MzAwMDczNTVeRlJFU0VOSVVTIE1FRElD
QUwgQ0FSRSBDT0xPTUJJQXw4MDE2MjM2NV5TQU5DSEVaIFNBTkNIRVogIEhVQkVSIEFET0xGTyB8
MTZ8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHwgCk9SQ3xOV3wwMTYx
MjE3MjB8fDE2fHx8MjAyMzExMDQxMDU1NTh8fHx8fFNZTkxBQkNPTHx8fHx8fHx8fHx8fHx8fHx8
fHx8Ck9CUnwxfHx8OTAyMjEwXkhlbW9ncmFtYSBUaXBvIElWfHx8MjAyMzExMTQxNzQ4MDZ8fHx8
fHx8fHx8fHx8fHx8fHxGfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fApOVEV8MXx8SEVNT0dS
QU1BIEFVVE9NQVRJWkFETyBJViBffHwKT0JYfDF8Tk18MDEwXkxldWNvY2l0b3N8fDExLjIxfHgx
MF4zIC91THw0LjUwIC0gMTEuMDB8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8
fHwKT0JYfDJ8Tk18MDE1Xk5ldXRyw7NmaWxvc3x8NjMuOXwlfDQwLjMgLSA3NC44fHx8fEZ8fHwy
MDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHwzfE5NfDAyMF5MaW5mb2NpdG9zfHwy
My4xfCV8MTIuMiAtIDQ3LjF8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwK
T0JYfDR8Tk18MDIyXkdyYW51bG9jaXRvcyBJbm1hZHVyb3N8fDAuNHwlfDAuMCAgMC42fHx8fEZ8
fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHw1fE5NfDAzMF5Nb25vY2l0b3N8
fDguOXwlfDQuNCAtIDEyLjN8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwK
T0JYfDZ8Tk18MDM1XkVvc2luw7NmaWxvc3x8My4zfCV8MC4wIC0gNC40fHx8fEZ8fHwyMDIzMTEw
NDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHw3fE5NfDA0MF5CYXPDs2ZpbG9zfHwwLjR8JXww
LjAgIDAuN3x8fHxGfHx8MjAyMzExMDQxMDU1NTh8fHx8fHx8fHx8fHx8fHx8fApPQlh8OHxOTXww
ODFeTmV1dHLDs2ZpbG9zfHw3LjE2fHgxMF4zIC91THwxLjgyIC0gNy40Mnx8fHxGfHx8MjAyMzEx
MDQxMDU1NTh8fHx8fHx8fHx8fHx8fHx8fApPQlh8OXxOTXwwODVeTGluZm9jaXRvc3x8Mi41OXx4
MTBeMyAvdUx8MC44NSAtIDMuMDB8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8
fHwKT0JYfDEwfE5NfDA5Nl5Nb25vY2l0b3N8fDEuMDB8eDEwXjMgL3VMfDAuMTkgLSAwLjc3fHx8
fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9CWHwxMXxOTXwwOTBeR3JhbnVs
b2NpdG9zIElubWFkdXJvc3x8MC4wNHx4MTBeMyAvdUx8MC4wMCAtIDAuMDl8fHx8Rnx8fDIwMjMx
MTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwKT0JYfDEyfE5NfDEwMF5Fb3NpbsOzZmlsb3N8fDAu
Mzd8eDEwXjMgL3VMfDAuMDMgLSAwLjQ0fHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8
fHx8fHx8Ck9CWHwxM3xOTXwxMDVeQmFzw7NmaWxvc3x8MC4wNHx4MTBeMyAvdUx8MC4wMSAtIDAu
MDV8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwKT0JYfDE0fE5NfDE1MF5F
cml0cm9jaXRvc3x8Mi42Mnx4MTBeNiAvdUx8NC42MCAtIDYuMjB8fHx8Rnx8fDIwMjMxMTA0MTA1
NTU4fHx8fHx8fHx8fHx8fHx8fHwKT0JYfDE1fE5NfDIwMF5BbmNobyBkZSBEaXN0cmlidWNpw7Nu
IEVyaXRyb2lkZXx8MTUuN3wlfDEyLjMgLSAxNC4zfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8
fHx8fHx8fHx8fHx8Ck9CWHwxNnxOTXwxODBeUFZDIChQcm9tZWRpbyBWb2x1bWVuIENvcHVzY3Vs
YXIpfHw4Ny40fGZMfDg2LjAgLSA5Ni4wfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8
fHx8fHx8Ck9CWHwxN3xOTXwxOTBeUENIQyAoUHJvbWVkaW8gQ29uY2VudHJhY2nDs24gSGVtb2ds
b2JpbmF8fDMwLjZ8Zy9kTHwzMi4wIC0gMzguMHx8fHxGfHx8MjAyMzExMDQxMDU1NTh8fHx8fHx8
fHx8fHx8fHx8fApPQlh8MTh8Tk18MTg1XlBIQyAoUHJvbWVkaW8gSGVtb2dsb2JpbmEgQ29ycHVz
Y3VsYXIpfHwyNi43fHBnfDI1LjAgLSAzMS4wfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8
fHx8fHx8fHx8Ck9CWHwxOXxOTXwxNjBeSGVtb2dsb2JpbmF8fDcuMHxnL2RMfDEzLjUwIC0gMTgu
MHx8fHxGfHx8MjAyMzExMDQxMDU1NTh8fHx8fHx8fHx8fHx8fHx8fApPQlh8MjB8Tk18MTY1Xkhl
bWF0b2NyaXRvfHwyMi45fCV8NDAuMCAtIDU0LjB8fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8
fHx8fHx8fHx8fHwKT0JYfDIxfE5NfDI5Nl5SZWN1ZW50byBkZSBwbGFxdWV0YXN8fDQ0MHx4MTBe
MyAvdUx8MTUwIC0gNDAwfHx8fEZ8fHwyMDIzMTEwNDEwNTU1OHx8fHx8fHx8fHx8fHx8fHx8Ck9C
WHwyMnxOTXwyOTdeVm9sdW1lbiBQbGFxdWV0YXJpbyBNZWRpb3x8OS4wfGZMfDkuNyAtIDExLjl8
fHx8Rnx8fDIwMjMxMTA0MTA1NTU4fHx8fHx8fHx8fHx8fHx8fHwKTlRFfDJ8fENpdG9tZXRyw61h
IGRlIGZsdWpvIGUgaW1wZWRhbmNpb21ldHLDrWEgX1RlY25pY2F8fAo=</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>//map time CDS Response 
channelMap.put(&apos;CDS4 Response&apos;,DateUtil.getCurrentDate(&quot;yyyyMMddHHmmssSSS&quot;));
channelMap.put(&apos;HL7Head&apos;,msg[&apos;senderReference&apos;]);
channelMap.put(&apos;approved&apos;,msg[&apos;approved&apos;]);
channelMap.put(&apos;report&apos;, msg[&apos;report&apos;]);
channelMap.put(&apos;caseId&apos;,msg[&apos;caseId&apos;]);
channelMap.put(&apos;kbCode&apos;,msg[&apos;kbCode&apos;]);
channelMap.put(&apos;actions&apos;,JSON.stringify(msg[&apos;actions&apos;]));
channelMap.put(&apos;reviewer&apos;,msg[&apos;reviewer&apos;]);

//save CDS Response 
var rsp = router.routeMessage(&apos;outcoming&apos;, JSON.stringify(msg));
channelMap.put(&apos;JSONResponse2&apos;, JSON.stringify(msg));
//check if we have comments of CDS ot actions
var aux_flag = 0;
 if(msg[&apos;report&apos;] != &apos;&apos;){
   if (msg[&apos;report&apos;].indexOf(&apos;&lt;EMAIL#&apos;) &gt;=0){ 	
     aux_flag= 1;
   }else{
   	if (msg[&apos;report&apos;].indexOf(&apos;##EXTERN_P#&apos;) &gt;=0){ 	
       aux_flag= 1;
     }else{
     	if (msg[&apos;report&apos;].indexOf(&apos;##INTERN#&apos;) &gt;=0){ 	
     		aux_flag= 1;
  		 }
     }
   }
 }
  if(msg[&apos;actions&apos;] != &apos;&apos;){
  	aux_flag= 1;
  }
 channelMap.put(&apos;aux_flag&apos;,aux_flag);</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">ew0KICAiY2FzZUlkIiA6ICIiLA0KICAic2l0ZSIgOiAiY2h1Y2siLA0KICAic2VuZGVyUmVmZXJl
bmNlIiA6ICI8SEw3TWVzc2FnZT48TVNIPjxNU0guMT58PC9NU0guMT48TVNILjI+Xn5cXCZhbXA7
PC9NU0guMj48TVNILjM+PE1TSC4zLjE+R2xpbXM8L01TSC4zLjE+PC9NU0guMz48TVNILjQ+PE1T
SC40LjE+Y3liZXJsYWI5U1o8L01TSC40LjE+PC9NU0guND48TVNILjU+PE1TSC41LjE+MTk5OTAy
MDFMRUVTMjE8L01TSC41LjE+PC9NU0guNT48TVNILjY+PE1TSC42LjE+Y3liZXJsYWI5U1o8L01T
SC42LjE+PC9NU0guNj48TVNILjc+PE1TSC43LjE+MjAyMDA1MjAwOTEzMzE8L01TSC43LjE+PC9N
U0guNz48TVNILjgvPjxNU0guOT48TVNILjkuMT5PVUw8L01TSC45LjE+PE1TSC45LjI+UjIyPC9N
U0guOS4yPjwvTVNILjk+PE1TSC4xMD48TVNILjEwLjE+MDcwMDIxMzA4Mjc5PC9NU0guMTAuMT48
L01TSC4xMD48TVNILjExPjxNU0guMTEuMT5QPC9NU0guMTEuMT48L01TSC4xMT48TVNILjEyPjxN
U0guMTIuMT4yLjU8L01TSC4xMi4xPjwvTVNILjEyPjxNU0guMTMvPjxNU0guMTQvPjxNU0guMTU+
PE1TSC4xNS4xPk5FPC9NU0guMTUuMT48L01TSC4xNT48TVNILjE2PjxNU0guMTYuMT5BTDwvTVNI
LjE2LjE+PC9NU0guMTY+PE1TSC4xNy8+PE1TSC4xOD48TVNILjE4LjE+MTI1MjwvTVNILjE4LjE+
PC9NU0guMTg+PC9NU0g+PFBJRD48UElELjE+PFBJRC4xLjE+MTwvUElELjEuMT48L1BJRC4xPjxQ
SUQuMi8+PFBJRC4zPjxQSUQuMy4xPjEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5HTElNUzwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMTIzNDU2
NzwvUElELjMuMT48UElELjMuMi8+PFBJRC4zLjMvPjxQSUQuMy40PktHX0k8L1BJRC4zLjQ+PC9Q
SUQuMz48UElELjM+PFBJRC4zLjE+MDEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5LR19JPC9QSUQuMy40PjwvUElELjM+PFBJRC4zPjxQSUQuMy4xPjAxMjM0NTY3
ODk8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5TWl9JPC9QSUQuMy40Pjwv
UElELjM+PFBJRC4zPjxQSUQuMy4xPjA5ODc2NTQzPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMu
My8+PFBJRC4zLjQ+VERfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMDAwMDAw
MDA8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5OTE1JTkJJWkE8L1BJRC4z
LjQ+PC9QSUQuMz48UElELjM+PFBJRC4zLjE+MDAwMDAwMDAwPC9QSUQuMy4xPjxQSUQuMy4yLz48
UElELjMuMy8+PFBJRC4zLjQ+TUxfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT44
NzY1NDMyPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMuMy8+PFBJRC4zLjQ+Q0FTU0NPTlRST0w8
L1BJRC4zLjQ+PC9QSUQuMz48UElELjQvPjxQSUQuNT48UElELjUuMT5MZWVzbmFhbSB2YW48L1BJ
RC41LjE+PFBJRC41LjI+UElFVEpFPC9QSUQuNS4yPjxQSUQuNS4zPlMuIE4uPC9QSUQuNS4zPjwv
UElELjU+PFBJRC42Lz48UElELjc+PFBJRC43LjE+MTk5OTAyMDE8L1BJRC43LjE+PC9QSUQuNz48
UElELjg+PFBJRC44LjE+RjwvUElELjguMT48L1BJRC44PjxQSUQuOS8+PFBJRC4xMC8+PFBJRC4x
MT48UElELjExLjE+U3Vpa2Vyc3RyYWF0PC9QSUQuMTEuMT48UElELjExLjI+MTE8L1BJRC4xMS4y
PjxQSUQuMTEuMz5EdWNrc3RhZDwvUElELjExLjM+PFBJRC4xMS40Lz48UElELjExLjU+MTEyMkFC
PC9QSUQuMTEuNT48UElELjExLjY+Tkw8L1BJRC4xMS42PjwvUElELjExPjxQSUQuMTIvPjxQSUQu
MTM+PFBJRC4xMy4xPjAyNTU1OTk5OTk8L1BJRC4xMy4xPjxQSUQuMTMuMi8+PFBJRC4xMy4zPlBI
PC9QSUQuMTMuMz48L1BJRC4xMz48UElELjE0Lz48UElELjE1Lz48UElELjE2Lz48UElELjE3Lz48
UElELjE4Lz48UElELjE5Lz48UElELjIwLz48UElELjIxLz48UElELjIyLz48UElELjIzLz48UElE
LjI0PjxQSUQuMjQuMT5OPC9QSUQuMjQuMT48L1BJRC4yND48UElELjI1Lz48UElELjI2Lz48UElE
LjI3Lz48UElELjI4Lz48UElELjI5Lz48UElELjMwPjxQSUQuMzAuMT5OPC9QSUQuMzAuMT48L1BJ
RC4zMD48L1BJRD48UEQxPjxQRDEuMS8+PFBEMS4yLz48UEQxLjMvPjxQRDEuND48UEQxLjQuMT4w
MTAyMzg2ODwvUEQxLjQuMT48UEQxLjQuMj5BYmJla2VyazwvUEQxLjQuMj48UEQxLjQuMz5FLk0u
PC9QRDEuNC4zPjxQRDEuNC40Lz48UEQxLjQuNS8+PFBEMS40LjYvPjxQRDEuNC43Lz48UEQxLjQu
OC8+PFBEMS40Ljk+R0xJTVM8L1BEMS40Ljk+PC9QRDEuND48L1BEMT48UFYxPjxQVjEuMT48UFYx
LjEuMT4xPC9QVjEuMS4xPjwvUFYxLjE+PFBWMS4yPjxQVjEuMi4xPkk8L1BWMS4yLjE+PC9QVjEu
Mj48UFYxLjM+PFBWMS4zLjE+SEFaSUNVPC9QVjEuMy4xPjxQVjEuMy4yPjUyMTcxNzwvUFYxLjMu
Mj48UFYxLjMuMy8+PFBWMS4zLjQvPjxQVjEuMy41Lz48UFYxLjMuNi8+PFBWMS4zLjcvPjxQVjEu
My44Lz48UFYxLjMuOS8+PFBWMS4zLjEwLz48UFYxLjMuMTE+R0xJTVM8L1BWMS4zLjExPjwvUFYx
LjM+PFBWMS40Lz48UFYxLjUvPjxQVjEuNi8+PFBWMS43Lz48UFYxLjgvPjxQVjEuOS8+PFBWMS4x
MC8+PFBWMS4xMS8+PFBWMS4xMi8+PFBWMS4xMy8+PFBWMS4xNC8+PFBWMS4xNS8+PFBWMS4xNi8+
PFBWMS4xNy8+PFBWMS4xOC8+PFBWMS4xOT48UFYxLjE5LjE+NTYyMzIwNjM8L1BWMS4xOS4xPjwv
UFYxLjE5PjxQVjEuMjAvPjxQVjEuMjEvPjxQVjEuMjIvPjxQVjEuMjMvPjxQVjEuMjQvPjxQVjEu
MjUvPjxQVjEuMjYvPjxQVjEuMjcvPjxQVjEuMjgvPjxQVjEuMjkvPjxQVjEuMzAvPjxQVjEuMzEv
PjxQVjEuMzIvPjxQVjEuMzMvPjxQVjEuMzQvPjxQVjEuMzUvPjxQVjEuMzYvPjxQVjEuMzcvPjxQ
VjEuMzgvPjxQVjEuMzkvPjxQVjEuNDAvPjxQVjEuNDEvPjxQVjEuNDIvPjxQVjEuNDMvPjxQVjEu
NDQ+PFBWMS40NC4xPjIwMjAwMzIxMTgxMzA1PC9QVjEuNDQuMT48L1BWMS40ND48UFYxLjQ1PjxQ
VjEuNDUuMT4yMDIwMDQwODEwMTUwMDwvUFYxLjQ1LjE+PC9QVjEuNDU+PC9QVjE+PFBWMT48UFYx
LjE+PFBWMS4xLjE+MTwvUFYxLjEuMT48L1BWMS4xPjxQVjEuMj48UFYxLjIuMT5JPC9QVjEuMi4x
PjwvUFYxLjI+PFBWMS4zPjxQVjEuMy4xPkhBWklDVTwvUFYxLjMuMT48UFYxLjMuMj41MjE3MTc8
L1BWMS4zLjI+PFBWMS4zLjMvPjxQVjEuMy40Lz48UFYxLjMuNS8+PFBWMS4zLjYvPjxQVjEuMy43
Lz48UFYxLjMuOC8+PFBWMS4zLjkvPjxQVjEuMy4xMC8+PFBWMS4zLjExPkdMSU1TPC9QVjEuMy4x
MT48L1BWMS4zPjxQVjEuNC8+PFBWMS41Lz48UFYxLjYvPjxQVjEuNy8+PFBWMS44Lz48UFYxLjkv
PjxQVjEuMTAvPjxQVjEuMTEvPjxQVjEuMTIvPjxQVjEuMTMvPjxQVjEuMTQvPjxQVjEuMTUvPjxQ
VjEuMTYvPjxQVjEuMTcvPjxQVjEuMTgvPjxQVjEuMTk+PFBWMS4xOS4xPjU2MjMyMDYzPC9QVjEu
MTkuMT48L1BWMS4xOT48UFYxLjIwLz48UFYxLjIxLz48UFYxLjIyLz48UFYxLjIzLz48UFYxLjI0
Lz48UFYxLjI1Lz48UFYxLjI2Lz48UFYxLjI3Lz48UFYxLjI4Lz48UFYxLjI5Lz48UFYxLjMwLz48
UFYxLjMxLz48UFYxLjMyLz48UFYxLjMzLz48UFYxLjM0Lz48UFYxLjM1Lz48UFYxLjM2Lz48UFYx
LjM3Lz48UFYxLjM4Lz48UFYxLjM5Lz48UFYxLjQwLz48UFYxLjQxLz48UFYxLjQyLz48UFYxLjQz
Lz48UFYxLjQ0PjxQVjEuNDQuMT4yMDIwMDMyMTE4MTMwNTwvUFYxLjQ0LjE+PC9QVjEuNDQ+PFBW
MS40NT48UFYxLjQ1LjE+MjAyMDA0MDgxMDE1MDA8L1BWMS40NS4xPjwvUFYxLjQ1PjwvUFYxPjxT
UE0+PFNQTS4xPjxTUE0uMS4xPjE8L1NQTS4xLjE+PC9TUE0uMT48U1BNLjI+PFNQTS4yLjEvPjxT
UE0uMi4yPjxTUE0uMi4yLjE+MjAwMzI0MDQwNjAyPC9TUE0uMi4yLjE+PFNQTS4yLjIuMj5HTElN
UzwvU1BNLjIuMi4yPjwvU1BNLjIuMj48L1NQTS4yPjxTUE0uMy8+PFNQTS40PjxTUE0uNC4xPlZC
Q0FQPC9TUE0uNC4xPjxTUE0uNC4yPlZvbGJsb2VkIENhcGlsbGFpcjwvU1BNLjQuMj48U1BNLjQu
Mz5HTElNUzwvU1BNLjQuMz48L1NQTS40PjxTUE0uNS8+PFNQTS42Lz48U1BNLjcvPjxTUE0uOC8+
PFNQTS45Lz48U1BNLjEwLz48U1BNLjExLz48U1BNLjEyPjxTUE0uMTIuMT4wPC9TUE0uMTIuMT48
U1BNLjEyLjI+PFNQTS4xMi4yLjE+bWw8L1NQTS4xMi4yLjE+PFNQTS4xMi4yLjI+bWw8L1NQTS4x
Mi4yLjI+PFNQTS4xMi4yLjM+R0xJTVM8L1NQTS4xMi4yLjM+PC9TUE0uMTIuMj48L1NQTS4xMj48
U1BNLjEzLz48U1BNLjE0Lz48U1BNLjE1Lz48U1BNLjE2Lz48U1BNLjE3PjxTUE0uMTcuMT4yMDIw
MDMyNDEzNTMyNzwvU1BNLjE3LjE+PC9TUE0uMTc+PFNQTS4xOD48U1BNLjE4LjE+MjAyMDAzMjQx
MzUzMjc8L1NQTS4xOC4xPjwvU1BNLjE4PjxTUE0uMTkvPjxTUE0uMjA+PFNQTS4yMC4xPlk8L1NQ
TS4yMC4xPjwvU1BNLjIwPjwvU1BNPjxPUkM+PE9SQy4xPjxPUkMuMS4xPlNDPC9PUkMuMS4xPjwv
T1JDLjE+PE9SQy4yLz48T1JDLjM+PE9SQy4zLjE+RV8yMDAzMjQwMzI4PC9PUkMuMy4xPjxPUkMu
My4yPkdMSU1TPC9PUkMuMy4yPjwvT1JDLjM+PE9SQy40Lz48T1JDLjU+PE9SQy41LjE+Q008L09S
Qy41LjE+PC9PUkMuNT48T1JDLjYvPjxPUkMuNz48T1JDLjcuMS8+PE9SQy43LjIvPjxPUkMuNy4z
Lz48T1JDLjcuND4yMDIwMDMyNDEzNTMyNzwvT1JDLjcuND48T1JDLjcuNS8+PE9SQy43LjY+Ujwv
T1JDLjcuNj48L09SQy43PjxPUkMuOC8+PE9SQy45PjxPUkMuOS4xPjIwMjAwNTIwMDkxMzMxPC9P
UkMuOS4xPjwvT1JDLjk+PE9SQy4xMC8+PE9SQy4xMS8+PE9SQy4xMj48T1JDLjEyLjE+MTAwMDAw
MDc2MDwvT1JDLjEyLjE+PE9SQy4xMi4yPkJFTk5FUjwvT1JDLjEyLjI+PE9SQy4xMi4zPlBNLmlu
dGVuc2l2aXN0PC9PUkMuMTIuMz48T1JDLjEyLjQvPjxPUkMuMTIuNS8+PE9SQy4xMi42Lz48T1JD
LjEyLjcvPjxPUkMuMTIuOC8+PE9SQy4xMi45PlNaX0k8L09SQy4xMi45PjwvT1JDLjEyPjxPUkMu
MTM+PE9SQy4xMy4xPkhBWklDVTwvT1JDLjEzLjE+PE9SQy4xMy4yLz48T1JDLjEzLjMvPjxPUkMu
MTMuNC8+PE9SQy4xMy41Lz48T1JDLjEzLjYvPjxPUkMuMTMuNy8+PE9SQy4xMy44Lz48T1JDLjEz
LjkvPjxPUkMuMTMuMTAvPjxPUkMuMTMuMTE+R0xJTVM8L09SQy4xMy4xMT48L09SQy4xMz48T1JD
LjE0Lz48T1JDLjE1Lz48T1JDLjE2Lz48T1JDLjE3PjxPUkMuMTcuMT5LR0VHPC9PUkMuMTcuMT48
T1JDLjE3LjI+RGVjZW50cmFhbCBTcGFhcm5lZ2FzdGh1aXMgbG9jYXRpZSBIYWFybGVtIHp1aWQ8
L09SQy4xNy4yPjxPUkMuMTcuMz5HTElNUzwvT1JDLjE3LjM+PC9PUkMuMTc+PE9SQy4xOC8+PE9S
Qy4xOT48T1JDLjE5LjE+MTAwMDAwMTE3OTwvT1JDLjE5LjE+PE9SQy4xOS4yPlByb25rLUFkbWly
YWFsPC9PUkMuMTkuMj48T1JDLjE5LjM+Q0o8L09SQy4xOS4zPjxPUkMuMTkuNC8+PE9SQy4xOS41
Lz48T1JDLjE5LjYvPjxPUkMuMTkuNz5Eci48L09SQy4xOS43PjxPUkMuMTkuOC8+PE9SQy4xOS45
PlNaX0k8L09SQy4xOS45PjwvT1JDLjE5PjwvT1JDPjwvSEw3TWVzc2FnZT4iLA0KICAiYXBwcm92
ZWQiIDogdHJ1ZQ0KfQ==</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;msg_type&apos;)&quot; equals &apos;ORU&apos;</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;msg_type&apos;)</field>
                <condition>EQUALS</condition>
                <values>
                  <string>&apos;ORU&apos;</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;Empresa&apos;)&quot; contains &apos;FRESENIUS&apos;</name>
                <sequenceNumber>1</sequenceNumber>
                <enabled>true</enabled>
                <operator>AND</operator>
                <field>$(&apos;Empresa&apos;)</field>
                <condition>CONTAINS</condition>
                <values>
                  <string>&apos;FRESENIUS&apos;</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
        <connector version="3.9.1">
          <metaDataId>16</metaDataId>
          <name>GR2</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>03226d36-9fd4-49ce-a918-28b4fb9517b3</channelId>
            <channelTemplate>${JSONResponse2}</channelTemplate>
            <mapVariables>
              <string>Case</string>
              <string>PID</string>
              <string>PID2</string>
              <string>CDS1 Request</string>
              <string>CDS2 Sent</string>
              <string>CDS4 Response</string>
              <string>CDS2 Retrieve Historical Data</string>
            </mapVariables>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64">TVNIfF5+XCZ8Wm9yZ0RvbWVpbnx8R0xJTVN8QXRhbG1lZGlhbC1BTVNURUxWRUVOfDIwMjAwNDMw
MTMzMTAxKzAyMDB8fE9NTF5PMjFeT01MX08yMXxaRDY3NTU3ODIwfFB8Mi41fHx8fHxOTER8ODg1
OS8xClBJRHwxfHwxMjM0NTY3ODleXl5OTE1JTkJJWkFeTk5OTER8fER1Y2sgLSBHZWx1ayYmR2Vs
dWsmJkR1Y2teQV5eXl5eTHx8MTk0NDEwMjV8Rnx8fFdvcnRlbHN0cmFhdCBXLiA4NiZXb3J0ZWxz
dHJhYXQgVy4mODZeXkR1Y2tzdGFkXl41NTc3WFleTkxeSApQVjF8MXxPCklOMXwxfF5udWxsfDBe
Xl5eTE9DQUx8Wm9yZyBlbiBaZWtlcmhlaWQgWm9yZ3Zlcnpla2VyaW5nZW4qfHx8fHx8fHx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHwxMjM0ODg5MjAyCk9SQ3xOV3xaRDY3NTU3ODIwXzAxfHxaRDY3
NTU3ODIwfHx8Xl5eXl5SfHwyMDIwMDQzMDEzMjgxNCswMjAwfF4mJlBldGVyc2VuXlYufHwwMTEw
MjIzNF4mJk1hbmRqZXMgLSB2YW4gVWl0ZXJ0Xk1KR15eXl5eXlZFS1RJU3x8fHx8MzQwMDkyNzle
QXRhbG1lZGlhbCwgUmVnaW8gQW1zdGVsbGFuZF5MClRRMXwxfHx8fHx8fHxSCk9CUnwxfFpENjc1
NTc4MjBfMDF8fEZUNF5WcmlqIFQ0Xkx8fHx8fHx8T3x8fHx8MDExMDIyMzReJiZNYW5kamVzIC0g
dmFuIFVpdGVydF5NSkdeXl5eXl5WRUtUSVM=</inboundTemplate>
            <outboundTemplate encoding="base64">TVNIfF5+XCZ8Wm9yZ0RvbWVpbnx8R0xJTVN8QXRhbG1lZGlhbC1BTVNURUxWRUVOfDIwMjAwNDMw
MTMzMTAxKzAyMDB8fE9NTF5PMjFeT01MX08yMXxaRDY3NTU3ODIwfFB8Mi41fHx8fHxOTER8ODg1
OS8xClBJRHwxfHwxMjM0NTY3ODleXl5OTE1JTkJJWkFeTk5OTER8fER1Y2sgLSBHZWx1ayYmR2Vs
dWsmJkR1Y2teQV5eXl5eTHx8MTk0NDEwMjV8Rnx8fFdvcnRlbHN0cmFhdCBXLiA4NiZXb3J0ZWxz
dHJhYXQgVy4mODZeXkR1Y2tzdGFkXl41NTc3WFleTkxeSApQVjF8MXxPCklOMXwxfF5udWxsfDBe
Xl5eTE9DQUx8Wm9yZyBlbiBaZWtlcmhlaWQgWm9yZ3Zlcnpla2VyaW5nZW4qfHx8fHx8fHx8fHx8
fHx8fHx8fHx8fHx8fHx8fHx8fHwxMjM0ODg5MjAyCk9SQ3xOV3xaRDY3NTU3ODIwXzAxfHxaRDY3
NTU3ODIwfHx8Xl5eXl5SfHwyMDIwMDQzMDEzMjgxNCswMjAwfF4mJlBldGVyc2VuXlYufHwwMTEw
MjIzNF4mJk1hbmRqZXMgLSB2YW4gVWl0ZXJ0Xk1KR15eXl5eXlZFS1RJU3x8fHx8MzQwMDkyNzle
QXRhbG1lZGlhbCwgUmVnaW8gQW1zdGVsbGFuZF5MClRRMXwxfHx8fHx8fHxSCk9CUnwxfFpENjc1
NTc4MjBfMDF8fEZUNF5WcmlqIFQ0Xkx8fHx8fHx8T3x8fHx8MDExMDIyMzReJiZNYW5kamVzIC0g
dmFuIFVpdGVydF5NSkdeXl5eXl5WRUtUSVM=</outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.rulebuilder.RuleBuilderRule version="3.9.1">
                <name>Accept message if &quot;$(&apos;aux_flag&apos;)&quot; equals 1</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <field>$(&apos;aux_flag&apos;)</field>
                <condition>EQUALS</condition>
                <values>
                  <string>1</string>
                </values>
              </com.mirth.connect.plugins.rulebuilder.RuleBuilderRule>
            </elements>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>CASEID</name>
            <type>STRING</type>
            <mappingName>Case</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1704822451778</time>
            <timezone>America/Bogota</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>15</pruneMetaDataDays>
            <pruneContentDays>15</pruneContentDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>617e62e8-b63c-467d-adea-6de94dbb5481</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>SendEmails</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>None</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements/>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.smtp.SmtpDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <smtpHost>zimbra.angel.com.co</smtpHost>
            <smtpPort>465</smtpPort>
            <overrideLocalBinding>false</overrideLocalBinding>
            <localAddress>0.0.0.0</localAddress>
            <localPort>0</localPort>
            <timeout>5000</timeout>
            <encryption>SSL</encryption>
            <authentication>true</authentication>
            <username>AlinIQCDS@lab.synlab.co</username>
            <password>Albahaca.Tome.1049$</password>
            <to>${email}</to>
            <from>AlinIQCDS@lab.synlab.co</from>
            <cc></cc>
            <bcc></bcc>
            <replyTo></replyTo>
            <headers class="linked-hash-map"/>
            <headersVariable></headersVariable>
            <isUseHeadersVariable>false</isUseHeadersVariable>
            <subject>${subject}</subject>
            <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
            <html>false</html>
            <body>${body}</body>
            <attachments/>
            <attachmentsVariable></attachmentsVariable>
            <isUseAttachmentsVariable>false</isUseAttachmentsVariable>
          </properties>
          <transformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script>var email =msg[&apos;email&apos;];
while (email.indexOf(&quot; &quot;)&gt;= 0){
	email= email.replace(&quot; &quot;,&quot;&quot;);
}
connectorMap.put(&apos;email&apos;,email);

connectorMap.put(&apos;subject&apos;,msg[&apos;subject&apos;]);
connectorMap.put(&apos;body&apos;,msg[&apos;body&apos;]);</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">ewoiZW1haWwiOiIiLAoic3ViamVjdCI6IiIsCiJib2R5IjoiIgp9</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>SMTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns/>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1693409621268</time>
            <timezone>Europe/London</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>15</pruneMetaDataDays>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>ce00dd15-dccf-4660-963a-c7bc9d4a54d1</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>in_TCP_HL7_2551</name>
      <description></description>
      <revision>4</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.tcp.TcpReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <listenerConnectorProperties version="3.9.1">
            <host>0.0.0.0</host>
            <port>2551</port>
          </listenerConnectorProperties>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>Auto-generate (Before processing)</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>true</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <transmissionModeProperties class="com.mirth.connect.plugins.mllpmode.MLLPModeProperties">
            <pluginPointName>MLLP</pluginPointName>
            <startOfMessageBytes>0B</startOfMessageBytes>
            <endOfMessageBytes>1C0D</endOfMessageBytes>
            <useMLLPv2>false</useMLLPv2>
            <ackBytes>06</ackBytes>
            <nackBytes>15</nackBytes>
            <maxRetries>2</maxRetries>
          </transmissionModeProperties>
          <serverMode>true</serverMode>
          <remoteAddress></remoteAddress>
          <remotePort></remotePort>
          <overrideLocalBinding>false</overrideLocalBinding>
          <reconnectInterval>5000</reconnectInterval>
          <receiveTimeout>0</receiveTimeout>
          <bufferSize>65536</bufferSize>
          <maxConnections>10</maxConnections>
          <keepConnectionOpen>true</keepConnectionOpen>
          <dataTypeBinary>false</dataTypeBinary>
          <charsetEncoding>DEFAULT_ENCODING</charsetEncoding>
          <respondOnNewConnection>0</respondOnNewConnection>
          <responseAddress></responseAddress>
          <responsePort></responsePort>
        </properties>
        <transformer version="3.9.1">
          <elements/>
          <inboundDataType>HL7V2</inboundDataType>
          <outboundDataType>HL7V2</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
              <handleRepetitions>true</handleRepetitions>
              <handleSubcomponents>true</handleSubcomponents>
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <stripNamespaces>true</stripNamespaces>
              <segmentDelimiter>\r</segmentDelimiter>
              <convertLineBreaks>true</convertLineBreaks>
            </serializationProperties>
            <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
              <useStrictParser>false</useStrictParser>
              <useStrictValidation>false</useStrictValidation>
              <segmentDelimiter>\r</segmentDelimiter>
            </deserializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
              <splitType>MSH_Segment</splitType>
              <batchScript></batchScript>
            </batchProperties>
            <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
              <segmentDelimiter>\r</segmentDelimiter>
              <successfulACKCode>AA</successfulACKCode>
              <successfulACKMessage></successfulACKMessage>
              <errorACKCode>AE</errorACKCode>
              <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
              <rejectedACKCode>AR</rejectedACKCode>
              <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
              <msh15ACKAccept>false</msh15ACKAccept>
              <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
            </responseGenerationProperties>
            <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
              <successfulACKCode>AA,CA</successfulACKCode>
              <errorACKCode>AE,CE</errorACKCode>
              <rejectedACKCode>AR,CR</rejectedACKCode>
              <validateMessageControlId>true</validateMessageControlId>
              <originalMessageControlId>Destination_Encoded</originalMessageControlId>
              <originalIdMapVariable></originalIdMapVariable>
            </responseValidationProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>TCP Listener</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <channelId>6e86188e-4667-4403-a558-cdff9971eec6</channelId>
            <channelTemplate>${message.encodedData}</channelTemplate>
            <mapVariables/>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundDataType>HL7V2</inboundDataType>
            <outboundDataType>HL7V2</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.9.1">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.9.1">
                <handleRepetitions>true</handleRepetitions>
                <handleSubcomponents>true</handleSubcomponents>
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <stripNamespaces>true</stripNamespaces>
                <segmentDelimiter>\r</segmentDelimiter>
                <convertLineBreaks>true</convertLineBreaks>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.9.1">
                <useStrictParser>false</useStrictParser>
                <useStrictValidation>false</useStrictValidation>
                <segmentDelimiter>\r</segmentDelimiter>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.9.1">
                <splitType>MSH_Segment</splitType>
                <batchScript></batchScript>
              </batchProperties>
              <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.9.1">
                <segmentDelimiter>\r</segmentDelimiter>
                <successfulACKCode>AA</successfulACKCode>
                <successfulACKMessage></successfulACKMessage>
                <errorACKCode>AE</errorACKCode>
                <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
                <rejectedACKCode>AR</rejectedACKCode>
                <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
                <msh15ACKAccept>false</msh15ACKAccept>
                <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
              </responseGenerationProperties>
              <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.9.1">
                <successfulACKCode>AA,CA</successfulACKCode>
                <errorACKCode>AE,CE</errorACKCode>
                <rejectedACKCode>AR,CR</rejectedACKCode>
                <validateMessageControlId>true</validateMessageControlId>
                <originalMessageControlId>Destination_Encoded</originalMessageControlId>
                <originalIdMapVariable></originalIdMapVariable>
              </responseValidationProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>Channel Writer</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1692038184899</time>
            <timezone>America/Bogota</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>15</pruneMetaDataDays>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>b5993ac1-6c39-4fca-a0c2-fdd8c276e1db</id>
      <nextMetaDataId>9</nextMetaDataId>
      <name>Send to Criticos</name>
      <description></description>
      <revision>20</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>d8</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>10</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements>
            <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
              <sequenceNumber>0</sequenceNumber>
              <enabled>true</enabled>
              <script>/*
var patientid =  msg[&apos;senderReference&apos;].toString().substring(msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;MSH.5.1&gt;&quot;)+9,msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;/MSH.5.1&gt;&quot;))
var datatime = msg[&apos;senderReference&apos;].toString().substring(msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;MSH.7.1&gt;&quot;)+9,msg[&apos;senderReference&apos;].toString().indexOf(&quot;&lt;/MSH.7.1&gt;&quot;))

channelMap.put(&apos;CASEID&apos;,msg[&apos;caseId&apos;].toString());
channelMap.put(&apos;ORDERID&apos;,msg[&apos;episodes&apos;][0][&apos;episodeId&apos;].toString());
channelMap.put(&apos;PATIENTID&apos;,patientid);
channelMap.put(&apos;DATATIME&apos;,datatime);


var insert = &quot;INSERT INTO statistics.incomming (CASEID,PATIENTID,ORDERID,DATATIME) &quot;;
insert += &quot;VALUES(&apos;&quot;+msg[&apos;caseId&apos;].toString()+&quot;&apos;,&apos;&quot;+patientid+&quot;&apos;,&apos;&quot;+msg[&apos;episodes&apos;][0][&apos;episodeId&apos;].toString()+&quot;&apos;,STR_TO_DATE(&apos;&quot;+datatime+&quot;&apos;,&apos;%Y%m%d%H%i%s&apos;))&quot;;
channelMap.put(&apos;insert&apos;,insert);

dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.mysql.jdbc.Driver&apos;, &apos;jdbc:mysql://localhost:3306/rd_staging&apos;, &apos;root&apos;, &apos;1Password&apos;);
result2 = dbConn.executeUpdate(insert);
*/
var datestring = DateUtil.convertDate(&apos;yyyy-MM-dd HH:mm:ss&apos;, &apos;MMddHHmmss&apos;, msg[&apos;episodes&apos;][0][&apos;attributeWithValues&apos;][2][&apos;value&apos;]);
msg[&apos;caseId&apos;] = msg[&apos;caseId&apos;] + datestring;</script>
            </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
          </elements>
          <inboundTemplate encoding="base64">ew0KICAiY2FzZUlkIiA6ICIzMTI3OTkwOV80MjAwNjU5NDgiLA0KICAic2l0ZSIgOiAiIiwNCiAg
ImVwaXNvZGVzIiA6IFsNCiAgICB7DQogICAgICAiZXBpc29kZURhdGUiIDogMTcwMDA2NjY5NDAw
MCwNCiAgICAgICJlcGlzb2RlSWQiIDogIjQyMDA2NTk0OCIsDQogICAgICAiYXR0cmlidXRlV2l0
aFZhbHVlcyIgOiBbDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJTYW1w
bGVJRCIsDQogICAgICAgICAgInZhbHVlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAg
ICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJQcmV2aW91c0ludGVycCIsDQogICAgICAgICAgInZh
bHVlIiA6ICIgW10iDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxO
YW1lIiA6ICJGZWNoYU1lbnNhamVITDciLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMjAyMy0xMS0x
NSAxNjozMzowMCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIkZlY2hhUmVnaXN0cm9PcmRlbiIsDQogICAgICAgICAgInZhbHVlIiA6ICIyMDIzLTEx
LTE1IDExOjQ0OjU0Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFs
TmFtZSIgOiAiUElEIiwNCiAgICAgICAgICAidmFsdWUiIDogIjMxMjc5OTA5Ig0KICAgICAgICB9
LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiUElEMiIsDQogICAgICAg
ICAgInZhbHVlIiA6ICIzMTI3OTkwOSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAg
ICJleHRlcm5hbE5hbWUiIDogIlBJRDMiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNDIwMDY1OTQ4
Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiTm9t
YnJlIFBhY2llbnRlIiwNCiAgICAgICAgICAidmFsdWUiIDogIk1BWk8gUkFNSVJFWiwgT01BSVJB
Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiTm9t
YnJlIFBhY2llbnRlIENEUyIsDQogICAgICAgICAgInZhbHVlIiA6ICIyMC1BVlAtNzg2LTMwNyIN
CiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIlRpcG8g
RXBpc29kaW8iLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiIg0KICAgICAgICB9LA0KICAgICAgICB7
DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiTWVkaWNvUGV0aWNpb25hcmlvSUQiLA0KICAg
ICAgICAgICJ2YWx1ZSIgOiAiODMwMDA3MzU1Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAg
ICAgICAgImV4dGVybmFsTmFtZSIgOiAiTWVkaWNvUGV0aWNpb25hcmlvTm9tYnJlIiwNCiAgICAg
ICAgICAidmFsdWUiIDogIkZSRVNFTklVUyBNRURJQ0FMIENBUkUgQ09MT01CSUEgUy5BLiINCiAg
ICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIlNlZGVTeW5s
YWJQcmVzZW50YWNpb24iLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNDIwIg0KICAgICAgICB9LA0K
ICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiQ29kaWdvUGxhbkNsaWVudGUi
LA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNDk0NSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAg
ICAgICAgICJleHRlcm5hbE5hbWUiIDogIkRlc2NyaXBjaW9uUGxhbkNsaWVudGUiLA0KICAgICAg
ICAgICJ2YWx1ZSIgOiAiRlJFU0VOSVVTIENNSSBJTkdSRVNPUyBIRCINCiAgICAgICAgfSwNCiAg
ICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIk5JVCIsDQogICAgICAgICAgInZh
bHVlIiA6ICI4MzAwMDczNTUiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0
ZXJuYWxOYW1lIiA6ICJSYXpvblNvY2lhbCIsDQogICAgICAgICAgInZhbHVlIiA6ICJGUkVTRU5J
VVMgTUVESUNBTCBDQVJFIENPTE9NQklBIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAg
ICAgImV4dGVybmFsTmFtZSIgOiAiQklSVEhEQVRFIiwNCiAgICAgICAgICAidmFsdWUiIDogIjE5
NTQtMDctMDciDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1l
IiA6ICJFZGFkUGFjaWVudGUiLA0KICAgICAgICAgICJ2YWx1ZSIgOiA2OQ0KICAgICAgICB9LA0K
ICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiRWRhZCBlbiBEw61hcyIsDQog
ICAgICAgICAgInZhbHVlIiA6IDI1MzMzDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAg
ICAiZXh0ZXJuYWxOYW1lIiA6ICJQYXRpZW50U2V4IiwNCiAgICAgICAgICAidmFsdWUiIDogIkYi
DQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJTYW1w
bGUiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAg
ICAgICAgImV4dGVybmFsTmFtZSIgOiAiRmVjaGFEZVRvbWEiLA0KICAgICAgICAgICJ2YWx1ZSIg
OiAiMjAyMy0xMS0xNSAxMTo0NTo0NCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAg
ICJleHRlcm5hbE5hbWUiIDogIkZlY2hhUmVjZXBjaW9uTXVlc3RyYSIsDQogICAgICAgICAgInZh
bHVlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1l
IiA6ICJDb2RpZ29FeGFtZW4iLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiOTAzNjAzLDkwMzgxOCw5
MDM4MzMsOTAzODE1LDkwMzgxNyw5MDM4NTksOTAzODYzLDkwMzg2Niw5MDM4NjcsOTAzODY0LDkw
MzA0Niw5MDM4NjgsOTAyMjEwLDkwMjIxMiw5MDIwNDksOTAyMDQ1LDkwMzgwMyw5MDM4MDksOTAz
ODQ2Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAi
Tm9tYnJlRXhhbWVuIiwNCiAgICAgICAgICAidmFsdWUiIDogIkNhbGNpbyxDb2xlc3Rlcm9sIFRv
dGFsLEZvc2ZhdGFzYSBBbGNhbGluYSBUb3RhbCxDb2xlc3Rlcm9sIGRlIEFsdGEgRGVuc2lkYWQg
KEhETCksQ29sZXN0ZXJvbCBkZSBCYWphIERlbnNpZGFkIExETCAoRW56aW3DoXRpY28pLFBvdGFz
aW8sUHJvdGXDrW5hcyBUb3RhbGVzLEFsYW5pbmEgQW1pbm90cmFuc2ZlcmFzYSAoQUxULUdQVCks
QXNwYXJ0YXRvIEFtaW5vdHJhbnNmZXJhc2EgKEFTVC1HT1QpLFNvZGlvLFRyYW5zZmVycmluYSxU
cmlnbGljw6lyaWRvcyxIZW1vZ3JhbWEgVGlwbyBJVixIZW1vY2xhc2lmaWNhY2nDs24gU2lzdGVt
YSBBQk8geSBSaCBEaXJlY3RhIGVuIFBsYWNhLFRpZW1wbyBQYXJjaWFsIGRlIFRyb21ib3BsYXN0
aW5hIChQVFQpLFRpZW1wbyBkZSBQcm90cm9tYmluYSAoUFQpLEFsYnVtaW5hIFJlbmFsLEJpbGly
cnViaW5hcyBEaWZlcmVuY2lhZGFzIChUb3RhbCB5IERpcmVjdGEpLEhpZXJybyBTw6lyaWNvIg0K
ICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiQ2FsY2lv
IiwNCiAgICAgICAgICAidmFsdWUiIDogIjkuNDMiLA0KICAgICAgICAgICJ1bml0cyIgOiAibWcv
ZGwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiOC40IC0gMTAuMiINCiAgICAgICAgfSwNCiAgICAg
ICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgQ2FsY2lvIiwN
CiAgICAgICAgICAidmFsdWUiIDogIkNvbG9yaW3DqXRyaWNhIF9UZWNuaWNhICINCiAgICAgICAg
fSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbGVzdGVyb2wgVG90
YWwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMTQ1IiwNCiAgICAgICAgICAidW5pdHMiIDogIm1n
L2RsIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAg
ICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgQ29sZXN0ZXJvbCBUb3RhbCIs
DQogICAgICAgICAgInZhbHVlIiA6ICJFbnppbcOhdGljYSBfVGVjbmljYSAiDQogICAgICAgIH0s
DQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJGb3NmYXRhc2EgQWxjYWxp
bmEgVG90YWwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNzEiLA0KICAgICAgICAgICJ1bml0cyIg
OiAiVS9MIiwNCiAgICAgICAgICAicmFuZ2UiIDogIjQ2IC0gMTIyIg0KICAgICAgICB9LA0KICAg
ICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiQ29tZW50YXJpbyBkZSBGb3NmYXRh
c2EgQWxjYWxpbmEgVG90YWwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiRW56aW3DoXRpY2EgX1Rl
Y25pY2EgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIg
OiAiQ29sZXN0ZXJvbCBIREwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNDkiLA0KICAgICAgICAg
ICJ1bml0cyIgOiAibWcvZEwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiNDAgLSA2MCINCiAgICAg
ICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8g
ZGUgQ29sZXN0ZXJvbCBIREwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiRW56aW3DoXRpY2EgX1Rl
Y25pY2EgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIg
OiAiQ29sZXN0ZXJvbCBMREwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNzIiLA0KICAgICAgICAg
ICJ1bml0cyIgOiAibWcvZEwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIg0KICAgICAgICB9LA0K
ICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiQ29tZW50YXJpbyBkZSBDb2xl
c3Rlcm9sIExETCIsDQogICAgICAgICAgInZhbHVlIiA6ICJFbnppbcOhdGljYSBfVGVjbmljYSAi
DQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJQb3Rh
c2lvIiwNCiAgICAgICAgICAidmFsdWUiIDogIjQuMzciLA0KICAgICAgICAgICJ1bml0cyIgOiAi
bW1vbC9MICIsDQogICAgICAgICAgInJhbmdlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsN
CiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJDb21lbnRhcmlvIGRlIFBvdGFzaW8iLA0KICAg
ICAgICAgICJ2YWx1ZSIgOiAiScOzbiBTZWxlY3Rpdm8gX1RlY25pY2EgIg0KICAgICAgICB9LA0K
ICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiUHJvdGVpbmFzIFRvdGFsZXMg
IiwNCiAgICAgICAgICAidmFsdWUiIDogIjcuMTkiLA0KICAgICAgICAgICJ1bml0cyIgOiAiZy9k
TCIsDQogICAgICAgICAgInJhbmdlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAg
ICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJDb21lbnRhcmlvIGRlIFByb3RlaW5hcyBUb3RhbGVzICIs
DQogICAgICAgICAgInZhbHVlIiA6ICJFc3BlY3Ryb2ZvdG9tw6l0cmljYSBfVGVjbmljYSAiDQog
ICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJBbGFuaW5h
IEFtaW5vdHJhbnNmZXJhc2EgKEFMVC1TR1BUKSIsDQogICAgICAgICAgInZhbHVlIiA6ICIxOCIs
DQogICAgICAgICAgInVuaXRzIiA6ICJVL0wiLA0KICAgICAgICAgICJyYW5nZSIgOiAiMCAtIDM0
Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiQ29t
ZW50YXJpbyBkZSBBbGFuaW5hIEFtaW5vdHJhbnNmZXJhc2EgKEFMVC1TR1BUKSIsDQogICAgICAg
ICAgInZhbHVlIiA6ICJFbnppbcOhdGljYSBfVGVjbmljYSAiDQogICAgICAgIH0sDQogICAgICAg
IHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJBc3BhcnRhdG8gQW1pbm90cmFuc2ZlcmFz
YSAoQVNULVNHT1QpIiwNCiAgICAgICAgICAidmFsdWUiIDogIjI0IiwNCiAgICAgICAgICAidW5p
dHMiIDogIlUvTCIsDQogICAgICAgICAgInJhbmdlIiA6ICIxMSAtIDM0Ig0KICAgICAgICB9LA0K
ICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiQ29tZW50YXJpbyBkZSBBc3Bh
cnRhdG8gQW1pbm90cmFuc2ZlcmFzYSAoQVNULVNHT1QpIiwNCiAgICAgICAgICAidmFsdWUiIDog
IkVzcGVjdHJvZm90b21ldHLDrWEgY2luw6l0aWNhIF9UZWNuaWNhICINCiAgICAgICAgfSwNCiAg
ICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIlNvZGlvIiwNCiAgICAgICAgICAi
dmFsdWUiIDogIjE0MS4wNSIsDQogICAgICAgICAgInVuaXRzIiA6ICJtbW9sL0wiLA0KICAgICAg
ICAgICJyYW5nZSIgOiAiIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVy
bmFsTmFtZSIgOiAiQ29tZW50YXJpbyBkZSBTb2RpbyIsDQogICAgICAgICAgInZhbHVlIiA6ICJJ
w7NuIFNlbGVjdGl2byAgX1RlY25pY2EgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAg
ICAgImV4dGVybmFsTmFtZSIgOiAiVHJhbnNmZXJyaW5hIiwNCiAgICAgICAgICAidmFsdWUiIDog
IjE5NCIsDQogICAgICAgICAgInVuaXRzIiA6ICJtZy9kTCIsDQogICAgICAgICAgInJhbmdlIiA6
ICIxNzMgLSAzNjAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxO
YW1lIiA6ICJDb21lbnRhcmlvIGRlIFRyYW5zZmVycmluYSIsDQogICAgICAgICAgInZhbHVlIiA6
ICJJbm11bm90dXJiaWRpbcOpdHJpY2EgX1RlY25pY2EgIg0KICAgICAgICB9LA0KICAgICAgICB7
DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiVHJpZ2xpY8Opcmlkb3MiLA0KICAgICAgICAg
ICJ2YWx1ZSIgOiAiMTM1IiwNCiAgICAgICAgICAidW5pdHMiIDogIm1nL2RsICIsDQogICAgICAg
ICAgInJhbmdlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJu
YWxOYW1lIiA6ICJDb21lbnRhcmlvIGRlIFRyaWdsaWPDqXJpZG9zIiwNCiAgICAgICAgICAidmFs
dWUiIDogIkNvbG9yaW3DqXRyaWNhIF9UZWNuaWNhICINCiAgICAgICAgfSwNCiAgICAgICAgew0K
ICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgVHJpZ2xpY8Opcmlkb3Mi
LA0KICAgICAgICAgICJ2YWx1ZSIgOiAiSEVNT0dSQU1BIEFVVE9NQVRJWkFETyBJViBfICINCiAg
ICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkxldWNvY2l0
b3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMTAuMTYiLA0KICAgICAgICAgICJ1bml0cyIgOiAi
eDEwIiwNCiAgICAgICAgICAicmFuZ2UiIDogIjQuNTAgLSAxMS4wMCINCiAgICAgICAgfSwNCiAg
ICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIk5ldXRyw7NmaWxvcyIsDQogICAg
ICAgICAgInZhbHVlIiA6ICI3MC4zIiwNCiAgICAgICAgICAidW5pdHMiIDogIiUiLA0KICAgICAg
ICAgICJyYW5nZSIgOiAiNDIuNSAtIDczLjIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAg
ICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJMaW5mb2NpdG9zIiwNCiAgICAgICAgICAidmFsdWUiIDog
IjE2LjQiLA0KICAgICAgICAgICJ1bml0cyIgOiAiJSIsDQogICAgICAgICAgInJhbmdlIiA6ICIx
OC4yIC0gNDcuNCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIkdyYW51bG9jaXRvcyBJbm1hZHVyb3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMS4w
IiwNCiAgICAgICAgICAidW5pdHMiIDogIiUiLA0KICAgICAgICAgICJyYW5nZSIgOiAiMC4wICAw
LjYiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJN
b25vY2l0b3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiOS4xIiwNCiAgICAgICAgICAidW5pdHMi
IDogIiUiLA0KICAgICAgICAgICJyYW5nZSIgOiAiNC4zIC0gMTEuMCINCiAgICAgICAgfSwNCiAg
ICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkVvc2luw7NmaWxvcyIsDQogICAg
ICAgICAgInZhbHVlIiA6ICIyLjYiLA0KICAgICAgICAgICJ1bml0cyIgOiAiJSIsDQogICAgICAg
ICAgInJhbmdlIiA6ICIwLjAgLSAzLjAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAg
ICAiZXh0ZXJuYWxOYW1lIiA6ICJCYXPDs2ZpbG9zIiwNCiAgICAgICAgICAidmFsdWUiIDogIjAu
NiIsDQogICAgICAgICAgInVuaXRzIiA6ICIlIiwNCiAgICAgICAgICAicmFuZ2UiIDogIjAuMCAg
MC43Ig0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAi
TmV1dHLDs2ZpbG9zIiwNCiAgICAgICAgICAidmFsdWUiIDogIjcuMTQiLA0KICAgICAgICAgICJ1
bml0cyIgOiAieDEwIiwNCiAgICAgICAgICAicmFuZ2UiIDogIjIuMDAgLSA3LjE1Ig0KICAgICAg
ICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiTGluZm9jaXRvcyIs
DQogICAgICAgICAgInZhbHVlIiA6ICIxLjY3IiwNCiAgICAgICAgICAidW5pdHMiIDogIngxMCIs
DQogICAgICAgICAgInJhbmdlIiA6ICIxLjE2IC0gMy4xOCINCiAgICAgICAgfSwNCiAgICAgICAg
ew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIk1vbm9jaXRvcyIsDQogICAgICAgICAgInZh
bHVlIiA6ICIwLjkyIiwNCiAgICAgICAgICAidW5pdHMiIDogIngxMCIsDQogICAgICAgICAgInJh
bmdlIiA6ICIwLjI5IC0gMC43MSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJl
eHRlcm5hbE5hbWUiIDogIkdyYW51bG9jaXRvcyBJbm1hZHVyb3MiLA0KICAgICAgICAgICJ2YWx1
ZSIgOiAiMC4xMCIsDQogICAgICAgICAgInVuaXRzIiA6ICJ4MTAiLA0KICAgICAgICAgICJyYW5n
ZSIgOiAiMC4wMCAtIDAuMDkiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0
ZXJuYWxOYW1lIiA6ICJFb3NpbsOzZmlsb3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMC4yNiIs
DQogICAgICAgICAgInVuaXRzIiA6ICJ4MTAiLA0KICAgICAgICAgICJyYW5nZSIgOiAiMC4wMyAt
IDAuMjciDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6
ICJCYXPDs2ZpbG9zIiwNCiAgICAgICAgICAidmFsdWUiIDogIjAuMDYiLA0KICAgICAgICAgICJ1
bml0cyIgOiAieDEwIiwNCiAgICAgICAgICAicmFuZ2UiIDogIjAuMDEgLSAwLjA1Ig0KICAgICAg
ICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiRXJpdHJvY2l0b3Mi
LA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMy40MiIsDQogICAgICAgICAgInVuaXRzIiA6ICJ4MTAi
LA0KICAgICAgICAgICJyYW5nZSIgOiAiNC4yMCAtIDUuNDAiDQogICAgICAgIH0sDQogICAgICAg
IHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJBbmNobyBkZSBEaXN0cmlidWNpw7NuIEVy
aXRyb2lkZSIsDQogICAgICAgICAgInZhbHVlIiA6ICIxNS42IiwNCiAgICAgICAgICAidW5pdHMi
IDogIiUiLA0KICAgICAgICAgICJyYW5nZSIgOiAiMTIuNCAtIDE1LjEiDQogICAgICAgIH0sDQog
ICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJQVkMgKFByb21lZGlvIFZvbHVt
ZW4gQ29wdXNjdWxhcikiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiOTYuNSIsDQogICAgICAgICAg
InVuaXRzIiA6ICJmTCIsDQogICAgICAgICAgInJhbmdlIiA6ICI4Ni4wIC0gOTYuMCINCiAgICAg
ICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIlBDSEMgKFByb21l
ZGlvIENvbmNlbnRyYWNpw7NuIEhlbW9nbG9iaW5hIiwNCiAgICAgICAgICAidmFsdWUiIDogIjMz
LjMiLA0KICAgICAgICAgICJ1bml0cyIgOiAiZy9kTCIsDQogICAgICAgICAgInJhbmdlIiA6ICIz
Mi4wIC0gMzguMCINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIlBIQyAoUHJvbWVkaW8gSGVtb2dsb2JpbmEgQ29ycHVzY3VsYXIpIiwNCiAgICAgICAg
ICAidmFsdWUiIDogIjMyLjIiLA0KICAgICAgICAgICJ1bml0cyIgOiAicGciLA0KICAgICAgICAg
ICJyYW5nZSIgOiAiMjUuMCAtIDMxLjAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAg
ICAiZXh0ZXJuYWxOYW1lIiA6ICJIZW1vZ2xvYmluYSIsDQogICAgICAgICAgInZhbHVlIiA6ICIx
MS4wIiwNCiAgICAgICAgICAidW5pdHMiIDogImcvZEwiLA0KICAgICAgICAgICJyYW5nZSIgOiAi
MTIuMCAtIDE2LjAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxO
YW1lIiA6ICJIZW1hdG9jcml0byIsDQogICAgICAgICAgInZhbHVlIiA6ICIzMy4wIiwNCiAgICAg
ICAgICAidW5pdHMiIDogIiUiLA0KICAgICAgICAgICJyYW5nZSIgOiAiMzguMCAtIDQ4LjAiDQog
ICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJSZWN1ZW50
byBkZSBwbGFxdWV0YXMiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMTU1IiwNCiAgICAgICAgICAi
dW5pdHMiIDogIngxMCIsDQogICAgICAgICAgInJhbmdlIiA6ICIxODYgLSAzNTMiDQogICAgICAg
IH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJWb2x1bWVuIFBsYXF1
ZXRhcmlvIE1lZGlvIiwNCiAgICAgICAgICAidmFsdWUiIDogIjEyLjMiLA0KICAgICAgICAgICJ1
bml0cyIgOiAiZkwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiOS42IC0gMTIuMCINCiAgICAgICAg
fSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUg
Vm9sdW1lbiBQbGFxdWV0YXJpbyBNZWRpbyIsDQogICAgICAgICAgInZhbHVlIiA6ICJDaXRvbWV0
csOtYSBkZSBmbHVqbyBlIGltcGVkYW5jaW9tZXRyw61hIF9UZWNuaWNhICINCiAgICAgICAgfSwN
CiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgVm9s
dW1lbiBQbGFxdWV0YXJpbyBNZWRpbyIsDQogICAgICAgICAgInZhbHVlIiA6ICJIRU1PQ0xBU0lG
SUNBQ0lPTiBfICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIkdydXBvIFNhbmd1aW5lbyIsDQogICAgICAgICAgInZhbHVlIiA6ICJPIiwNCiAgICAg
ICAgICAidW5pdHMiIDogIiIsDQogICAgICAgICAgInJhbmdlIiA6ICIiDQogICAgICAgIH0sDQog
ICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJGYWN0b3IgUkgiLA0KICAgICAg
ICAgICJ2YWx1ZSIgOiAiUE9TSVRJVk8iLA0KICAgICAgICAgICJ1bml0cyIgOiAiIiwNCiAgICAg
ICAgICAicmFuZ2UiIDogIiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRl
cm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgRmFjdG9yIFJIIiwNCiAgICAgICAgICAidmFsdWUi
IDogIlRlY25vbG9nw61hIGRlIEFnbHV0aW5hY2nDs24gZW4gQ29sdW1uYSBfVGVjbmljYSAiDQog
ICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJBbGLDum1p
bmEiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNC4zMiIsDQogICAgICAgICAgInVuaXRzIiA6ICJn
L2RMIiwNCiAgICAgICAgICAicmFuZ2UiIDogIjMuMiAtIDQuNiINCiAgICAgICAgfSwNCiAgICAg
ICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgQWxiw7ptaW5h
IiwNCiAgICAgICAgICAidmFsdWUiIDogIkNvbG9yaW3DqXRyaWNhIF9UZWNuaWNhICINCiAgICAg
ICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkJpbGlycnViaW5h
IERpcmVjdGEiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMC4yOCIsDQogICAgICAgICAgInVuaXRz
IiA6ICJtZy9kTCIsDQogICAgICAgICAgInJhbmdlIiA6ICIwLjAgLSAwLjUiDQogICAgICAgIH0s
DQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJDb21lbnRhcmlvIGRlIEJp
bGlycnViaW5hIERpcmVjdGEiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiQmlsaXJydWJpbmFzIERp
ZmVyZW5jaWFkYXMgKFRvdGFsIHkgRGlyZWN0YSkgXyAiDQogICAgICAgIH0sDQogICAgICAgIHsN
CiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJCaWxpcnJ1YmluYSBJbmRpcmVjdGEiLA0KICAg
ICAgICAgICJ2YWx1ZSIgOiAiMC42NSIsDQogICAgICAgICAgInVuaXRzIiA6ICJtZy9kTCIsDQog
ICAgICAgICAgInJhbmdlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAi
ZXh0ZXJuYWxOYW1lIiA6ICJCaWxpcnJ1YmluYSBUb3RhbCIsDQogICAgICAgICAgInZhbHVlIiA6
ICIwLjkzIiwNCiAgICAgICAgICAidW5pdHMiIDogIm1nL2RMIiwNCiAgICAgICAgICAicmFuZ2Ui
IDogIjAuMyAtIDEuMiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5h
bE5hbWUiIDogIkNvbWVudGFyaW8gZGUgQmlsaXJydWJpbmEgVG90YWwiLA0KICAgICAgICAgICJ2
YWx1ZSIgOiAiRXNwZWN0cm9mb3RvbcOpdHJpY2EgX1RlY25pY2EgIg0KICAgICAgICB9LA0KICAg
ICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiSGllcnJvIFPDqXJpY28gVG90YWwi
LA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNTIuMCIsDQogICAgICAgICAgInVuaXRzIiA6ICJ1Zy9k
TCIsDQogICAgICAgICAgInJhbmdlIiA6ICI1MCAtIDE3MCINCiAgICAgICAgfSwNCiAgICAgICAg
ew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbWVudGFyaW8gZGUgSGllcnJvIFPDqXJp
Y28gVG90YWwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiRXNwZWN0cm9mb3RvbcOpdHJpYSBDaW7D
qXRpY2EgX1RlY25pY2EgIg0KICAgICAgICB9DQogICAgICBdDQogICAgfSwNCiAgICB7DQogICAg
ICAiZXBpc29kZURhdGUiIDogMTcwMDA2NjY5NDAwMCwNCiAgICAgICJlcGlzb2RlSWQiIDogIjQy
MDA2NTk0OCIsDQogICAgICAiYXR0cmlidXRlV2l0aFZhbHVlcyIgOiBbDQogICAgICAgIHsNCiAg
ICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJTYW1wbGVJRCIsDQogICAgICAgICAgInZhbHVlIiA6
ICI0MjAwNjU5NDgiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxO
YW1lIiA6ICJBbGFuaW5hIEFtaW5vdHJhbnNmZXJhc2EgKEFMVC1TR1BUKSIsDQogICAgICAgICAg
InZhbHVlIiA6ICIxOCIsDQogICAgICAgICAgInVuaXRzIiA6ICJVL0wiLA0KICAgICAgICAgICJy
YW5nZSIgOiAiIDAgLSAzNCAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0
ZXJuYWxOYW1lIiA6ICJBbGLDum1pbmEiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNC4zMiIsDQog
ICAgICAgICAgInVuaXRzIiA6ICJnL2RMIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiAzLjIgLSA0
LjYgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAi
QXNwYXJ0YXRvIEFtaW5vdHJhbnNmZXJhc2EgKEFTVC1TR09UKSIsDQogICAgICAgICAgInZhbHVl
IiA6ICIyNCIsDQogICAgICAgICAgInVuaXRzIiA6ICJVL0wiLA0KICAgICAgICAgICJyYW5nZSIg
OiAiIDExIC0gMzQgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFs
TmFtZSIgOiAiQmlsaXJydWJpbmEgVG90YWwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMC45MyIs
DQogICAgICAgICAgInVuaXRzIiA6ICJtZy9kTCIsDQogICAgICAgICAgInJhbmdlIiA6ICIgMC4z
IC0gMS4yICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUi
IDogIkJpbGlycnViaW5hIERpcmVjdGEiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMC4yOCIsDQog
ICAgICAgICAgInVuaXRzIiA6ICJtZy9kTCIsDQogICAgICAgICAgInJhbmdlIiA6ICIgMC4wIC0g
MC41ICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDog
IkJpbGlycnViaW5hIEluZGlyZWN0YSIsDQogICAgICAgICAgInZhbHVlIiA6ICIwLjY1IiwNCiAg
ICAgICAgICAidW5pdHMiIDogIm1nL2RMIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiINCiAgICAg
ICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNhbGNpbyIsDQog
ICAgICAgICAgInZhbHVlIiA6ICI5LjQzIiwNCiAgICAgICAgICAidW5pdHMiIDogIm1nL2RsIiwN
CiAgICAgICAgICAicmFuZ2UiIDogIiA4LjQgLSAxMC4yICINCiAgICAgICAgfSwNCiAgICAgICAg
ew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNvbGVzdGVyb2wgSERMIiwNCiAgICAgICAg
ICAidmFsdWUiIDogIjQ5IiwNCiAgICAgICAgICAidW5pdHMiIDogIm1nL2RMIiwNCiAgICAgICAg
ICAicmFuZ2UiIDogIiA0MCAtIDYwICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAg
ICJleHRlcm5hbE5hbWUiIDogIkNvbGVzdGVyb2wgTERMIiwNCiAgICAgICAgICAidmFsdWUiIDog
IjcyIiwNCiAgICAgICAgICAidW5pdHMiIDogIm1nL2RMIiwNCiAgICAgICAgICAicmFuZ2UiIDog
IiINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkNv
bGVzdGVyb2wgVG90YWwiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMTQ1IiwNCiAgICAgICAgICAi
dW5pdHMiIDogIm1nL2RsIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiINCiAgICAgICAgfSwNCiAg
ICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkZvc2ZhdGFzYSBBbGNhbGluYSBU
b3RhbCIsDQogICAgICAgICAgInZhbHVlIiA6ICI3MSIsDQogICAgICAgICAgInVuaXRzIiA6ICJV
L0wiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDQ2IC0gMTIyICINCiAgICAgICAgfSwNCiAgICAg
ICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkdydXBvIFNhbmd1aW5lbyIsDQogICAg
ICAgICAgInZhbHVlIiA6ICJPIiwNCiAgICAgICAgICAidW5pdHMiIDogIiIsDQogICAgICAgICAg
InJhbmdlIiA6ICIiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxO
YW1lIiA6ICJGYWN0b3IgUkgiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiUE9TSVRJVk8iLA0KICAg
ICAgICAgICJ1bml0cyIgOiAiIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiINCiAgICAgICAgfSwN
CiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIkxldWNvY2l0b3MiLA0KICAg
ICAgICAgICJ2YWx1ZSIgOiAiMTAuMTYiLA0KICAgICAgICAgICJ1bml0cyIgOiAieDEwXjMgL3VM
IiwNCiAgICAgICAgICAicmFuZ2UiIDogIiA0LjUwIC0gMTEuMDAgIg0KICAgICAgICB9LA0KICAg
ICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiTmV1dHLDs2ZpbG9zIiwNCiAgICAg
ICAgICAidmFsdWUiIDogIjcwLjMiLA0KICAgICAgICAgICJ1bml0cyIgOiAiJSIsDQogICAgICAg
ICAgInJhbmdlIiA6ICIgNDIuNSAtIDczLjIgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAg
ICAgICAgImV4dGVybmFsTmFtZSIgOiAiTGluZm9jaXRvcyIsDQogICAgICAgICAgInZhbHVlIiA6
ICIxNi40IiwNCiAgICAgICAgICAidW5pdHMiIDogIiUiLA0KICAgICAgICAgICJyYW5nZSIgOiAi
IDE4LjIgLSA0Ny40ICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5h
bE5hbWUiIDogIkdyYW51bG9jaXRvcyBJbm1hZHVyb3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAi
MS4wIiwNCiAgICAgICAgICAidW5pdHMiIDogIiUiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDAu
MCAgMC42ICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUi
IDogIk1vbm9jaXRvcyIsDQogICAgICAgICAgInZhbHVlIiA6ICI5LjEiLA0KICAgICAgICAgICJ1
bml0cyIgOiAiJSIsDQogICAgICAgICAgInJhbmdlIiA6ICIgNC4zIC0gMTEuMCAiDQogICAgICAg
IH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJFb3NpbsOzZmlsb3Mi
LA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMi42IiwNCiAgICAgICAgICAidW5pdHMiIDogIiUiLA0K
ICAgICAgICAgICJyYW5nZSIgOiAiIDAuMCAtIDMuMCAiDQogICAgICAgIH0sDQogICAgICAgIHsN
CiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJCYXPDs2ZpbG9zIiwNCiAgICAgICAgICAidmFs
dWUiIDogIjAuNiIsDQogICAgICAgICAgInVuaXRzIiA6ICIlIiwNCiAgICAgICAgICAicmFuZ2Ui
IDogIiAwLjAgIDAuNyAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJu
YWxOYW1lIiA6ICJOZXV0csOzZmlsb3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNy4xNCIsDQog
ICAgICAgICAgInVuaXRzIiA6ICJ4MTBeMyAvdUwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDIu
MDAgLSA3LjE1ICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIkxpbmZvY2l0b3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMS42NyIsDQogICAgICAg
ICAgInVuaXRzIiA6ICJ4MTBeMyAvdUwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDEuMTYgLSAz
LjE4ICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5hbWUiIDog
IkdyYW51bG9jaXRvcyBJbm1hZHVyb3MiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiMC4xMCIsDQog
ICAgICAgICAgInVuaXRzIiA6ICJ4MTBeMyAvdUwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDAu
MDAgLSAwLjA5ICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIk1vbm9jaXRvcyIsDQogICAgICAgICAgInZhbHVlIiA6ICIwLjkyIiwNCiAgICAgICAg
ICAidW5pdHMiIDogIngxMF4zIC91TCIsDQogICAgICAgICAgInJhbmdlIiA6ICIgMC4yOSAtIDAu
NzEgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAi
RW9zaW7Ds2ZpbG9zIiwNCiAgICAgICAgICAidmFsdWUiIDogIjAuMjYiLA0KICAgICAgICAgICJ1
bml0cyIgOiAieDEwXjMgL3VMIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiAwLjAzIC0gMC4yNyAi
DQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJCYXPD
s2ZpbG9zIiwNCiAgICAgICAgICAidmFsdWUiIDogIjAuMDYiLA0KICAgICAgICAgICJ1bml0cyIg
OiAieDEwXjMgL3VMIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiAwLjAxIC0gMC4wNSAiDQogICAg
ICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJFcml0cm9jaXRv
cyIsDQogICAgICAgICAgInZhbHVlIiA6ICIzLjQyIiwNCiAgICAgICAgICAidW5pdHMiIDogIngx
MF42IC91TCIsDQogICAgICAgICAgInJhbmdlIiA6ICIgNC4yMCAtIDUuNDAgIg0KICAgICAgICB9
LA0KICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiSGVtb2dsb2JpbmEiLA0K
ICAgICAgICAgICJ2YWx1ZSIgOiAiMTEuMCIsDQogICAgICAgICAgInVuaXRzIiA6ICJnL2RMIiwN
CiAgICAgICAgICAicmFuZ2UiIDogIiAxMi4wIC0gMTYuMCAiDQogICAgICAgIH0sDQogICAgICAg
IHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJIZW1hdG9jcml0byIsDQogICAgICAgICAg
InZhbHVlIiA6ICIzMy4wIiwNCiAgICAgICAgICAidW5pdHMiIDogIiUiLA0KICAgICAgICAgICJy
YW5nZSIgOiAiIDM4LjAgLSA0OC4wICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAg
ICJleHRlcm5hbE5hbWUiIDogIlBWQyAoUHJvbWVkaW8gVm9sdW1lbiBDb3B1c2N1bGFyKSIsDQog
ICAgICAgICAgInZhbHVlIiA6ICI5Ni41IiwNCiAgICAgICAgICAidW5pdHMiIDogImZMIiwNCiAg
ICAgICAgICAicmFuZ2UiIDogIiA4Ni4wIC0gOTYuMCAiDQogICAgICAgIH0sDQogICAgICAgIHsN
CiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJQSEMgKFByb21lZGlvIEhlbW9nbG9iaW5hIENv
cnB1c2N1bGFyKSIsDQogICAgICAgICAgInZhbHVlIiA6ICIzMi4yIiwNCiAgICAgICAgICAidW5p
dHMiIDogInBnIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiAyNS4wIC0gMzEuMCAiDQogICAgICAg
IH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJQQ0hDIChQcm9tZWRp
byBDb25jZW50cmFjacOzbiBIZW1vZ2xvYmluYSIsDQogICAgICAgICAgInZhbHVlIiA6ICIzMy4z
IiwNCiAgICAgICAgICAidW5pdHMiIDogImcvZEwiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDMy
LjAgLSAzOC4wICINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICJleHRlcm5hbE5h
bWUiIDogIkFuY2hvIGRlIERpc3RyaWJ1Y2nDs24gRXJpdHJvaWRlIiwNCiAgICAgICAgICAidmFs
dWUiIDogIjE1LjYiLA0KICAgICAgICAgICJ1bml0cyIgOiAiJSIsDQogICAgICAgICAgInJhbmdl
IiA6ICIgMTIuNCAtIDE1LjEgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4
dGVybmFsTmFtZSIgOiAiUmVjdWVudG8gZGUgcGxhcXVldGFzIiwNCiAgICAgICAgICAidmFsdWUi
IDogIjE1NSIsDQogICAgICAgICAgInVuaXRzIiA6ICJ4MTBeMyAvdUwiLA0KICAgICAgICAgICJy
YW5nZSIgOiAiIDE4NiAtIDM1MyAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAi
ZXh0ZXJuYWxOYW1lIiA6ICJWb2x1bWVuIFBsYXF1ZXRhcmlvIE1lZGlvIiwNCiAgICAgICAgICAi
dmFsdWUiIDogIjEyLjMiLA0KICAgICAgICAgICJ1bml0cyIgOiAiZkwiLA0KICAgICAgICAgICJy
YW5nZSIgOiAiIDkuNiAtIDEyLjAgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAg
ImV4dGVybmFsTmFtZSIgOiAiSGllcnJvIFPDqXJpY28gVG90YWwiLA0KICAgICAgICAgICJ2YWx1
ZSIgOiAiNTIuMCIsDQogICAgICAgICAgInVuaXRzIiA6ICJ1Zy9kTCIsDQogICAgICAgICAgInJh
bmdlIiA6ICIgNTAgLSAxNzAgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4
dGVybmFsTmFtZSIgOiAiQ2FwYWNpZGFkIG5vIFNhdHVyYWRhIGRlIEZpamFjaW9uIiwNCiAgICAg
ICAgICAidmFsdWUiIDogIjE1OCIsDQogICAgICAgICAgInVuaXRzIiA6ICJ1Zy9kTCIsDQogICAg
ICAgICAgInJhbmdlIiA6ICIgIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgImV4
dGVybmFsTmFtZSIgOiAiUG90YXNpbyIsDQogICAgICAgICAgInZhbHVlIiA6ICI0LjM3IiwNCiAg
ICAgICAgICAidW5pdHMiIDogIm1tb2wvTCAiLA0KICAgICAgICAgICJyYW5nZSIgOiAiIDMuNSAt
IDUuMSAiDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6
ICJQcm90ZWluYXMgVG90YWxlcyAiLA0KICAgICAgICAgICJ2YWx1ZSIgOiAiNy4xOSIsDQogICAg
ICAgICAgInVuaXRzIiA6ICJnL2RMIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiA2LjIgIDguMSAi
DQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAiZXh0ZXJuYWxOYW1lIiA6ICJTb2Rp
byIsDQogICAgICAgICAgInZhbHVlIiA6ICIxNDEuMDUiLA0KICAgICAgICAgICJ1bml0cyIgOiAi
bW1vbC9MIiwNCiAgICAgICAgICAicmFuZ2UiIDogIiAxMzYgLSAxNDUgIg0KICAgICAgICB9LA0K
ICAgICAgICB7DQogICAgICAgICAgImV4dGVybmFsTmFtZSIgOiAiVHJhbnNmZXJyaW5hIiwNCiAg
ICAgICAgICAidmFsdWUiIDogIjE5NCIsDQogICAgICAgICAgInVuaXRzIiA6ICJtZy9kTCIsDQog
ICAgICAgICAgInJhbmdlIiA6ICIgMTczIC0gMzYwICINCiAgICAgICAgfSwNCiAgICAgICAgew0K
ICAgICAgICAgICJleHRlcm5hbE5hbWUiIDogIlRyaWdsaWPDqXJpZG9zIiwNCiAgICAgICAgICAi
dmFsdWUiIDogIjEzNSIsDQogICAgICAgICAgInVuaXRzIiA6ICJtZy9kbCAiLA0KICAgICAgICAg
ICJyYW5nZSIgOiAiPCAxNTAgIg0KICAgICAgICB9DQogICAgICBdDQogICAgfQ0KICBdLA0KICAi
c2VuZGVyUmVmZXJlbmNlIiA6ICJ7XCJjYXNlSWRcIjpcIjMxMjc5OTA5XzQyMDA2NTk0OFwiLFwi
dXVpZENEU1wiOlwiYmYzY2YzNzQtODkyMy00YWJmLTllZGQtNDhjNDRmZWJlZTg1XCIsXCJzaXRl
XCI6XCI4MzAwMDczNTVcIixcIlBJRFwiOlwiQ0NcIixcIlBJRDJcIjpcIjMxMjc5OTA5XCIsXCJQ
SUQzXCI6XCI0MjAwNjU5NDhcIixcImVwaXNvZGVEYXRlXCI6XCIyMDIzMTExNTExNDQ1NFwiLFwi
U2FtcGxlSURcIjpcIlwiLFwiRmVjaGFSZWdpc3Ryb09yZGVuXCI6XCIyMDIzMTExNTExNDQ1NFwi
LFwiTWVkaWNvUGV0aWNpb25hcmlvSURcIjpcIjgzMDAwNzM1NVwiLFwiU2VkZVN5bmxhYlByZXNl
bnRhY2lvblwiOlwiNDIwXCIsXCJDb2RpZ29QbGFuQ2xpZW50ZVwiOlwiNDk0NVwiLFwiTklUXCI6
XCI4MzAwMDczNTVcIixcIlJhem9uU29jaWFsXCI6XCJGUkVTRU5JVVMgTUVESUNBTCBDQVJFIENP
TE9NQklBXCIsXCJFZGFkUGFjaWVudGVcIjo2OSxcIlBhdGllbnRTZXhcIjpcIkZcIn0iDQp9</inboundTemplate>
          <outboundTemplate encoding="base64"></outboundTemplate>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>8</metaDataId>
          <name>Send Case to Criticos</name>
          <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>false</reattachAttachments>
            </destinationConnectorProperties>
            <host>http://localhost:9023/rdr/interpreter/query?kbcode=CRITIC</host>
            <useProxyServer>false</useProxyServer>
            <proxyAddress></proxyAddress>
            <proxyPort></proxyPort>
            <method>post</method>
            <headers class="linked-hash-map"/>
            <parameters class="linked-hash-map"/>
            <useHeadersVariable>false</useHeadersVariable>
            <headersVariable></headersVariable>
            <useParametersVariable>false</useParametersVariable>
            <parametersVariable></parametersVariable>
            <responseXmlBody>false</responseXmlBody>
            <responseParseMultipart>true</responseParseMultipart>
            <responseIncludeMetadata>false</responseIncludeMetadata>
            <responseBinaryMimeTypes>application/.*(?&lt;!json|xml)$|image/.*|video/.*|audio/.*</responseBinaryMimeTypes>
            <responseBinaryMimeTypesRegex>true</responseBinaryMimeTypesRegex>
            <multipart>false</multipart>
            <useAuthentication>false</useAuthentication>
            <authenticationType>Basic</authenticationType>
            <usePreemptiveAuthentication>false</usePreemptiveAuthentication>
            <username></username>
            <password></password>
            <content>${message.encodedData}</content>
            <contentType>application/json</contentType>
            <dataTypeBinary>false</dataTypeBinary>
            <charset>UTF-8</charset>
            <socketTimeout>30000</socketTimeout>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements/>
            <inboundTemplate encoding="base64">ew0KICAiY2FzZUlkIiA6ICIiLA0KICAic2l0ZSIgOiAiY2h1Y2siLA0KICAic2VuZGVyUmVmZXJl
bmNlIiA6ICI8SEw3TWVzc2FnZT48TVNIPjxNU0guMT58PC9NU0guMT48TVNILjI+Xn5cXCZhbXA7
PC9NU0guMj48TVNILjM+PE1TSC4zLjE+R2xpbXM8L01TSC4zLjE+PC9NU0guMz48TVNILjQ+PE1T
SC40LjE+Y3liZXJsYWI5U1o8L01TSC40LjE+PC9NU0guND48TVNILjU+PE1TSC41LjE+MTk5OTAy
MDFMRUVTMjE8L01TSC41LjE+PC9NU0guNT48TVNILjY+PE1TSC42LjE+Y3liZXJsYWI5U1o8L01T
SC42LjE+PC9NU0guNj48TVNILjc+PE1TSC43LjE+MjAyMDA1MjAwOTEzMzE8L01TSC43LjE+PC9N
U0guNz48TVNILjgvPjxNU0guOT48TVNILjkuMT5PVUw8L01TSC45LjE+PE1TSC45LjI+UjIyPC9N
U0guOS4yPjwvTVNILjk+PE1TSC4xMD48TVNILjEwLjE+MDcwMDIxMzA4Mjc5PC9NU0guMTAuMT48
L01TSC4xMD48TVNILjExPjxNU0guMTEuMT5QPC9NU0guMTEuMT48L01TSC4xMT48TVNILjEyPjxN
U0guMTIuMT4yLjU8L01TSC4xMi4xPjwvTVNILjEyPjxNU0guMTMvPjxNU0guMTQvPjxNU0guMTU+
PE1TSC4xNS4xPk5FPC9NU0guMTUuMT48L01TSC4xNT48TVNILjE2PjxNU0guMTYuMT5BTDwvTVNI
LjE2LjE+PC9NU0guMTY+PE1TSC4xNy8+PE1TSC4xOD48TVNILjE4LjE+MTI1MjwvTVNILjE4LjE+
PC9NU0guMTg+PC9NU0g+PFBJRD48UElELjE+PFBJRC4xLjE+MTwvUElELjEuMT48L1BJRC4xPjxQ
SUQuMi8+PFBJRC4zPjxQSUQuMy4xPjEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5HTElNUzwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMTIzNDU2
NzwvUElELjMuMT48UElELjMuMi8+PFBJRC4zLjMvPjxQSUQuMy40PktHX0k8L1BJRC4zLjQ+PC9Q
SUQuMz48UElELjM+PFBJRC4zLjE+MDEyMzQ1Njc8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4z
Lz48UElELjMuND5LR19JPC9QSUQuMy40PjwvUElELjM+PFBJRC4zPjxQSUQuMy4xPjAxMjM0NTY3
ODk8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5TWl9JPC9QSUQuMy40Pjwv
UElELjM+PFBJRC4zPjxQSUQuMy4xPjA5ODc2NTQzPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMu
My8+PFBJRC4zLjQ+VERfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT4wMDAwMDAw
MDA8L1BJRC4zLjE+PFBJRC4zLjIvPjxQSUQuMy4zLz48UElELjMuND5OTE1JTkJJWkE8L1BJRC4z
LjQ+PC9QSUQuMz48UElELjM+PFBJRC4zLjE+MDAwMDAwMDAwPC9QSUQuMy4xPjxQSUQuMy4yLz48
UElELjMuMy8+PFBJRC4zLjQ+TUxfSTwvUElELjMuND48L1BJRC4zPjxQSUQuMz48UElELjMuMT44
NzY1NDMyPC9QSUQuMy4xPjxQSUQuMy4yLz48UElELjMuMy8+PFBJRC4zLjQ+Q0FTU0NPTlRST0w8
L1BJRC4zLjQ+PC9QSUQuMz48UElELjQvPjxQSUQuNT48UElELjUuMT5MZWVzbmFhbSB2YW48L1BJ
RC41LjE+PFBJRC41LjI+UElFVEpFPC9QSUQuNS4yPjxQSUQuNS4zPlMuIE4uPC9QSUQuNS4zPjwv
UElELjU+PFBJRC42Lz48UElELjc+PFBJRC43LjE+MTk5OTAyMDE8L1BJRC43LjE+PC9QSUQuNz48
UElELjg+PFBJRC44LjE+RjwvUElELjguMT48L1BJRC44PjxQSUQuOS8+PFBJRC4xMC8+PFBJRC4x
MT48UElELjExLjE+U3Vpa2Vyc3RyYWF0PC9QSUQuMTEuMT48UElELjExLjI+MTE8L1BJRC4xMS4y
PjxQSUQuMTEuMz5EdWNrc3RhZDwvUElELjExLjM+PFBJRC4xMS40Lz48UElELjExLjU+MTEyMkFC
PC9QSUQuMTEuNT48UElELjExLjY+Tkw8L1BJRC4xMS42PjwvUElELjExPjxQSUQuMTIvPjxQSUQu
MTM+PFBJRC4xMy4xPjAyNTU1OTk5OTk8L1BJRC4xMy4xPjxQSUQuMTMuMi8+PFBJRC4xMy4zPlBI
PC9QSUQuMTMuMz48L1BJRC4xMz48UElELjE0Lz48UElELjE1Lz48UElELjE2Lz48UElELjE3Lz48
UElELjE4Lz48UElELjE5Lz48UElELjIwLz48UElELjIxLz48UElELjIyLz48UElELjIzLz48UElE
LjI0PjxQSUQuMjQuMT5OPC9QSUQuMjQuMT48L1BJRC4yND48UElELjI1Lz48UElELjI2Lz48UElE
LjI3Lz48UElELjI4Lz48UElELjI5Lz48UElELjMwPjxQSUQuMzAuMT5OPC9QSUQuMzAuMT48L1BJ
RC4zMD48L1BJRD48UEQxPjxQRDEuMS8+PFBEMS4yLz48UEQxLjMvPjxQRDEuND48UEQxLjQuMT4w
MTAyMzg2ODwvUEQxLjQuMT48UEQxLjQuMj5BYmJla2VyazwvUEQxLjQuMj48UEQxLjQuMz5FLk0u
PC9QRDEuNC4zPjxQRDEuNC40Lz48UEQxLjQuNS8+PFBEMS40LjYvPjxQRDEuNC43Lz48UEQxLjQu
OC8+PFBEMS40Ljk+R0xJTVM8L1BEMS40Ljk+PC9QRDEuND48L1BEMT48UFYxPjxQVjEuMT48UFYx
LjEuMT4xPC9QVjEuMS4xPjwvUFYxLjE+PFBWMS4yPjxQVjEuMi4xPkk8L1BWMS4yLjE+PC9QVjEu
Mj48UFYxLjM+PFBWMS4zLjE+SEFaSUNVPC9QVjEuMy4xPjxQVjEuMy4yPjUyMTcxNzwvUFYxLjMu
Mj48UFYxLjMuMy8+PFBWMS4zLjQvPjxQVjEuMy41Lz48UFYxLjMuNi8+PFBWMS4zLjcvPjxQVjEu
My44Lz48UFYxLjMuOS8+PFBWMS4zLjEwLz48UFYxLjMuMTE+R0xJTVM8L1BWMS4zLjExPjwvUFYx
LjM+PFBWMS40Lz48UFYxLjUvPjxQVjEuNi8+PFBWMS43Lz48UFYxLjgvPjxQVjEuOS8+PFBWMS4x
MC8+PFBWMS4xMS8+PFBWMS4xMi8+PFBWMS4xMy8+PFBWMS4xNC8+PFBWMS4xNS8+PFBWMS4xNi8+
PFBWMS4xNy8+PFBWMS4xOC8+PFBWMS4xOT48UFYxLjE5LjE+NTYyMzIwNjM8L1BWMS4xOS4xPjwv
UFYxLjE5PjxQVjEuMjAvPjxQVjEuMjEvPjxQVjEuMjIvPjxQVjEuMjMvPjxQVjEuMjQvPjxQVjEu
MjUvPjxQVjEuMjYvPjxQVjEuMjcvPjxQVjEuMjgvPjxQVjEuMjkvPjxQVjEuMzAvPjxQVjEuMzEv
PjxQVjEuMzIvPjxQVjEuMzMvPjxQVjEuMzQvPjxQVjEuMzUvPjxQVjEuMzYvPjxQVjEuMzcvPjxQ
VjEuMzgvPjxQVjEuMzkvPjxQVjEuNDAvPjxQVjEuNDEvPjxQVjEuNDIvPjxQVjEuNDMvPjxQVjEu
NDQ+PFBWMS40NC4xPjIwMjAwMzIxMTgxMzA1PC9QVjEuNDQuMT48L1BWMS40ND48UFYxLjQ1PjxQ
VjEuNDUuMT4yMDIwMDQwODEwMTUwMDwvUFYxLjQ1LjE+PC9QVjEuNDU+PC9QVjE+PFBWMT48UFYx
LjE+PFBWMS4xLjE+MTwvUFYxLjEuMT48L1BWMS4xPjxQVjEuMj48UFYxLjIuMT5JPC9QVjEuMi4x
PjwvUFYxLjI+PFBWMS4zPjxQVjEuMy4xPkhBWklDVTwvUFYxLjMuMT48UFYxLjMuMj41MjE3MTc8
L1BWMS4zLjI+PFBWMS4zLjMvPjxQVjEuMy40Lz48UFYxLjMuNS8+PFBWMS4zLjYvPjxQVjEuMy43
Lz48UFYxLjMuOC8+PFBWMS4zLjkvPjxQVjEuMy4xMC8+PFBWMS4zLjExPkdMSU1TPC9QVjEuMy4x
MT48L1BWMS4zPjxQVjEuNC8+PFBWMS41Lz48UFYxLjYvPjxQVjEuNy8+PFBWMS44Lz48UFYxLjkv
PjxQVjEuMTAvPjxQVjEuMTEvPjxQVjEuMTIvPjxQVjEuMTMvPjxQVjEuMTQvPjxQVjEuMTUvPjxQ
VjEuMTYvPjxQVjEuMTcvPjxQVjEuMTgvPjxQVjEuMTk+PFBWMS4xOS4xPjU2MjMyMDYzPC9QVjEu
MTkuMT48L1BWMS4xOT48UFYxLjIwLz48UFYxLjIxLz48UFYxLjIyLz48UFYxLjIzLz48UFYxLjI0
Lz48UFYxLjI1Lz48UFYxLjI2Lz48UFYxLjI3Lz48UFYxLjI4Lz48UFYxLjI5Lz48UFYxLjMwLz48
UFYxLjMxLz48UFYxLjMyLz48UFYxLjMzLz48UFYxLjM0Lz48UFYxLjM1Lz48UFYxLjM2Lz48UFYx
LjM3Lz48UFYxLjM4Lz48UFYxLjM5Lz48UFYxLjQwLz48UFYxLjQxLz48UFYxLjQyLz48UFYxLjQz
Lz48UFYxLjQ0PjxQVjEuNDQuMT4yMDIwMDMyMTE4MTMwNTwvUFYxLjQ0LjE+PC9QVjEuNDQ+PFBW
MS40NT48UFYxLjQ1LjE+MjAyMDA0MDgxMDE1MDA8L1BWMS40NS4xPjwvUFYxLjQ1PjwvUFYxPjxT
UE0+PFNQTS4xPjxTUE0uMS4xPjE8L1NQTS4xLjE+PC9TUE0uMT48U1BNLjI+PFNQTS4yLjEvPjxT
UE0uMi4yPjxTUE0uMi4yLjE+MjAwMzI0MDQwNjAyPC9TUE0uMi4yLjE+PFNQTS4yLjIuMj5HTElN
UzwvU1BNLjIuMi4yPjwvU1BNLjIuMj48L1NQTS4yPjxTUE0uMy8+PFNQTS40PjxTUE0uNC4xPlZC
Q0FQPC9TUE0uNC4xPjxTUE0uNC4yPlZvbGJsb2VkIENhcGlsbGFpcjwvU1BNLjQuMj48U1BNLjQu
Mz5HTElNUzwvU1BNLjQuMz48L1NQTS40PjxTUE0uNS8+PFNQTS42Lz48U1BNLjcvPjxTUE0uOC8+
PFNQTS45Lz48U1BNLjEwLz48U1BNLjExLz48U1BNLjEyPjxTUE0uMTIuMT4wPC9TUE0uMTIuMT48
U1BNLjEyLjI+PFNQTS4xMi4yLjE+bWw8L1NQTS4xMi4yLjE+PFNQTS4xMi4yLjI+bWw8L1NQTS4x
Mi4yLjI+PFNQTS4xMi4yLjM+R0xJTVM8L1NQTS4xMi4yLjM+PC9TUE0uMTIuMj48L1NQTS4xMj48
U1BNLjEzLz48U1BNLjE0Lz48U1BNLjE1Lz48U1BNLjE2Lz48U1BNLjE3PjxTUE0uMTcuMT4yMDIw
MDMyNDEzNTMyNzwvU1BNLjE3LjE+PC9TUE0uMTc+PFNQTS4xOD48U1BNLjE4LjE+MjAyMDAzMjQx
MzUzMjc8L1NQTS4xOC4xPjwvU1BNLjE4PjxTUE0uMTkvPjxTUE0uMjA+PFNQTS4yMC4xPlk8L1NQ
TS4yMC4xPjwvU1BNLjIwPjwvU1BNPjxPUkM+PE9SQy4xPjxPUkMuMS4xPlNDPC9PUkMuMS4xPjwv
T1JDLjE+PE9SQy4yLz48T1JDLjM+PE9SQy4zLjE+RV8yMDAzMjQwMzI4PC9PUkMuMy4xPjxPUkMu
My4yPkdMSU1TPC9PUkMuMy4yPjwvT1JDLjM+PE9SQy40Lz48T1JDLjU+PE9SQy41LjE+Q008L09S
Qy41LjE+PC9PUkMuNT48T1JDLjYvPjxPUkMuNz48T1JDLjcuMS8+PE9SQy43LjIvPjxPUkMuNy4z
Lz48T1JDLjcuND4yMDIwMDMyNDEzNTMyNzwvT1JDLjcuND48T1JDLjcuNS8+PE9SQy43LjY+Ujwv
T1JDLjcuNj48L09SQy43PjxPUkMuOC8+PE9SQy45PjxPUkMuOS4xPjIwMjAwNTIwMDkxMzMxPC9P
UkMuOS4xPjwvT1JDLjk+PE9SQy4xMC8+PE9SQy4xMS8+PE9SQy4xMj48T1JDLjEyLjE+MTAwMDAw
MDc2MDwvT1JDLjEyLjE+PE9SQy4xMi4yPkJFTk5FUjwvT1JDLjEyLjI+PE9SQy4xMi4zPlBNLmlu
dGVuc2l2aXN0PC9PUkMuMTIuMz48T1JDLjEyLjQvPjxPUkMuMTIuNS8+PE9SQy4xMi42Lz48T1JD
LjEyLjcvPjxPUkMuMTIuOC8+PE9SQy4xMi45PlNaX0k8L09SQy4xMi45PjwvT1JDLjEyPjxPUkMu
MTM+PE9SQy4xMy4xPkhBWklDVTwvT1JDLjEzLjE+PE9SQy4xMy4yLz48T1JDLjEzLjMvPjxPUkMu
MTMuNC8+PE9SQy4xMy41Lz48T1JDLjEzLjYvPjxPUkMuMTMuNy8+PE9SQy4xMy44Lz48T1JDLjEz
LjkvPjxPUkMuMTMuMTAvPjxPUkMuMTMuMTE+R0xJTVM8L09SQy4xMy4xMT48L09SQy4xMz48T1JD
LjE0Lz48T1JDLjE1Lz48T1JDLjE2Lz48T1JDLjE3PjxPUkMuMTcuMT5LR0VHPC9PUkMuMTcuMT48
T1JDLjE3LjI+RGVjZW50cmFhbCBTcGFhcm5lZ2FzdGh1aXMgbG9jYXRpZSBIYWFybGVtIHp1aWQ8
L09SQy4xNy4yPjxPUkMuMTcuMz5HTElNUzwvT1JDLjE3LjM+PC9PUkMuMTc+PE9SQy4xOC8+PE9S
Qy4xOT48T1JDLjE5LjE+MTAwMDAwMTE3OTwvT1JDLjE5LjE+PE9SQy4xOS4yPlByb25rLUFkbWly
YWFsPC9PUkMuMTkuMj48T1JDLjE5LjM+Q0o8L09SQy4xOS4zPjxPUkMuMTkuNC8+PE9SQy4xOS41
Lz48T1JDLjE5LjYvPjxPUkMuMTkuNz5Eci48L09SQy4xOS43PjxPUkMuMTkuOC8+PE9SQy4xOS45
PlNaX0k8L09SQy4xOS45PjwvT1JDLjE5PjwvT1JDPjwvSEw3TWVzc2FnZT4iLA0KICAiYXBwcm92
ZWQiIDogdHJ1ZQ0KfQ==</inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>HTTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>false</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>false</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>CASEID</name>
            <type>STRING</type>
            <mappingName>Case</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1700850088983</time>
            <timezone>America/Bogota</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>7</pruneMetaDataDays>
            <archiveEnabled>false</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
    <channel version="3.9.1">
      <id>75be6ae6-9204-47f0-90bb-4d5cc65fe92a</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>requestHistorical</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.9.1">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.9.1">
          <pluginProperties/>
          <sourceConnectorProperties version="3.9.1">
            <responseVariable>d1</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
        </properties>
        <transformer version="3.9.1">
          <elements/>
          <inboundDataType>JSON</inboundDataType>
          <outboundDataType>JSON</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
            <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
              <splitType>JavaScript</splitType>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.9.1">
          <elements/>
        </filter>
        <transportName>Channel Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.9.1">
          <metaDataId>1</metaDataId>
          <name>Destination 1</name>
          <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="3.9.1">
            <pluginProperties/>
            <destinationConnectorProperties version="3.9.1">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <host>http://10.57.252.145:7001/historicocds</host>
            <useProxyServer>false</useProxyServer>
            <proxyAddress></proxyAddress>
            <proxyPort></proxyPort>
            <method>post</method>
            <headers class="linked-hash-map"/>
            <parameters class="linked-hash-map"/>
            <useHeadersVariable>false</useHeadersVariable>
            <headersVariable></headersVariable>
            <useParametersVariable>false</useParametersVariable>
            <parametersVariable></parametersVariable>
            <responseXmlBody>false</responseXmlBody>
            <responseParseMultipart>true</responseParseMultipart>
            <responseIncludeMetadata>false</responseIncludeMetadata>
            <responseBinaryMimeTypes>application/.*(?&lt;!json|xml)$|image/.*|video/.*|audio/.*</responseBinaryMimeTypes>
            <responseBinaryMimeTypesRegex>true</responseBinaryMimeTypesRegex>
            <multipart>false</multipart>
            <useAuthentication>false</useAuthentication>
            <authenticationType>Basic</authenticationType>
            <usePreemptiveAuthentication>false</usePreemptiveAuthentication>
            <username></username>
            <password></password>
            <content>${message.rawData}</content>
            <contentType>application/json</contentType>
            <dataTypeBinary>false</dataTypeBinary>
            <charset>UTF-8</charset>
            <socketTimeout>10000</socketTimeout>
          </properties>
          <transformer version="3.9.1">
            <elements/>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.9.1">
            <elements>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.9.1">
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <script></script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64"></inboundTemplate>
            <outboundTemplate encoding="base64"></outboundTemplate>
            <inboundDataType>JSON</inboundDataType>
            <outboundDataType>JSON</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.9.1">
              <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.9.1">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.9.1">
            <elements/>
          </filter>
          <transportName>HTTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.9.1">
        <clearGlobalChannelMap>true</clearGlobalChannelMap>
        <messageStorageMode>PRODUCTION</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STARTED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns/>
        <attachmentProperties version="3.9.1">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1700840369377</time>
            <timezone>Europe/London</timezone>
          </lastModified>
          <pruningSettings>
            <pruneMetaDataDays>2</pruneMetaDataDays>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
        <codeTemplateLibraries>
          <codeTemplateLibrary version="3.9.1">
            <id>14edb524-2418-43b8-a793-a6cd4834125f</id>
            <name>CDSLibrary</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075456</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>77ab9cc6-2ecd-44c0-b42b-12d7d0d9f189</string>
              <string>1d1c2f3f-7b43-4a08-aac9-3406457df838</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8c353129-1ddc-49ad-8b83-3ad2afe7a40c</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>433ad4fa-bc93-47c1-a845-5efea1c1072e</string>
              <string>7fe17d45-0d9c-4e3b-84e5-1ca99bbed1b0</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>1badc74d-d04c-406b-877f-d31701e3e635</string>
              <string>84789e18-d176-4c56-b440-2e0f2e95a99a</string>
              <string>d399041c-db53-4cb3-bc90-de88541ad78f</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>76c3a018-7fc4-4fa9-a233-ae85c317f616</string>
              <string>55980407-140c-48e7-bc35-175c21f68fcb</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>fc376d9e-a4a0-42b9-8945-c643c00a0048</string>
              <string>18a8bfe5-6fbf-40b0-ac5e-d1e0b34316b3</string>
              <string>b0a96d01-1c22-4c23-bce1-5536abe79f78</string>
              <string>6e154ddd-fa94-48d0-8d51-099d4b18dc7e</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>b713e9b5-f29f-420c-8767-347c4cc59235</string>
              <string>73de28ab-9b76-43f5-a589-933aca189633</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>c103919f-4f02-4ebb-b5fc-c74d70f9d984</string>
              <string>7323ba37-7876-4329-bd17-6e8f63f70320</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>1dc78376-5e82-488e-8b61-844d9c9201f6</string>
              <string>824a47e1-d27d-4c70-b613-87b22a06b30f</string>
              <string>73fcebb7-1fac-4550-8bcf-cd90553c8706</string>
              <string>dfaea744-4c0c-4e3e-974f-2714feb84b6a</string>
              <string>4c30d333-07c7-4608-90fb-f209480945f9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>65fd27b3-2550-4fc6-a077-3b700f624801</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>92a2401a-38b2-4332-ae9c-382eeff9fed9</string>
              <string>ec42f2b5-da91-422d-8e84-ca8fce839ca9</string>
              <string>f9e9b002-0d75-4d07-9829-9a936107fa64</string>
              <string>3e3fa50e-bf1f-4040-94e8-e534f59f1aca</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>7b43fb86-dd49-4f24-8e63-2921f65835a7</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>e5ac2e27-f193-4738-b6e4-fa77ccdb8210</string>
              <string>5d6a3192-30a4-4b5d-9e42-ce67cc86d815</string>
              <string>a769de5d-f56c-4603-bcbc-3d2459213531</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>d1e3a6bf-f2ad-4395-aa42-5a39ca3e671d</string>
              <string>a0372fd7-10c0-4832-adb3-80afede56081</string>
              <string>1bc4cc73-cce0-43f1-98af-52d3072840e1</string>
              <string>1e3cb27c-ab1a-4edd-837b-baa3d7a7b1e4</string>
              <string>8be4a05a-d1fb-452f-bdbc-dc149574753f</string>
              <string>9d321038-d32a-41be-b3a2-abd7434dff69</string>
              <string>799b2a4c-6925-4ea7-8470-0d0fc00df393</string>
              <string>5dffbd4e-833e-4a91-9497-740ad95fc4e1</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>7a35a369-f78d-4e11-b045-c84d87d26355</string>
              <string>b1b9fd9d-0be2-4a67-87a8-38f405b2c3bb</string>
              <string>84ce7656-7580-4d1d-9d81-e81e325089fd</string>
              <string>b13045bc-2898-4fc1-b952-5ea29cf70720</string>
              <string>750017ad-a990-4ed0-9a1f-75c94531aba4</string>
              <string>54694f01-6c22-44db-a7e5-ebc9ae829740</string>
              <string>b5bdf4f0-81b3-4c53-b885-c0c670db3d57</string>
              <string>8f69e69c-327c-4275-8aca-f2cda426dab5</string>
              <string>3b2dd6b0-68c1-4392-b655-087abacd766d</string>
              <string>01ea1ce1-60ff-42c5-b059-a15a77275267</string>
              <string>cb9377d3-e95b-4b0b-bbb2-5e84fb106556</string>
              <string>a036bb2a-a192-455b-b3f3-14ab0fd5cbac</string>
              <string>110bc202-af08-4bfe-b641-887703d741f0</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>4b6f419b-3fbf-4371-b1fe-c51ecd5a05aa</string>
              <string>23b63fb2-743f-481a-9726-99430365b127</string>
              <string>d459da66-c436-4ae0-a5ec-d153d2d891a5</string>
              <string>37586608-d3c6-4465-953a-dce98ee13a2c</string>
              <string>ed36555d-bab4-476d-9887-ac2727f94e40</string>
              <string>2472b206-9949-4ada-acbb-64b14eae1b78</string>
              <string>a849d594-1242-4840-8d17-634abf7a9e66</string>
              <string>b5b3ad88-a0a7-4110-8813-19f68dc7b136</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>68af7e0a-a2a5-438d-bb24-fd55642929a2</id>
                <name>createAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480447</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createAttribute(name ,value){
	var attributeObject = {};
  attributeObject.externalName = name;
  attributeObject.value =	value;	
  return attributeObject
	}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>06ef2d18-82b1-4402-9113-6f4a8d472361</id>
                <name>createExtendedAttribute</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481876</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function createExtendedAttribute(externalName,value,units,range)
{
	var attributeObject = {};
	if(validateValues(value))
	{ 
		
	  	attributeObject.externalName  = externalName;
	  	attributeObject.value =value;
	  	attributeObject.units =units;
	  	
	  	if (validateRange(range)){
	 		attributeObject.range=range ;
	  	}
	 	
		
	}else 
	{attributeObject.externalName  = externalName;}
	return  attributeObject;
	
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>0bf4aa5b-5d2c-467e-a47a-8c05e137f6a3</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480091</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>aff2785a-9d8b-44e1-8667-21a23f632eb6</id>
                <name>validateRange</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480657</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateRange(ReferenceRange)
{
	if(ReferenceRange != null &amp;&amp; ReferenceRange.toString().trim().indexOf(&apos;-&apos;) &gt;=0 )
	{
	return true;
	}
	else { return false;}
	}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>e5be0fe3-40ff-4738-9e29-19199e8e10aa</id>
                <name>validateValues</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481349</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>function validateValues(labvalue)
{
	if (  labvalue == null || labvalue == &quot;Nil&quot;  )
	{return false;}
	else
	return true;
	};
	</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0e6800ae-6d84-4245-9e09-2c1a2f28d8fc</id>
            <name>Common</name>
            <revision>2</revision>
            <lastModified>
              <time>1702919075449</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>43f73dbc-f73d-4178-9aa0-b451c05922e2</id>
                <name>Check if String contains</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480368</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if one string (source) contains another string (target).

	@param {String} arg1 - target string to lookup in the source string
	@return {String} return true if the source string contains the target string
*/
String.prototype.contains = function(arg1) {
	
	return this.indexOf(arg1) &gt; -1;
		
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>6a420042-a38d-4d6b-8567-d0290086256a</id>
                <name>Check if String contains HTTP code</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479785</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>COMPILED_CODE</type>
                  <code>/**
	To verify if the given string contains HTTP status code.

	@param - no parameter
	@return {String} return true if the string contains the HTTP status code, false otherwise
*/

function isHttpCode2xx(arg1) {
	var code2xx = [&apos;200&apos;,&apos;201&apos;,&apos;202&apos;,&apos;203&apos;,&apos;204&apos;,&apos;205&apos;,&apos;206&apos;,&apos;207&apos;,&apos;208&apos;];	
	var length = code2xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code2xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode4xx(arg1) {
	var code4xx = [&apos;400&apos;,&apos;401&apos;,&apos;402&apos;,&apos;403&apos;,&apos;404&apos;,&apos;405&apos;,&apos;406&apos;,&apos;407&apos;,&apos;408&apos;,&apos;409&apos;,&apos;410&apos;,&apos;411&apos;,&apos;412&apos;,&apos;413&apos;,&apos;414&apos;,&apos;415&apos;,&apos;416&apos;,&apos;417&apos;,&apos;429&apos;,&apos;431&apos;,&apos;451&apos;];	
	var length = code4xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code4xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}

function isHttpCode5xx(arg1) {
	var code5xx = [&apos;500&apos;,&apos;501&apos;,&apos;502&apos;,&apos;503&apos;,&apos;504&apos;,&apos;505&apos;,&apos;506&apos;,&apos;510&apos;,&apos;511&apos;];	
	var length = code5xx.length;
	
	while(length--) {
   		if (arg1.indexOf(code5xx[length]) &gt; -1) {
       		return true;
   		}   		
	}
	return false;
}
</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>42dbc1c3-72e4-4ece-a6b8-5cd188446027</id>
                <name>Convert JSON date to HL7v2 date</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481529</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.

	@param {String} datetime - JSON date/time (yyyy-MM-ddThh:mm:ss.sss-00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 date (yyyyMMdd)
*/
function convertToHL7v2Date(datetime) { 

	var date = datetime.toString().match(/\d{4}\-\d{2}\-\d{2}/);
	return ((date.length &gt; 0) ? date[0].replace(/\-/g,&apos;&apos;) : date.replace(/\-/g,&apos;&apos;));
	
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>5b60cf28-571b-4aa8-94fe-d3cdf069471b</id>
                <name>Convert JSON datetime to HL7v2 datetime</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479424</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	To convert JSON date/time format to HL7v2 date only format.
	Possible formats:
	&quot;2016-01-01T00:00:00.000Z&quot;	JavaScript built-in JSON object
	&quot;2016-01-01T00:00:00-00:00&quot;	ISO 8601

	@param {String} datetime - JSON date/time with offset (yyyy-MM-ddThh:mm:ss.sss-/+00:00) or (yyyy-MM-dd)
	@return {String} return HL7v2 DTM date type
*/
function convertToHL7v2DateTime(datetime) { 

	var date = [];
	var hl7Date = &quot;&quot;;
	var timeZome = &quot;&quot;;

	if (datetime.indexOf(&quot;T&quot;) &gt; -1) {

		var zone = datetime.toString().slice(datetime.indexOf(&quot;T&quot;) + 1);
		if (zone.indexOf(&quot;+&quot;) &gt; 0) timeZone = &quot;+&quot;;
		if (zone.indexOf(&quot;-&quot;) &gt; 0) timeZone = &quot;-&quot;;

		if (datetime.indexOf(&quot;Z&quot;) &gt; 0) {
			date = datetime.toString().split(/\-|\+|T|:|\./g);
		} else {
			date = datetime.toString().split(/\-|\+|T|:/g);
		}
		
		for (var i=0; i &lt; 6; i++) {			
			hl7Date += date[i]; 
		}
		
		var offset = date.slice(6);
		for (var i=0; i &lt; offset.length; i++) {
			timeZone += offset[i];
		}

		return hl7Date + timeZone;

	} else {
		return convertToHL7v2Date(datetime);
	}
};</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>d014f2fc-cf80-47ad-9de8-6c84807e2f70</id>
                <name>Extract JSON node data</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479521</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Validates if node is not NULL or &quot;undefined&quot;. If the given node is an array, return a string of values.

	@param {String} node - node to extract the data from
	@return {String} return given node value or empty string if such node does not exist
*/
function extract(node) {

	try {
		var result = &quot;&quot;;

		if (null == node) return result;
		
		if ((typeof node) !== &quot;undefined&quot;) {

			if (Object.prototype.toString.call(node) === &apos;[object Array]&apos;) {
				result = org.apache.commons.lang3.StringUtils.join(node, &quot; &quot;)
			} else 
				result = node;
		}
	} finally {
		return result.toString().trim();
	}
}

</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>a3f85cc2-9b95-45a9-9cb1-937197e09cdc</id>
                <name>Verify JSON node for existance</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479695</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Verify if the given node exists.

	@param {String} node - node to verify for existance
	@return {String} return true if the given node exists, false otherwise
*/
function keyExists(node) {
	return ( ((typeof node) !== &quot;undefined&quot;) &amp;&amp; ((typeof node) !== null) );
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>394664c0-d536-4310-970e-181dc03ee7da</id>
            <name>Conversions</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479338</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>c33e2ab9-4947-4a9c-a086-f94a0ab6331f</string>
              <string>f3853b12-9d89-4103-a29b-8b938c30466f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>6471c495-addd-4cf4-a834-e7f9eb93045a</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>3a388aa0-c0ba-460c-b790-1c42c081c84d</id>
                <name>Convert FHIR codes to HL7v2 codes</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480735</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Map FHIR codes to corresponding HL7v2.6 codes using the Table number.

	@param {String} FhirCode - FHIR code
	@param {String} tableName - HL7v2.6 Table Name	
	@return {String} return corresponsing HL7v2.6 code if known or &quot;Unknown&quot; result
*/
function convertToHL7v2Table(FhirCode,tableNumber) {

	var code = &apos;&apos;;
	if (&apos;undefined&apos; !== typeof FhirCode &amp;&amp; null !== FhirCode) {
		code = FhirCode.toString().toLowerCase();	
	}
	

	switch(tableNumber) {
		case &quot;0001&quot;:
			if (&apos;female&apos; == code || &apos;f&apos; == code) return &apos;F&apos;; else
			if (&apos;male&apos; == code || &apos;m&apos; == code) return &apos;M&apos;; else
			if (&apos;other&apos; == code) return &apos;O&apos;; else
			return &apos;U&apos;; 			
		break;

		case &quot;0004&quot;:
			// http://hl7.org/fhir/encounter-class
			if (&apos;emergency&apos; == code) return &apos;E&apos;; else				
			if (&apos;inpatient&apos; == code) return &apos;I&apos;; else
			if (&apos;outpatient&apos; == code) return &apos;O&apos;; else
			return &quot;U&quot;;
		break;

		case &quot;0190&quot;:
			// http://hl7.org/fhir/ValueSet/address-type
			if (&apos;postal&apos; == code) return &apos;H&apos;; else				
			if (&apos;physical&apos; == code) return &apos;P&apos;; else
			if (&apos;both&apos; == code) return &apos;H&apos;; else
			return &quot;M&quot;;
		break;		

		case &quot;0201&quot;:
			// http://hl7.org/fhir/ValueSet/contact-point-use
			if (&apos;home&apos; == code) return &apos;PRN&apos;; else				
			if (&apos;work&apos; == code) return &apos;WPN&apos;; else
			if (&apos;mobile&apos; == code) return &apos;PRS&apos;; else
			if (&apos;temp&apos; == code) return &apos;TMP&apos;; else			
			if (&apos;old&apos; == code) return &apos;OLD&apos;; else
			return &quot;PRN&quot;;
		break;	

		case &quot;0202&quot;:
			// http://hl7.org/fhir/contact-point-system
			if (&apos;phone&apos; == code) return &apos;PH&apos;; else				
			if (&apos;fax&apos; == code) return &apos;FX&apos;; else
			if (&apos;pager&apos; == code) return &apos;BP&apos;; else
			if (&apos;email&apos; == code) return &apos;Internet&apos;; else
			return &quot;PH&quot;;
		break;	

		case &quot;0063&quot;:
			// http://hl7.org/fhir/ValueSet/patient-contact-relationship
			// (SN) Partial list
			if (&apos;parent&apos; == code) return &apos;PAR&apos;; else
			if (&apos;MTH&apos; == code) return &apos;MTH&apos;; else
			if (&apos;FTH&apos; == code) return &apos;FTH&apos;; else	
			if (&apos;caregiver&apos; == code) return &apos;CGV&apos;; else
			if (&apos;SPS&apos; == code) return &apos;SPO&apos;; else
			if (&apos;CHILD&apos; == code) return &apos;CHD&apos;; else
			if (&apos;GRNDCHILD&apos; == code) return &apos;GCH&apos;; else
			if (&apos;GRPRN&apos; == code) return &apos;GRP&apos;; else
			if (&apos;SIB&apos; == code) return &apos;SIB&apos;; else
			if (&apos;BRO&apos; == code) return &apos;BRO&apos;; else
			if (&apos;SIS&apos; == code) return &apos;SIS&apos;; else
			if (&apos;friend&apos; == code) return &apos;FND&apos;; else
			if (&apos;ONESELF&apos; == code) return &apos;SEL&apos;; else
			if (&apos;emergency&apos; == code) return &apos;EMC&apos;; else
			return &apos;UNK&apos;;		
		break;
		default:
			return &apos;U&apos;;
	}


}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>fc481186-afaa-447b-822c-f0ba6980e3b2</id>
            <name>Database</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479385</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>feecaa3a-dba6-468b-a5b7-7379e6965d53</string>
              <string>bfe36ced-a6f7-44e7-af45-5837f11b3bad</string>
              <string>4a11b6f9-2a70-45a4-85ef-7949937ff063</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>138c30fb-34bf-4b61-b178-41a23b895682</string>
              <string>48871745-b660-4892-a5d6-d0a07002ee34</string>
              <string>c493d457-70a0-4f4c-a937-0488ff6a4535</string>
              <string>44fa8b92-bea5-4ca9-bc34-fba837df1f3e</string>
              <string>9a05a6d3-f67e-4e8d-a5c8-eeddecacea4f</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds>
              <string>1e31ed90-0f2c-4950-8183-3d297d3a02a7</string>
              <string>53ad5032-6ea6-475f-b483-c26cedbc43f2</string>
              <string>bf34b389-a73d-441f-9590-7d7f243ad5b5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
            </disabledChannelIds>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>f2b08362-f366-4e5d-8c62-4b9d2977a71a</id>
                <name>Get_Informix_Connection</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480996</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
JavaScript function to centralise creation of a database connection. The
connection won&apos;t be open, the caller still needs to do this but all constants
will be instantiated here

@return dbConn returns an instance of a returns a new DatabaseConnection object
*/
function Get_Informix_Connection() {

var dbConn = DatabaseConnectionFactory.createDatabaseConnection(&apos;com.informix.jdbc.IfxDriver&apos;, &apos;jdbc:informix-sqli://10.192.176.57:1526/orion_clinic:INFORMIXSERVER=dboc&apos;, &apos;consultaocli&apos;, &apos;hdrsanjuan&apos;);

return dbConn;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>0db3684b-ca1c-42a3-b4ac-5979f6d90156</id>
            <name>DateLibrary</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479357</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>20771cf2-84cd-48f7-b644-387ca3be7286</string>
              <string>95542362-d5fa-4ab6-9bad-ec1b8e7158c3</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>2c39ba37-5558-4b03-8572-9d598615d6f5</string>
              <string>f0b5344f-fef0-492d-aa30-343d586964cd</string>
              <string>eb46a988-ef28-438f-85a8-79ff448dbfa8</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>7976a968-87c0-4231-9d07-d96b7000f9ab</string>
              <string>d0c614a3-7f92-4fcd-ae3e-a875f29df996</string>
              <string>db202450-62ae-4257-b9d1-c482a5ec516b</string>
              <string>fb12c5ab-a29f-434c-9849-957ffb52b0fb</string>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>20accf86-8a52-47c2-b436-974981161d93</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>0d1732eb-79c8-47b1-a829-58be289cee1f</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>049fa85e-9f9b-4f3a-8ccf-f970405e2ff5</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>cbd38b8f-9f4f-45d0-842b-f7953d49a9e9</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>7f99cb7e-9df9-4f60-9035-692e83174470</string>
              <string>342b2c7f-9e89-4e32-bcd5-2b3df76c5368</string>
              <string>57123153-b415-4444-899e-5fb7f5fbe722</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
              <string>83e1c3c5-b377-47cf-89d5-71d6251deee4</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>5aca6564-b2be-480e-8f40-9f99e811ad34</id>
                <name>DateFHIRToHl7</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597480587</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyy/MM/ddTHH:mm:ss
function DateFHIRToHl7(dateInFhir) {

	channelMap.put(&apos;dateInFhir&apos;,dateInFhir);
	channelMap.put(&apos;year&apos;,dateInFhir.substring(0,4));
	channelMap.put(&apos;MM&apos;,dateInFhir.substring(5,7));
	channelMap.put(&apos;dd&apos;,dateInFhir.substring(8,10));
	channelMap.put(&apos;HH&apos;,dateInFhir.substring(11,13));
	channelMap.put(&apos;mm&apos;,dateInFhir.substring(14,16));
	channelMap.put(&apos;ss&apos;,dateInFhir.substring(17,19));
	
	
	var HL7date =new Date(dateInFhir.substring(0,4),
	dateInFhir.substring(5,7),
	dateInFhir.substring(8,10),
	dateInFhir.substring(11,13),
	dateInFhir.substring(14,16),
	dateInFhir.substring(17,19)).getTime();
    

    return HL7date;
}</code>
                </properties>
              </codeTemplate>
              <codeTemplate version="3.9.1">
                <id>606eef4c-b703-4a5b-8cc0-aa68be7294c0</id>
                <name>DateHL7ToFHIR</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479605</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
// HL7 formate yyyyMMddHHmmss
function DateHL7ToFHIR(DateHL7) {
	
	var FHIRdate = &apos;&apos;;
    FHIRdate += DateHL7.substring(0,4) + &apos;/&apos;;
    FHIRdate += DateHL7.substring(4,6) + &apos;/&apos;;
   FHIRdate += DateHL7.substring(6,8) + &apos;T&apos;;
   
   if(DateHL7.substring(8,10)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

     if(DateHL7.substring(10,12)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00:&apos;;}

   
     if(DateHL7.substring(12,14)){
   FHIRdate += DateHL7.substring(8,10) + &apos;:&apos;;
   }else {FHIRdate +=&apos;00&apos;;}
   

   
    FHIRdate += &apos;+GMT&apos;;
    return FHIRdate;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>f77712da-d430-4a36-88e2-815d59b91885</id>
            <name>HL7_Limbach_DEV</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479366</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description>HL7</description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>8c993702-d5a3-47d5-ad5d-3a24f76fc080</id>
                <name>Update Response from RD to FireBird DB</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597481968</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>
function processRDResponse(senderRefReceived){
	var endingPosOfHeadId = senderRefReceived.indexOf(&quot;episodeId:&quot;);
	var headIdForSenderReference = senderRefReceived.substring(7, endingPosOfHeadId);
	var endingPosOfEpisodeId = senderRefReceived.indexOf(&quot;originalMessage:&quot;);
	var episodeIdForSenderReference = senderRefReceived.substring(endingPosOfHeadId+10, endingPosOfEpisodeId);
	var senderReferenceOrg = senderRefReceived.substring(endingPosOfEpisodeId+16);
	logger.debug(&quot;Channel 6 and Poll : Episode ID:  &quot;+episodeIdForSenderReference);	
	var text = getTEXTFromBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, &quot;KB&quot;);
	if(!(input.report == &quot;&quot; || input.report == null)){
		text = text +&quot;\n&quot;+ input.report;
		logger.debug(&quot;Channel 6_D text from BEFUND_TEXTE: &quot;+text);
		updateTEXTInBEFUND_TEXTE(headIdForSenderReference, episodeIdForSenderReference, text, &quot;KB&quot;); //Shoudl be KB
		updateDetailsBEFUND_KOPF(headIdForSenderReference, episodeIdForSenderReference, &quot;CM&quot;);		
	}
	
}


/*
	The function updateDetailsBEFUND_KOPF updates the table BEFUND_KOPF
*/
function updateDetailsBEFUND_KOPF(headId, episodeId, befundStatus){
	logger.debug(&quot;Channel 6 and Poll : function updateDetailsBEFUND_KOPF headId:&quot;+headId+&quot; episodeId:&quot;+episodeId+&quot; befundStatus:&quot;+befundStatus);
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;Update BEFUND_KOPF set STATUS_DRUCK=&apos;&apos;, STATUS_DATEI=&apos;N&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and ID=&quot;+headId+&quot; and BEFUND_STATUS=&apos;&quot;+befundStatus+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the BEFUND_KOPF: &quot;+SQLToUpdateTEXT);
		var res_TEXT_List = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
	}catch(ex){
		logger.error(&quot;Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	The function updateTEXTInBEFUND_TEXTE updates the table BEFUND_TEXTE or insert&apos;s a new row to it.
*/
function updateTEXTInBEFUND_TEXTE(headId, episodeId, text, text_art){
	var DBCONToUpdateTEXT = getFireBirdConnection();
	try{
		var DBCONToUpdateTEXT = getFireBirdConnection();
		var SQLToUpdateTEXT = &quot;update BEFUND_TEXTE set TEXT = &apos;&quot;+text+&quot;&apos; where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to update the updateTEXTInBEFUND_TEXTE: &quot;+SQLToUpdateTEXT);
		var resOfUpdateTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToUpdateTEXT);
		logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfUpdateTEXT);
		DBCONToUpdateTEXT.close();	
		DBCONToUpdateTEXT = getFireBirdConnection();
		if(resOfUpdateTEXT == 0){ 
			var SQLToInsertTEXT = &quot;INSERT INTO BEFUND_TEXTE (BEFKOPFID, LABOR_NUMMER, LFDNR_AUFTRAG, PROBE_ID, TEXT_ART, TEXT) VALUES (&quot;+headId+&quot;,&quot;+episodeId+&quot;, Null , Null, &apos;KB&apos;, &apos;&quot;+text+&quot;&apos;);&quot;;
			logger.debug(&quot;Channel 6 and Poll : Query executed to update the Insert into BEFUND_TEXTE: &quot;+SQLToInsertTEXT);
			var resOfInserteTEXT = DBCONToUpdateTEXT.executeUpdate(SQLToInsertTEXT);
			logger.debug(&quot;Channel 6 and Poll : Value of the result s&quot;+resOfInserteTEXT);	
		}
		DBCONToUpdateTEXT.close();	
		
	}catch(ex){
		logger.error(&quot; Error in executing the update statement:&quot;+SQLToUpdateTEXT);
		DBCONToUpdateTEXT.close();
		throw ex;
	}
}

/*
	Generic function to get a new FireBird Connection. 
*/
function getFireBirdConnection(){
	var FbDriver =  configurationMap.get(&quot;FbDriver&quot;);
	var FbUrl  = configurationMap.get(&quot;FbUrl&quot;);
	var FbUsername = configurationMap.get(&quot;FbUsername&quot;);
	var FbPw  = configurationMap.get(&quot;FbPw&quot;);

	var DBCON = DatabaseConnectionFactory.createDatabaseConnection(FbDriver,FbUrl,FbUsername,FbPw); 
	return DBCON;
}

/*
	The function getTEXTFromBEFUND_TEXTE gets the value of TEXT from the table BEFUND_TEXTE.
*/
function getTEXTFromBEFUND_TEXTE(headId, episodeId, text_art){
	var text = &quot;&quot;;
	var DBCONToGetTEXT = getFireBirdConnection();
	try{
		var SQLToGetTEXT = &quot;select TEXT from BEFUND_TEXTE where LABOR_NUMMER=&quot;+episodeId+&quot; and BEFKOPFID=&quot;+headId+&quot; and TEXT_ART=&apos;&quot;+text_art+&quot;&apos;;&quot;;
		logger.debug(&quot;Channel 6 and Poll : Query executed to get the TEXT: &quot;+SQLToGetTEXT);
		var res_TEXT_List = DBCONToGetTEXT.executeCachedQuery(SQLToGetTEXT);
		var size_TEXT_List = res_TEXT_List.size();
		if (size_TEXT_List &gt;0){
			for(var i = 0;i&lt;size_TEXT_List;i++){
				res_TEXT_List.next();
				text = res_TEXT_List.getString(&quot;TEXT&quot;);
			}
		}
		DBCONToGetTEXT.close();	
	}catch(ex){
		logger.error(&quot;Error in executing the get TEXT statement:&quot;+SQLToGetTEXT);
		DBCONToGetTEXT.close();	
		throw ex;
	}
	return text;	
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
          <codeTemplateLibrary version="3.9.1">
            <id>833c5444-6415-4d62-a76b-caa39589c2fa</id>
            <name>Mirth</name>
            <revision>1</revision>
            <lastModified>
              <time>1682597479347</time>
              <timezone>America/Bogota</timezone>
            </lastModified>
            <description></description>
            <includeNewChannels>true</includeNewChannels>
            <enabledChannelIds>
              <string>0c4728b1-b0fa-4d99-9d0b-640e73a77e22</string>
              <string>0ee1b38b-9693-49cc-a93f-d83c2162abea</string>
              <string>f4c513ef-f1ab-470a-bff5-d505363dd0cb</string>
              <string>698319a5-6a40-439f-a2fc-77968f8fd8b0</string>
              <string>747034d1-3b67-4648-b61d-97569079ec4f</string>
              <string>a34ca889-a825-42c2-b8d2-eade79050a7b</string>
              <string>e28b6034-657f-44fe-bdfb-2eb08f6b8b9d</string>
              <string>8bf57726-afe4-4bf2-ab11-a811a2a90173</string>
              <string>8744071f-c37e-4836-91e5-09c33fc3fc6c</string>
              <string>03226d36-9fd4-49ce-a918-28b4fb9517b3</string>
              <string>278077bd-06c4-4367-8e98-793b88f53108</string>
              <string>dd2306fc-2fd7-4a27-a082-5f8c481ec5c6</string>
              <string>1ef6c048-d7a7-4702-a9fa-88c3929f28d7</string>
            </enabledChannelIds>
            <disabledChannelIds/>
            <codeTemplates>
              <codeTemplate version="3.9.1">
                <id>b9eceb1d-8abb-4931-8247-209d70519f99</id>
                <name>Fix HL7v2 Node Order</name>
                <revision>1</revision>
                <lastModified>
                  <time>1682597479881</time>
                  <timezone>America/Bogota</timezone>
                </lastModified>
                <contextSet>
                  <delegate>
                    <contextType>CHANNEL_POSTPROCESSOR</contextType>
                    <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                    <contextType>CHANNEL_UNDEPLOY</contextType>
                    <contextType>GLOBAL_POSTPROCESSOR</contextType>
                    <contextType>CHANNEL_PREPROCESSOR</contextType>
                    <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                    <contextType>GLOBAL_UNDEPLOY</contextType>
                    <contextType>DESTINATION_DISPATCHER</contextType>
                    <contextType>CHANNEL_DEPLOY</contextType>
                    <contextType>GLOBAL_PREPROCESSOR</contextType>
                    <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                    <contextType>GLOBAL_DEPLOY</contextType>
                    <contextType>CHANNEL_ATTACHMENT</contextType>
                    <contextType>CHANNEL_BATCH</contextType>
                    <contextType>SOURCE_RECEIVER</contextType>
                  </delegate>
                </contextSet>
                <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
                  <type>FUNCTION</type>
                  <code>/*

	See issue: http://www.mirthcorp.com/community/issues/browse/MIRTH-625

	Author: Nick Rupley
	Date Modified: 4/18/2012

	fixHL7NodeOrder: Returns a new E4X node where the order of all siblings and descendants have been fixed as per the Mirth HL7 dot notation convention.

	Arguments
	---------
		Required
		--------
		node: The node to be fixed. 
*/
function fixHL7NodeOrder(node) {
	// Create output node
	var newNode = new XML();
	// In case the node is an XMLList of multiple siblings, loop through each sibling
	for each (sibling in node) {
		// Create new sibling node
		var newSibling = new XML(&apos;&lt;&apos;+sibling.name().toString()+&apos;/&gt;&apos;);
		// Iterate through each child node
		for each (child in sibling.children())
			// If the child has its own children, then recursively fix the node order of the child
			if (child.hasComplexContent())
				newSibling.appendChild(fixHL7NodeOrder(child));
			// If the child doesn&apos;t have its own children, then just add the child to the new sibling node
			else
				newSibling.appendChild(child);
		// After recursively fixing all of the child nodes, now we&apos;ll fix the current node
		newNode += sortHL7Node(newSibling);
	}
	// Return the fixed node
	return newNode;
}

function sortHL7Node(node) {
	// If the node has no children, then there&apos;s nothing to sort
	if (node.hasSimpleContent())
		return node;
	// Create new output node
	var newNode = new XML(&apos;&lt;&apos;+node.name().toString()+&apos;/&gt;&apos;);
	// Iterate through each child in the node
	for each (child in node.children()) {
		// If the child has a QName, then we can sort on it
		if (child.name()) {
			// Get the current &quot;index&quot; of the child. Id est, if the QName is PID.3.1, then the index is 1
			curChildIndex = parseInt(child.name().toString().substring(child.name().toString().lastIndexOf(&apos;.&apos;)+1),10);
			// Boolean placeholder
			var inserted = false;
			// Iterate through each child currently in the NEW node
			for (var i = 0; i &lt;= newNode.children().length()-1; i++) {
				// Get the index of the child of the new node
				loopChildIndex = parseInt(newNode.child(i).name().toString().substring(newNode.child(i).name().toString().lastIndexOf(&apos;.&apos;)+1),10);
				// If the child we want to insert has a lower index then the current child of the new node, then we&apos;re going to insert the child 
				// right before the current newNode child
				if (curChildIndex &lt; loopChildIndex) {
					// Insert the child
					newNode.insertChildBefore(newNode.children()[i],child);
					// Set our flag, indicating that an insertion was made
					inserted = true;
					// No need to continue iteration
					break;
				}
			}
			// If no insertion was made, then the index of the child we want to insert is greater than or equal to all of the
			// indices of the children that have already been inserted in newNode. So, we&apos;ll just append the child to the end.
			if (!inserted)
				newNode.appendChild(child);
		}
	}
	// Return the sorted HL7 node
	return newNode;
}</code>
                </properties>
              </codeTemplate>
            </codeTemplates>
          </codeTemplateLibrary>
        </codeTemplateLibraries>
      </exportData>
    </channel>
  </channels>
</channelGroup>
